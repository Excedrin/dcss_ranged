# vim:foldmethod=marker:foldenable:syntax=lua
: -- typical 158, 179 with no lua
: -- typical 389, 1085 with monster_info
: crawl.mpr("pre-load gcinfo: " .. gcinfo())

# crawl settings

# {{{1
##### 1- Starting Screen ############################################
species = DE
background = FE
weapon = mace
##### 2-  File System ###############################################

##### 3-  Lua Files #################################################
lua_file = lua/stash.lua
lua_file = lua/wield.lua
lua_file = lua/runrest.lua
lua_file = lua/gearset.lua
lua_file = lua/trapwalk.lua
#lua_file = lua/autofight.lua

###### 4-  Interface #################################################
#
# workaround for tiles
bindkey = [+] CMD_SEARCH_STASHES

##### 4-a       Picking up and Dropping ###############
#autopickup = !%"
# "
autopickup = $?!+"/%
# "
include = autopickup_exceptions.txt
autopickup_exceptions = <of Zot
#autopickup_exceptions = book

##### 4-b       Targetting ############################

default_target = false

##### 4-c       Passive Sightings #####################

##### 4-d       Branding ##############################

##### 4-e       Level Map Functions ###################

##### 4-f       Viewport Options  ###################

##### 4-g       Travel and Exploration #################
travel_delay = -1
explore_delay = -1
travel_key_stop = false
explore_stop = greedy_visited_item_stack
auto_exclude = oklob plant,statue,curse skull,roxanne
runrest_ignore_poison  = 2:30
runrest_ignore_monster = butterfly:1
include = runrest_messages.txt
trap_prompt = false
trapwalk_safe_hp = dart:1,needle:1,arrow:1,bolt:1,spear:1,axe:1,blade:1,teleport:1,zot:1,alarm:1

##### 4-h       Stashes ###############################

##### 4-i       Command Enhancements ##################
auto_list = false
always_confirm_butcher = true

##### 4-j       Messages and Display Enhancements #####
hp_warning = 30

show_gold_turns              = true
show_game_turns              = true
show_more                  = false
show_inventory_weights     = true
list_rotten                = false

#####          Colours (messages and menus) #####
include = standard_colours.txt
include = food_colouring.txt
include = menu_colours.txt
menu_colour = pickup:green:god gift
menu_colour = inventory:white:\w \+\s
menu_colour = inventory:white:\w \#\s
menu_colour = notes:white:Reached XP level
message_colour = cyan:Save game and exit
message_colour = lightred:Lua error
message_colour = lightred:You die
message_colour = cyan:\|\|\|
#message_colour = mute:.*
message_colour = mute:Unknown command.

force_more_message = You have gained Dodging skill!
force_more_message = You have gained Stealth skill!
force_more_message = You have gained Stabbing skill!
force_more_message = LOW HITPOINT WARNING

include = messages.txt
##### 4-k       Firing Commands #######################

##### 4-l       Channels ##############################
channel.multiturn = mute

##### 4-m       Inscriptions ##########################

##### 4-n       Macro related Options #################

##### 4-t       Tile related Options ##################

include = tiles_options.txt

##### 5-  Dump File #################################################

##### 5-a       Items and Kill List ###################

##### 5-b       Notes #################################
ood_interesting = 8
note_hp_percent = 5
note_skill_levels = 1,5,10,15,27
note_items    = rod of, acquirement, preservation, running, of Zot
note_messages = You pass through the gate
note_messages = cast .* Abyss
note_messages = Your scales start
note_messages = protects you from harm
note_messages = You fall through a shaft
note_monsters = orb of fire, ancient lich, Sigmund

##### 6-  Miscellaneous #############################################

##### 6-a       All OS ################################

##### 6-b       DOS and Windows #######################

##### 6-c   Unix ##################################

##### 6-d   Alternative keybinding files ##########

#################################################
# here comes the lua!
#################################################
# }}}
: -- monster_info table
: -- {{{1
: monster_info={
: [98]={name="worker ant", speed=12, hd=3, hplow=9, hphigh=24, ac=4, ev=10, attacks={ {dam=8, type="poison"} }, flags={  }, resists={ magic=12, poison=-1 }, xp=34},
: [100]={name="queen ant", speed=7, hd=13, hplow=54, hphigh=93, ac=14, ev=3, attacks={ {dam=20, type="nasty poison"} }, flags={  }, resists={ magic=52, poison=-1 }, corpse="poisonous", xp=412},
: [99]={name="soldier ant", speed=10, hd=6, hplow=20, hphigh=46, ac=8, ev=10, attacks={ {dam=14, type="nasty poison"} }, flags={  }, resists={ magic=24, poison=-1 }, corpse="poisonous", xp=156},
: [97]={name="ant larva", speed=6, hd=2, hplow=6, hphigh=16, ac=2, ev=6, attacks={ {dam=5, type="plain"} }, flags={  }, resists={ magic=8, poison=-1 }, corpse="poisonous", xp=1},
: [20]={name="megabat", speed=30, hd=1, hplow=2, hphigh=5, ac=1, ev=14, attacks={ {dam=1, type="plain"} }, flags={ "sense invisible", "fly" }, resists={ magic=1 }, xp=1},
: [496]={name="bat", speed=30, hd=1, hplow=2, hphigh=5, ac=1, ev=14, attacks={ {dam=1, type="plain"} }, flags={ "sense invisible", "fly" }, resists={ magic=1 }, xp=1},
: [96]={name="butterfly", speed=25, hd=1, hplow=3, hphigh=8, ac=0, ev=25, attacks={  }, flags={ "fly" }, resists={ magic=4, poison=-1 }, xp=0},
: [131]={name="vampire bat", speed=30, hd=3, hplow=6, hphigh=15, ac=1, ev=14, attacks={ {dam=3, type="vampiric"} }, flags={ "evil", "sense invisible", "fly" }, resists={ magic=4, holy=-1 }, xp=55},
: [498]={name="fire bat", speed=30, hd=3, hplow=6, hphigh=15, ac=1, ev=14, attacks={ {dam=3, type="fire 3-5"} }, flags={ "sense invisible", "fly" }, resists={ magic=4, hellfire=1, cold=-1, steam=1 }, xp=55},
: [92]={name="raven", speed=20, hd=6, hplow=24, hphigh=41, ac=1, ev=10, attacks={ {dam=8, type="plain"}, {dam=8, type="plain"} }, flags={ "sense invisible", "fly" }, resists={ magic=16 }, corpse="contaminated", xp=262},
: [398]={name="phoenix", speed=12, hd=13, hplow=93, hphigh=132, ac=2, ev=10, attacks={ {dam=19, type=""} }, flags={ "holy", "fly" }, resists={ magic=52, poison=1, holy=1, rot=1, neg=3 }, xp=1666},
: [240]={name="centaur", speed=15, hd=4, hplow=12, hphigh=32, ac=3, ev=7, attacks={ {dam=10, type="plain"} }, flags={  }, resists={ magic=16 }, xp=112},
: [241]={name="centaur warrior", speed=15, hd=9, hplow=34, hphigh=67, ac=4, ev=8, attacks={ {dam=16, type="plain"} }, flags={  }, resists={ magic=36 }, xp=944},
: [242]={name="yaktaur", speed=10, hd=8, hplow=30, hphigh=58, ac=4, ev=4, attacks={ {dam=15, type="plain"} }, flags={  }, resists={ magic=32 }, xp=397},
: [243]={name="yaktaur captain", speed=10, hd=14, hplow=55, hphigh=95, ac=5, ev=5, attacks={ {dam=23, type="plain"} }, flags={  }, resists={ magic=56 }, xp=1399},
: [267]={name="draconian", speed=10, hd=5, hplow=19, hphigh=108, ac=9, ev=10, attacks={ {dam=15, type="plain"} }, flags={ "cold-blooded" }, resists={ magic=9 }, corpse="contaminated", xp=548},
: [268]={name="black draconian", speed=10, hd=14, hplow=82, hphigh=116, ac=9, ev=10, attacks={ {dam=20, type="plain"} }, flags={ "cold-blooded", "fly", "!sil" }, resists={ magic=37, elec=2 }, corpse="contaminated", xp=1601, spells={ {"b.lightning"} }},
: [270]={name="yellow draconian", speed=10, hd=14, hplow=82, hphigh=116, ac=9, ev=10, attacks={ {dam=20, type="plain"} }, flags={ "cold-blooded", "!sil" }, resists={ magic=37, acid=3 }, corpse="contaminated", xp=1601, spells={ {"acid splash"} }},
: [276]={name="pale draconian", speed=10, hd=14, hplow=82, hphigh=116, ac=9, ev=14, attacks={ {dam=20, type="plain"} }, flags={ "cold-blooded", "!sil" }, resists={ magic=37 }, corpse="contaminated", xp=1601, spells={ {"steam ball"} }},
: [271]={name="green draconian", speed=10, hd=14, hplow=82, hphigh=116, ac=9, ev=10, attacks={ {dam=20, type="plain"}, {dam=15, type="poison"} }, flags={ "cold-blooded", "!sil" }, resists={ magic=37, poison=1 }, corpse="poison+contam", xp=1743, spells={ {"poisonous cloud"} }},
: [272]={name="purple draconian", speed=10, hd=14, hplow=82, hphigh=116, ac=8, ev=10, attacks={ {dam=20, type="plain"} }, flags={ "cold-blooded", "!sil" }, resists={ magic=149 }, corpse="contaminated", xp=1601, spells={ {"b.quicksilver"} }},
: [273]={name="red draconian", speed=10, hd=14, hplow=82, hphigh=116, ac=9, ev=10, attacks={ {dam=20, type="plain"} }, flags={ "cold-blooded", "!sil" }, resists={ magic=37, fire=1 }, corpse="contaminated", xp=1601, spells={ {"fire breath"} }},
: [274]={name="white draconian", speed=10, hd=14, hplow=82, hphigh=116, ac=9, ev=10, attacks={ {dam=20, type="plain"} }, flags={ "cold-blooded", "!sil" }, resists={ magic=37, cold=1 }, corpse="contaminated", xp=1601, spells={ {"cold breath"} }},
: [275]={name="grey draconian", speed=10, hd=14, hplow=82, hphigh=116, ac=16, ev=10, attacks={ {dam=25, type="plain"}, {dam=15, type="plain"} }, flags={ "cold-blooded", "!sil" }, resists={ magic=37, asphyx=1, drown=1 }, corpse="contaminated", xp=1768, spells={ {"nonexistent spell"} }},
: [269]={name="mottled draconian", speed=10, hd=14, hplow=82, hphigh=116, ac=9, ev=10, attacks={ {dam=20, type="plain"} }, flags={ "cold-blooded", "!sil" }, resists={ magic=37, fire=1, sticky_flame=1 }, corpse="contaminated", xp=1601, spells={ {"sticky flame splash"} }},
: [277]={name="purple draconian caller", speed=10, hd=16, hplow=73, hphigh=104, ac=9, ev=10, attacks={ {dam=20, type="plain"} }, flags={ "evil", "spellcaster", "cold-blooded" }, resists={ magic=64, holy=-1 }, corpse="contaminated", xp=1807, spells={ {"b.quicksilver", "drakes"} }},
: [278]={name="purple draconian monk", speed=10, hd=16, hplow=105, hphigh=133, ac=6, ev=20, attacks={ {dam=35, type="plain"}, {dam=20, type="plain"}, {dam=15, type="plain"} }, flags={ "cold-blooded", "!sil" }, resists={ magic=64 }, corpse="contaminated", xp=2661, spells={ {"b.quicksilver"} }},
: [279]={name="purple draconian zealot", speed=10, hd=16, hplow=70, hphigh=89, ac=12, ev=10, attacks={ {dam=15, type="plain"} }, flags={ "evil", "cold-blooded" }, resists={ magic=64, holy=-1 }, corpse="contaminated", xp=2169, spells={ {"b.quicksilver", "demon", "hellfire burst", "minor healing", "smiting", "animate dead"} }},
: [280]={name="purple draconian shifter", speed=10, hd=16, hplow=77, hphigh=116, ac=8, ev=16, attacks={ {dam=15, type="plain"} }, flags={ "spellcaster", "cold-blooded" }, resists={ magic=85 }, corpse="contaminated", xp=2012, spells={ {"b.quicksilver", "banishment", "blink other", "blink", "controlled blink"} }},
: [281]={name="purple draconian annihilator", speed=10, hd=16, hplow=69, hphigh=93, ac=8, ev=10, attacks={ {dam=15, type="plain"} }, flags={ "spellcaster", "cold-blooded" }, resists={ magic=85 }, corpse="contaminated", xp=2076, spells={ {"b.quicksilver", "b.lightning", "crystal spear", "blink", "iron shot", "poison arrow", "teleport self"} }},
: [282]={name="purple draconian knight", speed=10, hd=16, hplow=108, hphigh=146, ac=12, ev=12, attacks={ {dam=15, type="plain"} }, flags={ "evil", "spellcaster", "cold-blooded" }, resists={ magic=85, holy=-1 }, corpse="contaminated", xp=2497, spells={ {"b.quicksilver", "b.cold", "b.draining", "animate dead", "teleport self"}, {"b.quicksilver", "b.fire", "b.cold", "cantrip", "b.lightning", "b.draining", "teleport self"}, {"b.quicksilver", "b.fire", "pain", "invisibility", "animate dead", "blink"}, {"b.quicksilver", "pain", "b.fire", "blink"}, {"b.quicksilver", "pain", "throw flame", "haste"}, {"b.quicksilver", "sticky flame range", "mystic blast", "invisibility", "stone arrow", "b.draining", "teleport self"} }},
: [283]={name="purple draconian scorcher", speed=10, hd=16, hplow=69, hphigh=93, ac=8, ev=12, attacks={ {dam=15, type="plain"} }, flags={ "spellcaster", "cold-blooded" }, resists={ magic=85, hellfire=1, steam=1 }, corpse="contaminated", xp=2259, spells={ {"b.quicksilver", "b.fire", "sticky flame range", "fireball", "hellfire", "hellfire burst"} }},
: [205]={name="elf", speed=10, hd=10, hplow=9, hphigh=66, ac=2, ev=14, attacks={ {dam=10, type="plain"} }, flags={  }, resists={ magic=28 }, corpse="contaminated", xp=403},
: [206]={name="deep elf soldier", speed=10, hd=3, hplow=9, hphigh=18, ac=0, ev=12, attacks={ {dam=6, type="plain"} }, flags={ "spellcaster" }, resists={ magic=24 }, corpse="contaminated", xp=33, spells={ {"magic dart", "slow", "haste", "blink"}, {"throw flame", "confuse", "invisibility", "magic dart"}, {"throw frost", "cantrip", "haste", "throw flame", "magic dart", "invisibility"} }},
: [207]={name="deep elf fighter", speed=10, hd=6, hplow=19, hphigh=36, ac=0, ev=13, attacks={ {dam=9, type="plain"} }, flags={ "spellcaster" }, resists={ magic=48 }, corpse="contaminated", xp=174, spells={ {"magic dart", "slow", "haste", "blink"}, {"throw flame", "confuse", "invisibility", "magic dart"}, {"throw frost", "cantrip", "haste", "throw flame", "magic dart", "invisibility"} }},
: [208]={name="deep elf knight", speed=10, hd=11, hplow=39, hphigh=60, ac=0, ev=15, attacks={ {dam=14, type="plain"} }, flags={ "spellcaster" }, resists={ magic=88 }, corpse="contaminated", xp=795, spells={ {"magic dart", "slow", "haste", "blink"}, {"throw flame", "confuse", "invisibility", "magic dart"}, {"throw frost", "cantrip", "haste", "throw flame", "magic dart", "invisibility"} }},
: [218]={name="deep elf blademaster", speed=15, hd=16, hplow=89, hphigh=115, ac=0, ev=25, attacks={ {dam=25, type="plain"}, {dam=25, type="plain"} }, flags={  }, resists={ magic=128 }, corpse="contaminated", xp=3619},
: [219]={name="deep elf master archer", speed=10, speedextra={msl=60}, hd=15, hplow=65, hphigh=84, ac=0, ev=15, attacks={ {dam=25, type="plain"}, {dam=5, type="plain"} }, flags={  }, resists={ magic=100 }, corpse="contaminated", xp=1510},
: [209]={name="deep elf mage", speed=10, hd=4, hplow=12, hphigh=24, ac=0, ev=13, attacks={ {dam=5, type="plain"} }, flags={ "spellcaster" }, resists={ magic=32 }, corpse="contaminated", xp=100, spells={ {"b.venom", "mystic blast", "invisibility", "confuse", "slow", "teleport self"}, {"magic dart", "paralyse", "haste", "b.lightning", "confuse", "teleport self"}, {"paralyse", "throw flame", "invisibility", "teleport other", "fireball"}, {"petrify", "crystal spear", "blink", "b.fire", "b.cold", "minor healing"}, {"stone arrow", "sting", "blink", "b.lightning", "banishment", "minor healing"} }},
: [210]={name="deep elf summoner", speed=10, hd=6, hplow=20, hphigh=35, ac=0, ev=13, attacks={ {dam=5, type="plain"} }, flags={ "spellcaster" }, resists={ magic=48 }, corpse="contaminated", xp=186, spells={ {"blink", "call imp", "ufetubus", "vampire summon", "demon", "teleport self"} }},
: [211]={name="deep elf conjurer", speed=10, hd=6, hplow=19, hphigh=35, ac=0, ev=13, attacks={ {dam=5, type="plain"} }, flags={ "evil", "spellcaster" }, resists={ magic=48, holy=-1 }, corpse="contaminated", xp=208, spells={ {"b.fire", "b.cold", "cantrip", "b.lightning", "b.draining", "teleport self"}, {"sticky flame range", "mystic blast", "invisibility", "stone arrow", "b.draining", "teleport self"} }},
: [212]={name="deep elf priest", speed=10, hd=5, hplow=16, hphigh=30, ac=0, ev=13, attacks={ {dam=9, type="plain"} }, flags={ "evil" }, resists={ magic=40, holy=-1 }, corpse="contaminated", xp=135, spells={ {"pain", "cantrip", "minor healing", "smiting", "animate dead"} }},
: [213]={name="deep elf high priest", speed=10, hd=11, hplow=39, hphigh=62, ac=3, ev=13, attacks={ {dam=14, type="plain"} }, flags={ "evil", "see invisible" }, resists={ magic=88, hellfire=1, holy=-1, steam=1 }, corpse="contaminated", xp=1043, spells={ {"demon", "hellfire burst", "minor healing", "smiting", "animate dead"} }},
: [214]={name="deep elf demonologist", speed=10, hd=12, hplow=43, hphigh=66, ac=0, ev=13, attacks={ {dam=12, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=96 }, corpse="contaminated", xp=1116, spells={ {"demon", "banishment", "greater demon", "call imp", "teleport self"} }},
: [215]={name="deep elf annihilator", speed=10, hd=15, hplow=51, hphigh=83, ac=0, ev=13, attacks={ {dam=12, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=120 }, corpse="contaminated", xp=1707, spells={ {"b.lightning", "crystal spear", "blink", "iron shot", "poison arrow", "teleport self"} }},
: [216]={name="deep elf sorcerer", speed=10, hd=14, hplow=49, hphigh=77, ac=0, ev=13, attacks={ {dam=12, type="plain"} }, flags={ "evil", "spellcaster", "see invisible" }, resists={ magic=112, holy=-1 }, corpse="contaminated", xp=1584, spells={ {"b.draining", "banishment", "haste", "demon", "hellfire", "teleport self"} }},
: [217]={name="deep elf death mage", speed=10, hd=15, hplow=51, hphigh=83, ac=0, ev=13, attacks={ {dam=12, type="plain"} }, flags={ "evil", "spellcaster", "see invisible" }, resists={ magic=120, holy=-1 }, corpse="contaminated", xp=1636, spells={ {"b.draining", "minor healing", "animate dead", "teleport self"} }},
: [171]={name="toadstool", speed=10, hd=1, hplow=2, hphigh=4, ac=1, ev=0, attacks={  }, flags={ "plant" }, resists={ magic=5000, poison=1, asphyx=1, drown=1, neg=3 }, xp=0},
: [172]={name="fungus", speed=0, hd=8, hplow=29, hphigh=58, ac=1, ev=0, attacks={  }, flags={ "plant" }, resists={ magic=5000, poison=1, asphyx=1, drown=1, neg=3 }, xp=0},
: [180]={name="ballistomycete", speed=0, hd=4, hplow=20, hphigh=32, ac=1, ev=0, attacks={  }, flags={ "plant" }, resists={ magic=5000, poison=1, asphyx=1, drown=1, neg=3 }, xp=0},
: [181]={name="hyperactive ballistomycete", speed=0, hd=6, hplow=37, hphigh=86, ac=1, ev=0, attacks={  }, flags={ "plant" }, resists={ magic=5000, poison=1, asphyx=1, drown=1, neg=3 }, xp=127},
: [173]={name="wandering mushroom", speed=10, hd=8, hplow=29, hphigh=58, ac=5, ev=0, attacks={ {dam=20, type="confuse"} }, flags={ "plant" }, resists={ magic=32, poison=1, asphyx=1, drown=1, neg=3 }, xp=313},
: [182]={name="goblin", speed=10, hd=1, hplow=2, hphigh=6, ac=0, ev=12, attacks={ {dam=4, type="plain"} }, flags={  }, resists={ magic=1 }, corpse="contaminated", xp=1},
: [183]={name="hobgoblin", speed=10, hd=1, hplow=4, hphigh=7, ac=2, ev=10, attacks={ {dam=5, type="plain"} }, flags={  }, resists={ magic=1 }, corpse="contaminated", xp=2},
: [184]={name="gnoll", speed=10, hd=2, hplow=8, hphigh=18, ac=2, ev=9, attacks={ {dam=9, type="plain"} }, flags={  }, resists={ magic=8 }, corpse="contaminated", xp=14},
: [185]={name="boggart", speed=12, hd=2, hplow=6, hphigh=16, ac=0, ev=12, attacks={ {dam=5, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=18 }, xp=21, spells={ {"confuse", "slow", "invisibility", "blink", "shadow creatures"} }},
: [21]={name="jackal", speed=14, hd=1, hplow=3, hphigh=8, ac=2, ev=12, attacks={ {dam=3, type="plain"} }, flags={  }, resists={ magic=1 }, corpse="contaminated", xp=1},
: [22]={name="hound", speed=15, hd=3, hplow=9, hphigh=24, ac=2, ev=13, attacks={ {dam=6, type="plain"} }, flags={ "sense invisible" }, resists={ magic=12 }, xp=42},
: [25]={name="warg", speed=13, hd=4, hplow=16, hphigh=36, ac=4, ev=12, attacks={ {dam=12, type="plain"}, {dam=3, type="plain"}, {dam=3, type="plain"} }, flags={ "sense invisible" }, resists={ magic=32, poison=1 }, corpse="contaminated", xp=101},
: [24]={name="wolf", speed=17, hd=4, hplow=12, hphigh=32, ac=3, ev=15, attacks={ {dam=8, type="plain"}, {dam=2, type="plain"}, {dam=2, type="plain"} }, flags={ "sense invisible" }, resists={ magic=16 }, xp=100},
: [23]={name="war dog", speed=17, hd=4, hplow=12, hphigh=32, ac=4, ev=15, attacks={ {dam=12, type="plain"} }, flags={ "sense invisible" }, resists={ magic=16 }, corpse="contaminated", xp=170},
: [27]={name="hog", speed=13, hd=6, hplow=20, hphigh=46, ac=2, ev=9, attacks={ {dam=14, type="plain"} }, flags={  }, resists={ magic=24 }, xp=196},
: [26]={name="hell hound", speed=15, hd=5, hplow=16, hphigh=39, ac=6, ev=13, attacks={ {dam=13, type="plain"} }, flags={ "demonic", "sense invisible", "!sil" }, resists={ magic=20, hellfire=1, cold=-1, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, corpse="poison+contam", xp=146, spells={ {"flame blast"} }},
: [28]={name="hell hog", speed=14, hd=11, hplow=43, hphigh=78, ac=2, ev=9, attacks={ {dam=20, type="plain"} }, flags={ "demonic", "!sil" }, resists={ magic=44, holy=-2, rot=1, neg=3, torment=1 }, corpse="poison+contam", xp=982, spells={ {"sticky flame splash"} }},
: [500]={name="holy swine", speed=14, hd=11, hplow=43, hphigh=78, ac=2, ev=9, attacks={ {dam=20, type=""} }, flags={ "holy" }, resists={ magic=44, holy=1, rot=1, neg=3 }, xp=982},
: [130]={name="felid", speed=11, hd=5, hplow=10, hphigh=25, ac=2, ev=18, attacks={ {dam=10, type="plain"} }, flags={  }, resists={ magic=40 }, corpse="contaminated", xp=113},
: [220]={name="spriggan", speed=16, hd=7, hplow=15, hphigh=27, ac=1, ev=20, attacks={ {dam=10, type="plain"} }, flags={ "see invisible" }, resists={ magic=65 }, corpse="contaminated", xp=305},
: [223]={name="spriggan rider", speed=16, hd=11, hplow=36, hphigh=53, ac=1, ev=16, attacks={ {dam=21, type="plain"} }, flags={ "see invisible", "fly" }, resists={ magic=102, poison=-1 }, corpse="contaminated", xp=1077},
: [221]={name="spriggan druid", speed=16, hd=12, hplow=28, hphigh=45, ac=1, ev=25, attacks={ {dam=16, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=112 }, corpse="contaminated", xp=1095, spells={ {"sunray", "awaken forest", "caniforms", "minor healing"} }},
: [224]={name="spriggan berserker", speed=16, hd=12, hplow=27, hphigh=45, ac=2, ev=25, attacks={ {dam=21, type="plain"} }, flags={ "see invisible" }, resists={ magic=112 }, corpse="contaminated", xp=1094, spells={ {"brothers in arms", "hand", "berserker rage"} }},
: [497]={name="spriggan air mage", speed=16, hd=14, hplow=33, hphigh=54, ac=1, ev=25, attacks={ {dam=16, type="plain"} }, flags={ "spellcaster", "see invisible", "fly" }, resists={ magic=130, elec=2 }, corpse="contaminated", xp=1466, spells={ {"airstrike", "b.lightning", "swiftness", "shock", "haste"} }},
: [225]={name="spriggan defender", speed=16, hd=15, hplow=36, hphigh=55, ac=3, ev=30, attacks={ {dam=30, type="plain"} }, flags={ "see invisible" }, resists={ magic=140 }, corpse="contaminated", xp=1579},
: [412]={name="the Enchantress", speed=16, hd=15, hplow=35, hphigh=54, ac=1, ev=40, attacks={ {dam=26, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=140 }, corpse="contaminated", xp=1951, spells={ {"paralyse", "sleep", "haste", "banishment", "invisibility", "teleport self"} }},
: [29]={name="giant slug", speed=6, hd=10, hplow=54, hphigh=77, ac=0, ev=2, attacks={ {dam=23, type="plain"} }, flags={ "amphibious" }, resists={ magic=40, drown=1 }, corpse="poisonous", xp=96},
: [30]={name="agate snail", speed=4, hd=14, hplow=77, hphigh=105, ac=7, ev=2, attacks={ {dam=18, type="plain"} }, flags={ "amphibious" }, resists={ magic=56, drown=1 }, corpse="poisonous", xp=83},
: [31]={name="elephant slug", speed=4, hd=20, hplow=112, hphigh=146, ac=2, ev=1, attacks={ {dam=40, type="plain"} }, flags={  }, resists={ magic=80, poison=-1 }, corpse="poisonous", xp=462},
: [103]={name="queen bee", speed=10, hd=7, hplow=24, hphigh=52, ac=10, ev=10, attacks={ {dam=20, type="nasty poison"} }, flags={ "fly" }, resists={ magic=28, poison=-1 }, corpse="poisonous", xp=304},
: [102]={name="killer bee", speed=20, hd=3, hplow=9, hphigh=24, ac=2, ev=18, attacks={ {dam=10, type="poison"} }, flags={ "fly" }, resists={ magic=12, poison=-1 }, corpse="poisonous", xp=63},
: [106]={name="bumblebee", speed=10, hd=7, hplow=24, hphigh=52, ac=4, ev=15, attacks={ {dam=20, type="medium poison"} }, flags={ "fly" }, resists={ magic=28, poison=-1 }, corpse="poisonous", xp=224},
: [101]={name="killer bee larva", speed=5, hd=1, hplow=3, hphigh=8, ac=1, ev=5, attacks={ {dam=3, type="plain"} }, flags={  }, resists={ magic=4, poison=-1 }, corpse="poisonous", xp=1},
: [226]={name="giant firefly", speed=16, hd=7, hplow=15, hphigh=28, ac=1, ev=18, attacks={ {dam=8, type="plain"} }, flags={ "fly" }, resists={ magic=65, poison=-1 }, corpse="contaminated", xp=241},
: [1]={name="giant newt", speed=10, speedextra={swim=60}, hd=1, hplow=1, hphigh=3, ac=0, ev=15, attacks={ {dam=3, type="plain"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=4, drown=1 }, xp=1},
: [2]={name="giant gecko", speed=12, hd=1, hplow=3, hphigh=8, ac=1, ev=14, attacks={ {dam=5, type="plain"} }, flags={ "cold-blooded" }, resists={ magic=4 }, xp=2},
: [3]={name="iguana", speed=10, hd=3, hplow=9, hphigh=24, ac=5, ev=9, attacks={ {dam=15, type="plain"} }, flags={ "cold-blooded" }, resists={ magic=12 }, xp=37},
: [4]={name="gila monster", speed=10, hd=5, hplow=21, hphigh=39, ac=3, ev=12, attacks={ {dam=20, type="plain"} }, flags={ "cold-blooded" }, resists={ magic=20 }, corpse="poison+contam", xp=110},
: [5]={name="komodo dragon", speed=10, speedextra={swim=60}, hd=8, hplow=29, hphigh=58, ac=7, ev=8, attacks={ {dam=30, type="disease"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=32, drown=1 }, corpse="contaminated", xp=313},
: [61]={name="swamp drake", speed=11, hd=4, hplow=20, hphigh=40, ac=3, ev=11, attacks={ {dam=14, type="plain"} }, flags={ "fly", "!sil" }, resists={ magic=16, poison=1 }, corpse="poison+contam", xp=120, spells={ {"noxious cloud"} }},
: [60]={name="fire drake", speed=12, hd=6, hplow=20, hphigh=46, ac=3, ev=12, attacks={ {dam=8, type="plain"} }, flags={ "fly", "!sil" }, resists={ magic=24, fire=1 }, corpse="contaminated", xp=183, spells={ {"flame blast"} }},
: [59]={name="lindwurm", speed=10, hd=9, hplow=33, hphigh=64, ac=8, ev=6, attacks={ {dam=20, type="plain"}, {dam=10, type="plain"}, {dam=10, type="plain"} }, flags={ "!sil" }, resists={ magic=36 }, xp=645, spells={ {"flame blast"} }},
: [62]={name="death drake", speed=13, hd=9, hplow=54, hphigh=96, ac=6, ev=14, attacks={ {dam=12, type="plain"} }, flags={ "cold-blooded", "fly", "!sil" }, resists={ magic=36, poison=1, rot=1 }, corpse="hydrochloric acid", xp=829, spells={ {"miasma"} }},
: [234]={name="merfolk", speed=10, speedextra={swim=60}, hd=9, hplow=24, hphigh=49, ac=4, ev=12, attacks={ {dam=18, type="plain"} }, flags={ "amphibious" }, resists={ magic=36, drown=1 }, corpse="contaminated", xp=188},
: [237]={name="merfolk impaler", speed=10, speedextra={swim=60, atk=60}, hd=12, hplow=69, hphigh=99, ac=0, ev=18, attacks={ {dam=26, type="plain"} }, flags={ "amphibious" }, resists={ magic=48, drown=1 }, corpse="contaminated", xp=1072},
: [239]={name="merfolk javelineer", speed=10, speedextra={swim=60}, hd=13, hplow=68, hphigh=87, ac=0, ev=14, attacks={ {dam=16, type="plain"}, {dam=17, type="plain"} }, flags={ "amphibious" }, resists={ magic=69, drown=1 }, corpse="contaminated", xp=1207},
: [238]={name="merfolk aquamancer", speed=10, speedextra={swim=60}, hd=15, hplow=52, hphigh=83, ac=0, ev=12, attacks={ {dam=15, type="plain"} }, flags={ "amphibious", "spellcaster" }, resists={ magic=80, drown=1 }, corpse="contaminated", xp=1244, spells={ {"primal wave", "steam ball", "throw icicle", "blink"} }},
: [235]={name="mermaid", speed=10, speedextra={swim=60}, hd=8, hplow=26, hphigh=46, ac=4, ev=12, attacks={ {dam=10, type="plain"} }, flags={ "amphibious" }, resists={ magic=53, drown=1 }, corpse="contaminated", xp=348},
: [236]={name="siren", speed=10, speedextra={swim=60}, hd=13, hplow=72, hphigh=98, ac=4, ev=12, attacks={ {dam=10, type="plain"} }, flags={ "amphibious" }, resists={ magic=121, drown=1 }, corpse="contaminated", xp=1339},
: [358]={name="necrophage", speed=10, hd=5, hplow=16, hphigh=39, ac=2, ev=10, attacks={ {dam=8, type="rot"} }, flags={ "undead", "evil" }, resists={ magic=33, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=1, neg=3, torment=1 }, corpse="hydrochloric acid", xp=151},
: [359]={name="ghoul", speed=10, hd=14, hplow=125, hphigh=170, ac=4, ev=10, attacks={ {dam=30, type="rot"}, {dam=30, type="rot"} }, flags={ "undead", "evil" }, resists={ magic=93, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=1, neg=3, torment=1 }, corpse="hydrochloric acid", xp=2428},
: [357]={name="rotting hulk", speed=8, hd=10, hplow=37, hphigh=73, ac=5, ev=7, attacks={ {dam=25, type="disease"} }, flags={ "undead", "evil" }, resists={ magic=66, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=1, neg=3, torment=1 }, corpse="hydrochloric acid", xp=238},
: [189]={name="orc", speed=10, hd=1, hplow=4, hphigh=10, ac=0, ev=10, attacks={ {dam=5, type="plain"} }, flags={  }, resists={ magic=4 }, corpse="contaminated", xp=3},
: [193]={name="orc wizard", speed=10, hd=3, hplow=9, hphigh=21, ac=1, ev=12, attacks={ {dam=5, type="plain"} }, flags={ "spellcaster" }, resists={ magic=20 }, corpse="contaminated", xp=35, spells={ {"magic dart", "slow", "haste", "blink"}, {"throw flame", "confuse", "invisibility", "magic dart"}, {"throw frost", "cantrip", "haste", "throw flame", "magic dart", "invisibility"} }},
: [191]={name="orc priest", speed=10, hd=3, hplow=9, hphigh=21, ac=1, ev=10, attacks={ {dam=6, type="plain"} }, flags={ "evil" }, resists={ magic=16, holy=-1 }, corpse="contaminated", xp=41, spells={ {"pain", "cantrip", "smiting", "minor healing"} }},
: [190]={name="orc warrior", speed=10, hd=4, hplow=16, hphigh=39, ac=0, ev=13, attacks={ {dam=20, type="plain"} }, flags={  }, resists={ magic=16 }, corpse="contaminated", xp=132},
: [194]={name="orc knight", speed=10, hd=9, hplow=47, hphigh=90, ac=2, ev=13, attacks={ {dam=25, type="plain"} }, flags={  }, resists={ magic=36 }, corpse="contaminated", xp=682},
: [196]={name="orc warlord", speed=10, hd=15, hplow=82, hphigh=144, ac=3, ev=10, attacks={ {dam=32, type="plain"} }, flags={  }, resists={ magic=60 }, corpse="contaminated", xp=2249},
: [195]={name="orc sorcerer", speed=10, hd=9, hplow=21, hphigh=41, ac=5, ev=12, attacks={ {dam=7, type="plain"} }, flags={ "evil", "spellcaster", "see invisible" }, resists={ magic=36, fire=1, holy=-1 }, corpse="contaminated", xp=627, spells={ {"b.fire", "b.draining", "demon", "paralyse", "animate dead", "teleport self"} }},
: [192]={name="orc high priest", speed=10, hd=11, hplow=41, hphigh=68, ac=1, ev=12, attacks={ {dam=7, type="plain"} }, flags={ "evil", "see invisible" }, resists={ magic=58, hellfire=1, holy=-1, steam=1 }, corpse="contaminated", xp=999, spells={ {"pain", "demon", "smiting", "animate dead", "minor healing"} }},
: [369]={name="ghost", speed=10, hd=1, hplow=1, hphigh=1, ac=0, ev=0, attacks={  }, flags={ "undead", "evil", "lev" }, resists={ poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=1},
: [370]={name="phantom", speed=10, hd=7, hplow=24, hphigh=52, ac=3, ev=13, attacks={ {dam=10, type="blink"} }, flags={ "undead", "evil", "lev", "!sil" }, resists={ magic=37, cold=2, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=124, spells={ {"blink"} }},
: [372]={name="hungry ghost", speed=10, hd=7, hplow=24, hphigh=52, ac=0, ev=17, attacks={ {dam=5, type="hunger"} }, flags={ "undead", "evil", "sense invisible", "lev" }, resists={ magic=37, cold=2, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=184},
: [373]={name="flayed ghost", speed=10, hd=11, hplow=43, hphigh=78, ac=0, ev=14, attacks={ {dam=30, type="plain"} }, flags={ "undead", "evil", "lev" }, resists={ magic=58, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=719},
: [482]={name=" ghost", speed=10, hd=1, hplow=5, hphigh=5, ac=1, ev=2, attacks={ {dam=4, type="plain"} }, flags={ "undead", "evil", "spellcaster", "lev" }, resists={ magic=26, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=3},
: [371]={name="shadow", speed=10, hd=3, hplow=9, hphigh=24, ac=12, ev=10, attacks={ {dam=5, type="drain strength"} }, flags={ "undead", "evil", "see invisible", "lev" }, resists={ magic=20, cold=3, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=45},
: [378]={name="silent spectre", speed=10, hd=8, hplow=29, hphigh=58, ac=5, ev=15, attacks={ {dam=15, type="plain"} }, flags={ "undead", "evil", "see invisible", "lev" }, resists={ magic=42, cold=3, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=313},
: [403]={name="spirit", speed=4, hd=7, hplow=38, hphigh=67, ac=3, ev=19, attacks={  }, flags={ "holy", "lev", "!sil" }, resists={ magic=37, poison=1, holy=1, sticky_flame=1, rot=3, neg=3, petrify=1 }, xp=66, spells={ {"blink away"} }},
: [197]={name="dwarf", speed=10, hd=5, hplow=17, hphigh=39, ac=2, ev=12, attacks={ {dam=10, type="plain"} }, flags={  }, resists={ magic=20 }, corpse="contaminated", xp=130},
: [198]={name="deep dwarf", speed=10, hd=5, hplow=16, hphigh=39, ac=2, ev=12, attacks={ {dam=10, type="plain"} }, flags={  }, resists={ magic=40 }, corpse="contaminated", xp=130},
: [199]={name="deep dwarf scion", speed=10, hd=6, hplow=33, hphigh=61, ac=2, ev=12, attacks={ {dam=16, type="plain"} }, flags={  }, resists={ magic=48 }, corpse="contaminated", xp=247},
: [200]={name="deep dwarf artificer", speed=10, hd=7, hplow=24, hphigh=56, ac=2, ev=10, attacks={ {dam=12, type="plain"} }, flags={  }, resists={ magic=56 }, corpse="contaminated", xp=282},
: [201]={name="deep dwarf necromancer", speed=10, hd=7, hplow=24, hphigh=50, ac=2, ev=10, attacks={ {dam=10, type="plain"} }, flags={ "evil", "spellcaster" }, resists={ magic=56, holy=-1 }, corpse="contaminated", xp=283, spells={ {"pain", "dispel undead", "animate dead", "vampiric draining"}, {"pain", "slow", "haste", "blink"} }},
: [202]={name="deep dwarf berserker", speed=10, hd=8, hplow=47, hphigh=87, ac=2, ev=12, attacks={ {dam=20, type="plain"} }, flags={  }, resists={ magic=64 }, corpse="contaminated", xp=546, spells={ {"brothers in arms", "hand", "berserker rage"} }},
: [203]={name="deep dwarf death knight", speed=10, hd=9, hplow=53, hphigh=89, ac=2, ev=12, attacks={ {dam=20, type="plain"} }, flags={ "evil" }, resists={ magic=72, holy=-1 }, corpse="contaminated", xp=854, spells={ {"animate dead", "mirror damage", "summon undead", "drain life"} }},
: [204]={name="unborn deep dwarf", speed=10, hd=11, hplow=61, hphigh=90, ac=2, ev=10, attacks={ {dam=17, type="plain"} }, flags={ "undead", "evil", "spellcaster" }, resists={ magic=117, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=1410, spells={ {"agony", "dispel undead", "mirror damage", "animate dead", "haunt"}, {"b.cold", "b.draining", "animate dead", "teleport self"} }},
: [128]={name="gnome", speed=10, hd=5, hplow=16, hphigh=39, ac=2, ev=12, attacks={ {dam=10, type="plain"} }, flags={  }, resists={ magic=20 }, corpse="contaminated", xp=130},
: [13]={name="rat", speed=10, hd=1, hplow=1, hphigh=4, ac=1, ev=10, attacks={ {dam=3, type="plain"} }, flags={  }, resists={ magic=1 }, xp=1},
: [18]={name="quokka", speed=10, hd=1, hplow=3, hphigh=8, ac=2, ev=13, attacks={ {dam=5, type="plain"} }, flags={  }, resists={ magic=1 }, xp=1},
: [14]={name="grey rat", speed=12, hd=1, hplow=3, hphigh=9, ac=2, ev=12, attacks={ {dam=5, type="plain"} }, flags={  }, resists={ magic=4 }, corpse="contaminated", xp=4},
: [15]={name="green rat", speed=10, hd=2, hplow=6, hphigh=16, ac=5, ev=11, attacks={ {dam=10, type="plain"} }, flags={  }, resists={ magic=8 }, corpse="poisonous", xp=13},
: [16]={name="orange rat", speed=12, hd=3, hplow=9, hphigh=24, ac=7, ev=10, attacks={ {dam=20, type="drain"} }, flags={ "evil" }, resists={ magic=12, holy=-1 }, corpse="poison+contam", xp=34},
: [19]={name="porcupine", speed=12, hd=2, hplow=6, hphigh=18, ac=2, ev=12, attacks={ {dam=7, type="plain"} }, flags={  }, resists={ magic=8 }, corpse="contaminated", xp=32},
: [112]={name="giant cockroach", speed=12, hd=1, hplow=3, hphigh=7, ac=3, ev=10, attacks={ {dam=2, type="plain"} }, flags={  }, resists={ magic=1, poison=-1 }, corpse="contaminated", xp=1},
: [114]={name="giant mite", speed=10, hd=2, hplow=6, hphigh=16, ac=1, ev=7, attacks={ {dam=5, type="poison"} }, flags={  }, resists={ magic=2, poison=-1 }, corpse="poison+contam", xp=10},
: [113]={name="giant centipede", speed=13, hd=2, hplow=6, hphigh=12, ac=2, ev=14, attacks={ {dam=2, type="nasty poison"} }, flags={  }, resists={ magic=8, poison=-1 }, corpse="poisonous", xp=12},
: [121]={name="scorpion", speed=10, hd=3, hplow=9, hphigh=24, ac=5, ev=10, attacks={ {dam=10, type="medium poison"} }, flags={  }, resists={ magic=12, poison=-1 }, corpse="poison+contam", xp=37},
: [122]={name="emperor scorpion", speed=10, hd=11, hplow=43, hphigh=78, ac=5, ev=8, attacks={ {dam=30, type="medium poison"}, {dam=11, type="plain"}, {dam=11, type="plain"} }, flags={  }, resists={ magic=44, poison=-1 }, corpse="poison+contam", xp=898},
: [115]={name="spider", speed=15, hd=3, hplow=9, hphigh=24, ac=3, ev=10, attacks={ {dam=5, type="medium poison"} }, flags={  }, resists={ magic=12, poison=-1 }, corpse="poison+contam", xp=42},
: [119]={name="tarantella", speed=15, hd=4, hplow=12, hphigh=32, ac=3, ev=14, attacks={ {dam=8, type="confuse"} }, flags={  }, resists={ magic=16, poison=-1 }, corpse="poison+contam", xp=90},
: [118]={name="jumping spider", speed=15, hd=5, hplow=16, hphigh=39, ac=6, ev=12, attacks={ {dam=16, type="medium poison"} }, flags={ "!sil" }, resists={ magic=20, poison=-1 }, corpse="poison+contam", xp=146, spells={ {"blink close", "blink away"} }},
: [116]={name="wolf spider", speed=15, hd=8, hplow=29, hphigh=58, ac=3, ev=10, attacks={ {dam=20, type="medium poison"} }, flags={  }, resists={ magic=32, poison=-1 }, corpse="poison+contam", xp=457},
: [117]={name="trapdoor spider", speed=15, hd=8, hplow=30, hphigh=59, ac=3, ev=10, attacks={ {dam=20, type="medium poison"} }, flags={  }, resists={ magic=32, poison=-1 }, corpse="poison+contam", xp=456},
: [120]={name="redback", speed=15, hd=6, hplow=20, hphigh=46, ac=2, ev=12, attacks={ {dam=18, type="strong poison"} }, flags={  }, resists={ magic=24, poison=-1 }, corpse="poison+contam", xp=301},
: [125]={name="demonic crawler", speed=9, hd=9, hplow=33, hphigh=64, ac=10, ev=6, attacks={ {dam=13, type="plain"}, {dam=13, type="plain"}, {dam=13, type="plain"} }, flags={ "demonic", "see invisible" }, resists={ magic=72, fire=1, cold=1, elec=1, poison=1, holy=-2, rot=1, neg=3, torment=1 }, corpse="poison+contam", xp=239},
: [35]={name="crocodile", speed=10, speedextra={swim=60}, hd=5, hplow=16, hphigh=39, ac=4, ev=10, attacks={ {dam=20, type="plain"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=20, drown=1 }, xp=105},
: [33]={name="baby alligator", speed=12, speedextra={swim=60}, hd=7, hplow=24, hphigh=52, ac=1, ev=11, attacks={ {dam=20, type="plain"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=28, drown=1 }, xp=264},
: [34]={name="alligator", speed=10, speedextra={act=80, swim=60}, hd=12, hplow=50, hphigh=95, ac=5, ev=9, attacks={ {dam=30, type="plain"}, {dam=15, type="plain"} }, flags={ "amphibious", "cold-blooded", "!sil" }, resists={ magic=48, drown=1 }, xp=1091, spells={ {"swiftness"} }},
: [126]={name="snapping turtle", speed=9, speedextra={act=80, swim=60}, hd=10, hplow=38, hphigh=81, ac=16, ev=5, attacks={ {dam=30, type="reach"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=40, drown=1 }, xp=281},
: [93]={name="fire crab", speed=11, hd=8, hplow=37, hphigh=66, ac=9, ev=6, attacks={ {dam=15, type="fire 8-15"}, {dam=15, type="fire 8-15"} }, flags={ "!sil" }, resists={ magic=42, fire=3, poison=-1, steam=1 }, corpse="poison+contam", xp=491, spells={ {"flame blast"} }},
: [137]={name="buggy ugly thing", speed=11, speedextra={act=110}, hd=8, hplow=30, hphigh=59, ac=2, ev=10, attacks={ {dam=12, type="disease"} }, flags={  }, resists={ magic=32, rot=1 }, corpse="mutagenic", xp=338},
: [138]={name="buggy very ugly thing", speed=11, speedextra={act=110}, hd=12, hplow=46, hphigh=84, ac=4, ev=10, attacks={ {dam=17, type="rot"} }, flags={  }, resists={ magic=48, rot=1 }, corpse="mutagenic", xp=983},
: [156]={name="fire vortex", speed=15, hd=3, hplow=9, hphigh=24, ac=0, ev=5, attacks={ {dam=30, type="fire 3-5"} }, flags={ "non-living", "lev" }, resists={ magic=5000, fire=3, cold=-1, elec=1, poison=1, steam=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=21},
: [157]={name="spatial vortex", speed=15, hd=6, hplow=39, hphigh=70, ac=0, ev=5, attacks={ {dam=30, type="distort"} }, flags={ "non-living", "lev" }, resists={ magic=5000, fire=1, cold=1, elec=1, poison=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=166},
: [159]={name="vapour", speed=10, hd=12, hplow=27, hphigh=55, ac=0, ev=12, attacks={  }, flags={ "non-living", "see invisible", "lev", "!sil" }, resists={ magic=5000, elec=3, poison=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=898, spells={ {"b.lightning"} }},
: [158]={name="insubstantial wisp", speed=10, hd=6, hplow=6, hphigh=18, ac=20, ev=20, attacks={ {dam=12, type="blink"} }, flags={ "non-living", "lev", "!sil" }, resists={ magic=5000, fire=2, cold=2, elec=2, poison=2, steam=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=137, spells={ {"blink"} }},
: [154]={name="twister", speed=10, hd=12, hplow=10000, hphigh=10000, ac=0, ev=5, attacks={  }, flags={ "non-living", "lev" }, resists={ magic=5000, fire=1, cold=1, elec=3, poison=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, wind=1, petrify=1 }, xp=15000},
: [54]={name="worm", speed=6, hd=5, hplow=16, hphigh=39, ac=1, ev=5, attacks={ {dam=12, type="plain"} }, flags={  }, resists={ magic=13 }, xp=9},
: [55]={name="brain worm", speed=10, hd=5, hplow=15, hphigh=30, ac=1, ev=5, attacks={ {dam=6, type="plain"} }, flags={ "evil", "!sil" }, resists={ magic=20, holy=-1 }, corpse="poisonous", xp=95, spells={ {"brain feed"} }},
: [293]={name="swamp worm", speed=12, hd=5, hplow=27, hphigh=49, ac=3, ev=12, attacks={ {dam=26, type="plain"} }, flags={  }, resists={ magic=20, drown=1 }, corpse="contaminated", xp=145},
: [57]={name="spiny worm", speed=9, hd=12, hplow=46, hphigh=86, ac=10, ev=6, attacks={ {dam=32, type="acid 7d3"} }, flags={  }, resists={ magic=48, poison=-1, acid=3 }, corpse="poison+contam", xp=542},
: [32]={name="giant leech", speed=8, hd=6, hplow=32, hphigh=58, ac=5, ev=15, attacks={ {dam=20, type="vampiric"} }, flags={ "amphibious", "evil" }, resists={ magic=24, holy=-1, drown=1 }, corpse="contaminated", xp=87},
: [345]={name="unseen horror", speed=30, hd=7, hplow=24, hphigh=52, ac=5, ev=10, attacks={ {dam=12, type="plain"} }, flags={ "see invisible" }, resists={ magic=28 }, xp=744},
: [355]={name="small abomination", speed=7, speedmax=15, hd=4, hplow=8, hphigh=44, ac=0, ev=0, attacks={ {dam=23, type="plain"} }, flags={ "demonic" }, resists={ magic=40, holy=-2, rot=1, neg=3, torment=1 }, xp=121},
: [107]={name="yellow wasp", speed=15, hd=4, hplow=12, hphigh=32, ac=5, ev=14, attacks={ {dam=13, type="paralyse"} }, flags={ "fly" }, resists={ magic=16, poison=-1 }, corpse="poisonous", xp=126},
: [104]={name="vampire mosquito", speed=19, hd=5, hplow=16, hphigh=39, ac=2, ev=15, attacks={ {dam=5, type="disease"}, {dam=8, type="vampiric"} }, flags={ "undead", "evil", "fly" }, resists={ magic=20, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, corpse="hydrochloric acid", xp=179},
: [108]={name="red wasp", speed=15, hd=8, hplow=29, hphigh=58, ac=7, ev=14, attacks={ {dam=23, type="paralyse"} }, flags={ "fly" }, resists={ magic=32, poison=-1 }, corpse="poisonous", xp=543},
: [123]={name="ghost moth", speed=12, hd=13, hplow=53, hphigh=95, ac=16, ev=10, attacks={ {dam=18, type="drain dexterity"}, {dam=18, type=""}, {dam=12, type="strong poison"} }, flags={ "fly" }, resists={ magic=104, cold=1, poison=1 }, corpse="mutagenic", xp=3459},
: [124]={name="moth of wrath", speed=12, hd=9, hplow=33, hphigh=64, ac=0, ev=10, attacks={ {dam=25, type="rage"} }, flags={ "fly" }, resists={ magic=36 }, corpse="contaminated", xp=502},
: [390]={name="basilisk zombie", speed=3, speedmax=28, hd=5, hplow=6, hphigh=76, ac=1, ev=6, attacks={ {dam=16, type="plain"} }, flags={ "undead", "evil" }, resists={ magic=1, cold=2, poison=1, holy=-2, asphyx=1, drown=1, rot=1, neg=3, torment=1 }, xp=48},
: [388]={name="big kobold skeleton", speed=8, speedmax=28, hd=5, hplow=5, hphigh=48, ac=0, ev=5, attacks={ {dam=5, type="plain"} }, flags={ "undead", "evil" }, resists={ magic=0, cold=2, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=40},
: [393]={name="basilisk simulacrum", speed=3, speedmax=28, hd=5, hplow=1, hphigh=30, ac=1, ev=6, attacks={ {dam=16, type="cold 5-14"} }, flags={ "undead", "evil" }, resists={ magic=2, fire=-1, cold=3, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=26},
: [374]={name="wight", speed=10, hd=3, hplow=9, hphigh=24, ac=4, ev=10, attacks={ {dam=8, type="drain"} }, flags={ "undead", "evil" }, resists={ magic=16, cold=2, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=58},
: [381]={name="skeletal warrior", speed=10, hd=10, hplow=55, hphigh=75, ac=15, ev=10, attacks={ {dam=25, type="plain"} }, flags={ "undead", "evil", "spellcaster" }, resists={ magic=93, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=812, spells={ {"animate dead"} }},
: [380]={name="flying skull", speed=15, hd=2, hplow=6, hphigh=16, ac=10, ev=17, attacks={ {dam=7, type="plain"} }, flags={ "undead", "evil", "lev" }, resists={ magic=8, fire=1, cold=1, elec=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=15},
: [360]={name="flaming corpse", speed=12, hd=8, hplow=29, hphigh=58, ac=12, ev=13, attacks={ {dam=20, type="napalm"} }, flags={ "undead", "evil", "sense invisible" }, resists={ magic=42, fire=3, poison=1, holy=-2, steam=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=612},
: [387]={name="curse skull", speed=10, hd=13, hplow=66, hphigh=66, ac=40, ev=3, attacks={  }, flags={ "undead", "evil", "see invisible", "lev", "!sil" }, resists={ magic=5000, hellfire=1, cold=2, elec=2, poison=1, holy=-2, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=3758, spells={ {"summon undead", "torment symbol"} }},
: [386]={name="curse toe", speed=12, speedextra={move=200}, hd=14, hplow=77, hphigh=77, ac=50, ev=1, attacks={  }, flags={ "undead", "evil", "see invisible", "lev", "!sil" }, resists={ magic=5000, hellfire=1, cold=1, elec=2, poison=1, holy=-2, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=7890, spells={ {"summon undead", "mushrooms", "torment symbol"} }},
: [395]={name="Angel", speed=15, hd=12, hplow=85, hphigh=123, ac=10, ev=20, attacks={ {dam=25, type="plain"}, {dam=10, type="plain"} }, flags={ "holy", "see invisible", "fly", "!sil" }, resists={ magic=128, elec=2, poison=1, holy=1, rot=1, neg=3 }, xp=2087, spells={ {"minor healing"} }},
: [397]={name="Cherub", speed=15, hd=12, hplow=85, hphigh=123, ac=10, ev=20, attacks={ {dam=25, type="plain"}, {dam=10, type="plain"} }, flags={ "holy", "see invisible", "fly", "!sil" }, resists={ magic=128, elec=2, poison=1, holy=1, rot=1, neg=3 }, xp=2087, spells={ {"minor healing"} }},
: [396]={name="Daeva", speed=10, hd=14, hplow=96, hphigh=140, ac=10, ev=13, attacks={ {dam=25, type="plain"}, {dam=10, type="plain"} }, flags={ "holy", "see invisible", "lev", "!sil" }, resists={ magic=149, poison=1, holy=1, rot=1, neg=3 }, xp=2888, spells={ {"smiting"} }},
: [109]={name="goliath beetle", speed=5, hd=5, hplow=36, hphigh=64, ac=10, ev=3, attacks={ {dam=30, type="plain"} }, flags={  }, resists={ magic=20, poison=-1 }, corpse="poisonous", xp=48},
: [111]={name="boulder beetle", speed=3, hd=9, hplow=33, hphigh=64, ac=20, ev=2, attacks={ {dam=45, type="plain"} }, flags={  }, resists={ magic=36, poison=-1 }, corpse="poisonous", xp=62},
: [110]={name="boring beetle", speed=6, hd=8, hplow=29, hphigh=58, ac=13, ev=4, attacks={ {dam=35, type="plain"} }, flags={  }, resists={ magic=32, poison=-1 }, corpse="poisonous", xp=110},
: [502]={name="giant", speed=10, hd=11, hplow=43, hphigh=78, ac=3, ev=4, attacks={ {dam=30, type="plain"} }, flags={  }, resists={ magic=44, drown=1 }, corpse="contaminated", xp=656},
: [251]={name="hill giant", speed=10, hd=11, hplow=41, hphigh=79, ac=3, ev=4, attacks={ {dam=30, type="plain"} }, flags={  }, resists={ magic=44, drown=1 }, corpse="contaminated", xp=653},
: [252]={name="cyclops", speed=7, hd=9, hplow=33, hphigh=68, ac=5, ev=3, attacks={ {dam=35, type="plain"} }, flags={  }, resists={ magic=36, drown=1 }, xp=529},
: [253]={name="ettin", speed=10, hd=12, hplow=44, hphigh=83, ac=9, ev=4, attacks={ {dam=45, type="plain"}, {dam=45, type="plain"} }, flags={  }, resists={ magic=48, drown=1 }, corpse="contaminated", xp=1438},
: [255]={name="fire giant", speed=10, hd=16, hplow=70, hphigh=122, ac=8, ev=4, attacks={ {dam=30, type="plain"} }, flags={ "sense invisible", "!sil" }, resists={ magic=85, fire=2, steam=1, drown=1 }, corpse="contaminated", xp=2043, spells={ {"b.fire", "fireball"} }},
: [256]={name="frost giant", speed=10, hd=16, hplow=84, hphigh=126, ac=9, ev=3, attacks={ {dam=35, type="plain"} }, flags={ "sense invisible", "!sil" }, resists={ magic=85, cold=2, drown=1 }, corpse="contaminated", xp=2372, spells={ {"b.cold"} }},
: [254]={name="stone giant", speed=10, hd=16, hplow=68, hphigh=108, ac=12, ev=2, attacks={ {dam=45, type="plain"} }, flags={  }, resists={ magic=85, drown=1 }, corpse="contaminated", xp=2026},
: [257]={name="titan", speed=10, hd=20, hplow=87, hphigh=134, ac=10, ev=3, attacks={ {dam=55, type="plain"} }, flags={ "sense invisible", "!sil" }, resists={ magic=186, elec=2, drown=1 }, xp=3613, spells={ {"b.lightning", "minor healing", "airstrike"} }},
: [58]={name="wyvern", speed=15, hd=5, hplow=16, hphigh=39, ac=5, ev=10, attacks={ {dam=20, type="plain"} }, flags={  }, resists={ magic=20 }, xp=207},
: [66]={name="dragon", speed=10, hd=12, hplow=70, hphigh=110, ac=10, ev=8, attacks={ {dam=20, type="plain"}, {dam=13, type="plain"}, {dam=13, type="plain"} }, flags={ "fly", "!sil" }, resists={ magic=64, fire=2, cold=-1, poison=1, steam=1, drown=1 }, xp=1357, spells={ {"flame blast"} }},
: [36]={name="hydra", speed=10, speedextra={swim=60}, hd=13, hplow=50, hphigh=94, ac=0, ev=5, attacks={ {dam=18, type="plain per head"} }, flags={ "amphibious", "regen" }, resists={ magic=52, poison=1, drown=1 }, corpse="poison+contam", xp=1212},
: [67]={name="ice dragon", speed=10, hd=12, hplow=70, hphigh=110, ac=10, ev=8, attacks={ {dam=17, type="plain"}, {dam=17, type="plain"}, {dam=17, type="plain"} }, flags={ "cold-blooded", "fly", "!sil" }, resists={ magic=48, fire=-1, cold=2, poison=1, drown=1 }, xp=1228, spells={ {"cold blast"} }},
: [63]={name="steam dragon", speed=10, hd=4, hplow=20, hphigh=40, ac=5, ev=10, attacks={ {dam=12, type="plain"}, {dam=6, type="plain"} }, flags={ "fly", "!sil" }, resists={ magic=16 }, xp=183, spells={ {"steam ball"} }},
: [65]={name="swamp dragon", speed=10, hd=9, hplow=51, hphigh=82, ac=7, ev=7, attacks={ {dam=18, type="plain"}, {dam=9, type="plain"}, {dam=9, type="plain"} }, flags={ "fly", "!sil" }, resists={ magic=36, poison=1, drown=1 }, corpse="poison+contam", xp=683, spells={ {"poisonous cloud"} }},
: [64]={name="mottled dragon", speed=10, hd=5, hplow=16, hphigh=39, ac=5, ev=10, attacks={ {dam=15, type="plain"}, {dam=6, type="plain"} }, flags={ "fly", "!sil" }, resists={ magic=20, fire=1, poison=1, sticky_flame=1 }, corpse="poison+contam", xp=155, spells={ {"sticky flame splash"} }},
: [71]={name="quicksilver dragon", speed=15, hd=16, hplow=66, hphigh=111, ac=10, ev=15, attacks={ {dam=25, type="plain"}, {dam=20, type="plain"} }, flags={ "sense invisible", "fly", "!sil" }, resists={ magic=149, drown=1 }, corpse="contaminated", xp=3546, spells={ {"b.quicksilver"} }},
: [72]={name="iron dragon", speed=8, hd=18, hplow=101, hphigh=132, ac=20, ev=6, attacks={ {dam=25, type="plain"}, {dam=25, type="plain"}, {dam=25, type="plain"} }, flags={ "sense invisible", "!sil" }, resists={ magic=168, fire=1, cold=1, poison=1, drown=1 }, corpse="contaminated", xp=2319, spells={ {"metal splinters"} }},
: [69]={name="storm dragon", speed=12, hd=14, hplow=83, hphigh=128, ac=13, ev=10, attacks={ {dam=25, type="plain"}, {dam=15, type="plain"}, {dam=15, type="plain"} }, flags={ "fly", "!sil" }, resists={ magic=93, cold=1, elec=3, drown=1 }, xp=3216, spells={ {"b.lightning"} }},
: [73]={name="golden dragon", speed=10, hd=18, hplow=92, hphigh=126, ac=15, ev=7, attacks={ {dam=40, type="plain"}, {dam=20, type="plain"}, {dam=20, type="plain"} }, flags={ "sense invisible", "fly", "!sil" }, resists={ magic=192, fire=1, cold=1, elec=1, poison=1, drown=1 }, corpse="poisonous", xp=5985, spells={ {"b.fire", "b.cold", "poisonous cloud"} }},
: [68]={name="shadow dragon", speed=10, hd=17, hplow=103, hphigh=148, ac=15, ev=10, attacks={ {dam=20, type="drain"}, {dam=15, type="plain"}, {dam=15, type="plain"} }, flags={ "evil", "cold-blooded", "see invisible", "fly", "!sil" }, resists={ magic=113, cold=2, poison=1, holy=-1, drown=1, neg=3 }, corpse="hydrochloric acid", xp=3399, spells={ {"b.draining"} }},
: [70]={name="bone dragon", speed=8, hd=20, hplow=208, hphigh=276, ac=20, ev=4, attacks={ {dam=30, type="plain"}, {dam=20, type="plain"}, {dam=20, type="plain"} }, flags={ "undead", "evil", "sense invisible", "fly" }, resists={ magic=106, fire=1, cold=1, elec=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=2352},
: [74]={name="pearl dragon", speed=12, hd=18, hplow=95, hphigh=139, ac=10, ev=15, attacks={ {dam=35, type=""}, {dam=20, type=""} }, flags={ "holy", "sense invisible", "fly", "!sil" }, resists={ magic=168, holy=1, drown=1, rot=1, neg=3 }, xp=5312, spells={ {"holy breath"} }},
: [151]={name="earth elemental", speed=6, hd=6, hplow=32, hphigh=58, ac=14, ev=4, attacks={ {dam=40, type="plain"} }, flags={ "non-living" }, resists={ magic=5000, fire=3, cold=3, elec=3, poison=3, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=84},
: [152]={name="fire elemental", speed=13, hd=6, hplow=20, hphigh=46, ac=4, ev=12, attacks={ {dam=5, type="fire 6-11"} }, flags={ "non-living", "lev" }, resists={ magic=5000, hellfire=1, cold=-1, elec=1, poison=1, steam=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=196},
: [292]={name="water elemental", speed=10, speedextra={swim=60}, hd=6, hplow=30, hphigh=47, ac=0, ev=7, attacks={ {dam=25, type="plain"} }, flags={ "non-living", "amphibious" }, resists={ magic=5000, fire=-1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=172},
: [153]={name="air elemental", speed=25, hd=6, hplow=20, hphigh=46, ac=2, ev=18, attacks={ {dam=15, type="plain"} }, flags={ "non-living", "see invisible", "lev" }, resists={ magic=5000, elec=3, poison=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, wind=1, petrify=1 }, xp=222},
: [480]={name="iron elemental", speed=6, hd=12, hplow=86, hphigh=131, ac=20, ev=2, attacks={ {dam=40, type="plain"} }, flags={ "non-living", "!sil" }, resists={ magic=5000, fire=3, cold=3, elec=3, poison=3, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=1086, spells={ {"iron shot", "slow", "metal splinters"} }},
: [46]={name="giant frog", speed=15, speedextra={swim=60}, hd=4, hplow=12, hphigh=32, ac=0, ev=12, attacks={ {dam=9, type="plain"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=16, drown=1 }, xp=90},
: [47]={name="giant toad", speed=13, speedextra={swim=60}, hd=8, hplow=29, hphigh=58, ac=2, ev=11, attacks={ {dam=14, type="plain"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=32, drown=1 }, xp=249},
: [48]={name="spiny frog", speed=12, speedextra={swim=60}, hd=7, hplow=24, hphigh=52, ac=6, ev=9, attacks={ {dam=26, type="medium poison"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=28, poison=1, drown=1 }, corpse="poisonous", xp=408},
: [49]={name="blink frog", speed=14, speedextra={swim=60}, hd=6, hplow=20, hphigh=46, ac=0, ev=16, attacks={ {dam=20, type="blink"} }, flags={ "amphibious", "cold-blooded", "!sil" }, resists={ magic=40, drown=1 }, xp=264, spells={ {"blink"} }},
: [84]={name="giant eyeball", speed=3, hd=3, hplow=9, hphigh=24, ac=0, ev=1, attacks={  }, flags={ "lev" }, resists={ magic=12, asphyx=1, asphyx=1 }, xp=3},
: [85]={name="eye of draining", speed=5, hd=7, hplow=24, hphigh=52, ac=3, ev=1, attacks={  }, flags={ "see invisible", "lev" }, resists={ magic=5000, asphyx=1, asphyx=1 }, corpse="poison+contam", xp=66},
: [89]={name="giant orange brain", speed=10, hd=10, hplow=37, hphigh=73, ac=2, ev=4, attacks={  }, flags={ "evil", "see invisible", "lev", "!sil" }, resists={ magic=106, asphyx=1, holy=-1, asphyx=1 }, corpse="mutagenic", xp=787, spells={ {"brain feed", "cause fear", "shadow creatures", "confuse", "blink", "teleport self"} }},
: [88]={name="great orb of eyes", speed=10, hd=12, hplow=46, hphigh=86, ac=10, ev=3, attacks={ {dam=20, type="plain"} }, flags={ "see invisible", "lev", "!sil" }, resists={ magic=5000, poison=1 }, corpse="mutagenic", xp=1347, spells={ {"paralyse", "disintegrate", "slow", "confuse", "teleport other"} }},
: [86]={name="shining eye", speed=7, hd=10, hplow=37, hphigh=73, ac=3, ev=1, attacks={  }, flags={ "see invisible", "lev", "!sil" }, resists={ magic=5000, asphyx=1, asphyx=1 }, corpse="mutagenic", xp=547, spells={ {"polymorph other"} }},
: [87]={name="eye of devastation", speed=7, hd=10, hplow=37, hphigh=73, ac=12, ev=1, attacks={  }, flags={ "see invisible", "lev", "!sil" }, resists={ magic=5000, asphyx=1, asphyx=1 }, xp=435, spells={ {"b.energy"} }},
: [155]={name="golden eye", speed=13, hd=6, hplow=6, hphigh=18, ac=0, ev=20, attacks={  }, flags={ "lev", "!sil" }, resists={ magic=5000, asphyx=1, asphyx=1 }, xp=190, spells={ {"blink"} }},
: [402]={name="ophan", speed=10, hd=15, hplow=76, hphigh=118, ac=10, ev=10, attacks={  }, flags={ "holy", "see invisible", "lev", "!sil" }, resists={ magic=5000, asphyx=1, holy=1, asphyx=1, rot=1, neg=3 }, xp=1852, spells={ {"b.fire", "holy flames"} }},
: [44]={name="hippogriff", speed=10, hd=7, hplow=24, hphigh=52, ac=2, ev=7, attacks={ {dam=10, type="plain"}, {dam=8, type="plain"}, {dam=8, type="plain"} }, flags={ "fly" }, resists={ magic=28 }, xp=184},
: [43]={name="manticore", speed=7, hd=9, hplow=33, hphigh=66, ac=5, ev=7, attacks={ {dam=14, type="plain"}, {dam=8, type="plain"}, {dam=8, type="plain"} }, flags={ "!sil" }, resists={ magic=36 }, corpse="contaminated", xp=163, spells={ {"spikes volley"} }},
: [228]={name="minotaur", speed=10, hd=13, hplow=54, hphigh=93, ac=5, ev=7, attacks={ {dam=35, type="plain"}, {dam=20, type="plain"} }, flags={  }, resists={ magic=52 }, corpse="contaminated", xp=1382},
: [45]={name="griffon", speed=10, hd=12, hplow=46, hphigh=86, ac=4, ev=6, attacks={ {dam=18, type="plain"}, {dam=10, type="plain"}, {dam=10, type="plain"} }, flags={ "fly" }, resists={ magic=48 }, xp=551},
: [141]={name="sphinx", speed=11, hd=16, hplow=66, hphigh=111, ac=5, ev=5, attacks={ {dam=25, type="plain"}, {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "spellcaster", "sense invisible", "fly" }, resists={ magic=64 }, xp=3129, spells={ {"confuse", "paralyse", "minor healing", "smiting", "slow"} }},
: [91]={name="harpy", speed=25, hd=7, hplow=24, hphigh=52, ac=2, ev=10, attacks={ {dam=19, type="plain"}, {dam=14, type=""} }, flags={ "fly" }, resists={ magic=28, poison=1 }, corpse="contaminated", xp=622},
: [227]={name="kenku", speed=10, hd=5, hplow=16, hphigh=39, ac=2, ev=12, attacks={ {dam=10, type="plain"}, {dam=5, type="plain"}, {dam=5, type="plain"} }, flags={ "fly" }, resists={ magic=20 }, xp=130},
: [401]={name="shedu", speed=10, hd=13, hplow=93, hphigh=132, ac=2, ev=10, attacks={ {dam=19, type=""}, {dam=23, type=""} }, flags={ "holy", "fly", "!sil" }, resists={ magic=52, poison=1, holy=1, rot=1, neg=3 }, xp=1675, spells={ {"heal other"} }},
: [139]={name="ice beast", speed=10, speedextra={swim=110}, hd=5, hplow=16, hphigh=39, ac=5, ev=10, attacks={ {dam=5, type="cold 5-14"} }, flags={ "amphibious" }, resists={ magic=20, fire=-1, cold=3, poison=1, asphyx=1, asphyx=1, drown=1 }, xp=130},
: [140]={name="sky beast", speed=10, hd=5, hplow=16, hphigh=39, ac=3, ev=13, attacks={ {dam=5, type="elec 5-6"} }, flags={ "fly" }, resists={ magic=20, elec=3, asphyx=1, asphyx=1 }, corpse="mutagenic", xp=130},
: [75]={name="ooze", speed=8, hd=3, hplow=9, hphigh=24, ac=1, ev=3, attacks={ {dam=5, type="plain"} }, flags={ "sense invisible" }, resists={ magic=24, poison=1, acid=3, asphyx=1, asphyx=1 }, xp=2},
: [76]={name="jelly", speed=9, hd=3, hplow=15, hphigh=30, ac=0, ev=2, attacks={ {dam=8, type="acid 7d3"} }, flags={ "amphibious", "see invisible" }, resists={ magic=12, poison=1, acid=3, asphyx=1, asphyx=1, drown=1 }, xp=22},
: [82]={name="slime creature", speed=10, hd=11, hplow=43, hphigh=78, ac=1, ev=4, attacks={ {dam=22, type="plain"} }, flags={ "amphibious", "regen" }, resists={ magic=44, poison=1, asphyx=1, asphyx=1, drown=1 }, xp=423},
: [82]={name="slime creature", speed=10, hd=11, hplow=43, hphigh=78, ac=1, ev=4, attacks={ {dam=22, type="plain"} }, flags={ "amphibious", "regen" }, resists={ magic=44, poison=1, asphyx=1, asphyx=1, drown=1 }, xp=423},
: [83]={name="pulsating lump", speed=5, hd=10, hplow=37, hphigh=73, ac=2, ev=6, attacks={ {dam=13, type="mutation"} }, flags={ "sense invisible" }, resists={ magic=40, poison=1, asphyx=1, asphyx=1 }, xp=52},
: [78]={name="giant amoeba", speed=10, hd=12, hplow=46, hphigh=86, ac=0, ev=4, attacks={ {dam=25, type="plain"} }, flags={ "amphibious", "sense invisible" }, resists={ magic=48, poison=1, asphyx=1, asphyx=1, drown=1 }, corpse="poison+contam", xp=645},
: [77]={name="brown ooze", speed=10, hd=7, hplow=24, hphigh=52, ac=10, ev=1, attacks={ {dam=25, type="acid 7d3"} }, flags={ "sense invisible" }, resists={ magic=65, poison=1, acid=3, asphyx=1, asphyx=1 }, xp=244},
: [79]={name="azure jelly", speed=11, hd=15, hplow=61, hphigh=103, ac=5, ev=10, attacks={ {dam=12, type="cold 15-44"}, {dam=12, type="cold 15-44"}, {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "sense invisible" }, resists={ magic=80, fire=-1, cold=1, elec=1, poison=1, acid=3, asphyx=1, asphyx=1 }, xp=2134},
: [80]={name="death ooze", speed=12, hd=11, hplow=39, hphigh=61, ac=2, ev=4, attacks={ {dam=32, type="rot"}, {dam=32, type="plain"} }, flags={ "undead", "evil", "sense invisible" }, resists={ magic=117, cold=1, poison=1, acid=3, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=1272},
: [81]={name="acid blob", speed=12, hd=18, hplow=77, hphigh=121, ac=1, ev=3, attacks={ {dam=42, type="acid 7d3"} }, flags={ "sense invisible", "!sil" }, resists={ magic=168, poison=1, acid=3, asphyx=1, asphyx=1 }, xp=3363, spells={ {"acid splash"} }},
: [186]={name="kobold", speed=10, hd=1, hplow=2, hphigh=5, ac=2, ev=12, attacks={ {dam=4, type="plain"} }, flags={  }, resists={ magic=1 }, corpse="poisonous", xp=1},
: [187]={name="big kobold", speed=10, hd=5, hplow=17, hphigh=38, ac=3, ev=12, attacks={ {dam=7, type="plain"} }, flags={  }, resists={ magic=20 }, corpse="poisonous", xp=96},
: [188]={name="kobold demonologist", speed=10, hd=4, hplow=13, hphigh=32, ac=2, ev=13, attacks={ {dam=4, type="plain"} }, flags={ "spellcaster" }, resists={ magic=26 }, corpse="poisonous", xp=129, spells={ {"call imp", "demon", "cantrip"} }},
: [383]={name="lich", speed=10, hd=20, hplow=57, hphigh=99, ac=10, ev=10, attacks={ {dam=15, type="drain"} }, flags={ "undead", "evil", "spellcaster", "see invisible" }, resists={ magic=293, cold=2, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=3799, spells={ {"b.cold", "paralyse", "greater demon", "animate dead", "iron shot", "teleport self"}, {"b.draining", "animate dead", "summon undead", "throw frost", "crystal spear"}, {"b.fire", "confuse", "haste", "b.draining", "greater demon", "banishment"}, {"mystic blast", "b.cold", "invisibility", "animate dead", "destruction orb"} }},
: [384]={name="ancient lich", speed=10, hd=27, hplow=83, hphigh=131, ac=20, ev=10, attacks={ {dam=20, type="drain"} }, flags={ "undead", "evil", "spellcaster", "see invisible" }, resists={ magic=504, fire=1, cold=2, elec=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=10747, spells={ {"b.cold", "paralyse", "greater demon", "animate dead", "iron shot", "teleport self"}, {"b.draining", "animate dead", "summon undead", "throw frost", "crystal spear"}, {"b.fire", "confuse", "haste", "b.draining", "greater demon", "banishment"}, {"mystic blast", "b.cold", "invisibility", "animate dead", "destruction orb"} }},
: [361]={name="mummy", speed=6, hd=3, hplow=15, hphigh=24, ac=3, ev=6, attacks={ {dam=20, type="plain"} }, flags={ "undead", "evil" }, resists={ magic=20, fire=-1, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=18},
: [362]={name="bog mummy", speed=8, speedextra={swim=140}, hd=6, hplow=30, hphigh=47, ac=1, ev=9, attacks={ {dam=25, type="plain"}, {dam=4, type="cold 6-17"} }, flags={ "undead", "amphibious", "evil", "spellcaster" }, resists={ magic=40, fire=1, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=272, spells={ {"throw frost", "slow", "corpse rot"} }},
: [363]={name="guardian mummy", speed=9, hd=7, hplow=36, hphigh=54, ac=6, ev=9, attacks={ {dam=30, type="plain"} }, flags={ "undead", "evil", "see invisible" }, resists={ magic=46, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=367},
: [364]={name="greater mummy", speed=10, hd=15, hplow=185, hphigh=210, ac=10, ev=6, attacks={ {dam=35, type="plain"} }, flags={ "undead", "evil", "spellcaster", "see invisible" }, resists={ magic=5000, cold=1, elec=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=9026, spells={ {"demon", "smiting", "torment symbol", "summon undead"} }},
: [365]={name="mummy priest", speed=8, hd=10, hplow=54, hphigh=77, ac=8, ev=7, attacks={ {dam=30, type="plain"} }, flags={ "undead", "evil", "see invisible" }, resists={ magic=5000, cold=1, elec=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=1387, spells={ {"demon", "smiting", "torment symbol", "summon undead"} }},
: [229]={name="naga", speed=8, speedextra={act=80}, hd=5, hplow=16, hphigh=39, ac=6, ev=10, attacks={ {dam=17, type="plain"} }, flags={ "see invisible", "!sil" }, resists={ magic=40, poison=1 }, corpse="poisonous", xp=108, spells={ {"poison splash"} }},
: [231]={name="naga mage", speed=8, speedextra={act=80}, hd=7, hplow=25, hphigh=52, ac=6, ev=10, attacks={ {dam=17, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=56, poison=1 }, corpse="poisonous", xp=357, spells={ {"b.venom", "mystic blast", "haste", "poison arrow", "teleport other", "teleport self"} }},
: [230]={name="naga warrior", speed=8, speedextra={act=80}, hd=10, hplow=92, hphigh=107, ac=6, ev=10, attacks={ {dam=28, type="plain"} }, flags={ "see invisible", "!sil" }, resists={ magic=80, poison=1 }, corpse="poisonous", xp=748, spells={ {"poison splash"} }},
: [232]={name="greater naga", speed=8, speedextra={act=80}, hd=15, hplow=61, hphigh=100, ac=6, ev=10, attacks={ {dam=27, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=5000, poison=1 }, corpse="poisonous", xp=1677, spells={ {"b.venom", "mystic blast", "haste", "poison arrow", "teleport other", "teleport self"} }},
: [244]={name="ogre", speed=10, hd=5, hplow=17, hphigh=38, ac=1, ev=6, attacks={ {dam=17, type="plain"} }, flags={  }, resists={ magic=20 }, corpse="contaminated", xp=119},
: [245]={name="two-headed ogre", speed=10, hd=6, hplow=20, hphigh=46, ac=1, ev=4, attacks={ {dam=17, type="plain"}, {dam=13, type="plain"} }, flags={  }, resists={ magic=32 }, corpse="contaminated", xp=281},
: [246]={name="ogre mage", speed=10, hd=10, hplow=37, hphigh=71, ac=1, ev=7, attacks={ {dam=12, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=80 }, corpse="contaminated", xp=1150, spells={ {"haste other", "crystal spear", "blink", "b.fire", "b.cold", "minor healing"}, {"haste other", "mystic blast", "invisibility", "confuse", "slow", "teleport self"}, {"haste other", "paralyse", "haste", "b.lightning", "confuse", "teleport self"}, {"haste other", "sting", "blink", "b.lightning", "banishment", "minor healing"}, {"haste other", "throw flame", "invisibility", "teleport other", "fireball"} }},
: [174]={name="plant", speed=0, hd=10, hplow=37, hphigh=73, ac=10, ev=0, attacks={  }, flags={ "plant" }, resists={ magic=5000, poison=1, asphyx=1, drown=1, neg=3 }, xp=0},
: [175]={name="oklob sapling", speed=10, hd=4, hplow=12, hphigh=32, ac=10, ev=0, attacks={  }, flags={ "plant", "!sil" }, resists={ magic=16, poison=1, acid=3, asphyx=1, drown=1, neg=3 }, xp=60, spells={ {"acid splash"} }},
: [176]={name="oklob plant", speed=10, hd=10, hplow=37, hphigh=73, ac=10, ev=0, attacks={  }, flags={ "plant", "!sil" }, resists={ magic=40, poison=1, acid=3, asphyx=1, drown=1, neg=3 }, xp=558, spells={ {"acid splash"} }},
: [177]={name="bush", speed=0, hd=20, hplow=87, hphigh=134, ac=15, ev=0, attacks={  }, flags={ "plant" }, resists={ magic=5000, fire=-1, poison=1, asphyx=1, drown=1, neg=3 }, xp=0},
: [178]={name="burning bush", speed=10, hd=8, hplow=29, hphigh=58, ac=10, ev=0, attacks={  }, flags={ "plant", "see invisible", "!sil" }, resists={ magic=5000, fire=1, poison=1, asphyx=1, drown=1, neg=3 }, xp=313, spells={ {"flame puff"} }},
: [342]={name="efreet", speed=10, hd=7, hplow=24, hphigh=52, ac=10, ev=5, attacks={ {dam=12, type="plain"} }, flags={ "demonic", "lev", "!sil" }, resists={ magic=28, fire=3, cold=-1, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=335, spells={ {"b.fire", "fireball"} }},
: [343]={name="rakshasa", speed=10, hd=10, hplow=37, hphigh=73, ac=10, ev=14, attacks={ {dam=20, type="plain"} }, flags={ "demonic", "see invisible", "!sil" }, resists={ magic=133, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=1071, spells={ {"rakshasa summon", "blink", "invisibility", "teleport self"} }},
: [343]={name="rakshasa", speed=10, hd=10, hplow=37, hphigh=73, ac=10, ev=14, attacks={ {dam=20, type="plain"} }, flags={ "demonic", "see invisible", "!sil" }, resists={ magic=133, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=1071, spells={ {"rakshasa summon", "blink", "invisibility", "teleport self"} }},
: [6]={name="small snake", speed=12, speedextra={swim=60}, hd=1, hplow=2, hphigh=5, ac=0, ev=11, attacks={ {dam=2, type="poison"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=1, drown=1 }, xp=1},
: [7]={name="snake", speed=13, speedextra={swim=60}, hd=2, hplow=6, hphigh=16, ac=1, ev=15, attacks={ {dam=5, type="poison"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=8, drown=1 }, xp=13},
: [8]={name="water moccasin", speed=14, speedextra={swim=60}, hd=4, hplow=12, hphigh=32, ac=2, ev=15, attacks={ {dam=10, type="medium poison"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=16, poison=1, drown=1 }, corpse="poisonous", xp=91},
: [10]={name="black mamba", speed=18, hd=7, hplow=24, hphigh=52, ac=4, ev=15, attacks={ {dam=20, type="medium poison"} }, flags={ "cold-blooded" }, resists={ magic=28, poison=1 }, corpse="poisonous", xp=456},
: [9]={name="viper", speed=13, hd=6, hplow=20, hphigh=46, ac=4, ev=14, attacks={ {dam=15, type="medium poison"} }, flags={ "cold-blooded" }, resists={ magic=24, poison=1 }, corpse="poisonous", xp=196},
: [12]={name="sea snake", speed=12, speedextra={swim=40}, hd=10, hplow=47, hphigh=83, ac=2, ev=15, attacks={ {dam=24, type="strong poison"} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=40, drown=1 }, corpse="poisonous", xp=755},
: [11]={name="anaconda", speed=18, hd=11, hplow=43, hphigh=78, ac=4, ev=16, attacks={ {dam=30, type=""} }, flags={ "amphibious", "cold-blooded" }, resists={ magic=44, drown=1 }, xp=1137},
: [233]={name="guardian serpent", speed=15, hd=8, hplow=29, hphigh=58, ac=6, ev=14, attacks={ {dam=26, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=64, poison=1 }, corpse="mutagenic", xp=586, spells={ {"teleport other", "minor healing", "b.venom", "slow"} }},
: [247]={name="troll", speed=10, hd=7, hplow=24, hphigh=52, ac=3, ev=10, attacks={ {dam=20, type="plain"}, {dam=15, type="plain"}, {dam=15, type="plain"} }, flags={ "regen" }, resists={ magic=28 }, corpse="contaminated", xp=304},
: [248]={name="rock troll", speed=8, hd=11, hplow=43, hphigh=78, ac=13, ev=6, attacks={ {dam=30, type="plain"}, {dam=20, type="plain"}, {dam=20, type="plain"} }, flags={ "regen" }, resists={ magic=58 }, corpse="contaminated", xp=375},
: [249]={name="iron troll", speed=7, hd=16, hplow=66, hphigh=111, ac=20, ev=4, attacks={ {dam=35, type="plain"}, {dam=25, type="plain"}, {dam=25, type="plain"} }, flags={ "regen" }, resists={ magic=106, fire=1, cold=1 }, corpse="poison+contam", xp=826},
: [250]={name="deep troll", speed=10, hd=10, hplow=37, hphigh=73, ac=6, ev=10, attacks={ {dam=27, type="plain"}, {dam=20, type="plain"}, {dam=20, type="plain"} }, flags={ "sense invisible", "regen" }, resists={ magic=40 }, corpse="contaminated", xp=1018},
: [51]={name="grizzly bear", speed=10, hd=7, hplow=30, hphigh=53, ac=5, ev=8, attacks={ {dam=12, type="plain"}, {dam=8, type="plain"}, {dam=8, type="plain"} }, flags={ "!sil" }, resists={ magic=28 }, xp=237, spells={ {"berserker rage"} }},
: [52]={name="polar bear", speed=10, hd=7, hplow=36, hphigh=54, ac=7, ev=8, attacks={ {dam=20, type="plain"}, {dam=5, type="plain"}, {dam=5, type="plain"} }, flags={ "amphibious", "!sil" }, resists={ magic=28, cold=1, drown=1 }, xp=295, spells={ {"berserker rage"} }},
: [53]={name="black bear", speed=10, hd=6, hplow=18, hphigh=35, ac=2, ev=8, attacks={ {dam=4, type="plain"}, {dam=4, type="plain"}, {dam=4, type="plain"} }, flags={ "!sil" }, resists={ magic=24 }, xp=128, spells={ {"berserker rage"} }},
: [366]={name="vampire", speed=10, hd=6, hplow=21, hphigh=46, ac=10, ev=10, attacks={ {dam=7, type="plain"}, {dam=15, type="vampiric"} }, flags={ "undead", "evil", "spellcaster", "see invisible" }, resists={ magic=48, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=212, spells={ {"vampire summon", "confuse", "invisibility"} }},
: [367]={name="vampire knight", speed=10, hd=11, hplow=44, hphigh=99, ac=10, ev=10, attacks={ {dam=33, type="plain"}, {dam=15, type="vampiric"} }, flags={ "undead", "evil", "spellcaster", "see invisible" }, resists={ magic=88, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=1433, spells={ {"vampire summon", "paralyse", "haste", "invisibility", "minor healing"} }},
: [368]={name="vampire mage", speed=10, hd=8, hplow=29, hphigh=52, ac=10, ev=10, attacks={ {dam=7, type="plain"}, {dam=15, type="vampiric"} }, flags={ "undead", "evil", "spellcaster", "see invisible", "fly" }, resists={ magic=64, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=627, spells={ {"b.draining", "summon undead", "invisibility", "animate dead", "teleport self"} }},
: [375]={name="wraith", speed=10, hd=6, hplow=20, hphigh=46, ac=10, ev=10, attacks={ {dam=13, type="drain"} }, flags={ "undead", "evil", "see invisible", "lev" }, resists={ magic=56, cold=1, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=209},
: [377]={name="shadow wraith", speed=10, hd=10, hplow=39, hphigh=75, ac=7, ev=7, attacks={ {dam=20, type="drain"} }, flags={ "undead", "evil", "see invisible", "lev" }, resists={ magic=106, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=823},
: [376]={name="freezing wraith", speed=8, hd=8, hplow=29, hphigh=58, ac=12, ev=10, attacks={ {dam=19, type="cold 8-23"} }, flags={ "undead", "evil", "see invisible", "lev" }, resists={ magic=42, fire=-1, cold=3, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=139},
: [379]={name="eidolon", speed=11, hd=13, hplow=54, hphigh=93, ac=12, ev=10, attacks={ {dam=13, type="drain"}, {dam=13, type=""} }, flags={ "undead", "evil", "see invisible", "lev", "!sil" }, resists={ magic=138, cold=1, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=1365, spells={ {"pain", "cause fear"} }},
: [382]={name="phantasmal warrior", speed=10, hd=9, hplow=33, hphigh=64, ac=12, ev=10, attacks={ {dam=18, type="drain"} }, flags={ "undead", "evil", "see invisible", "lev" }, resists={ magic=72, cold=1, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=542},
: [392]={name="spectral cyclops", speed=3, speedmax=23, hd=9, hplow=4, hphigh=91, ac=5, ev=3, attacks={ {dam=31, type="drain"} }, flags={ "undead", "evil", "see invisible", "lev" }, resists={ magic=5000, cold=1, poison=1, holy=-2, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=176},
: [356]={name="large abomination", speed=6, speedmax=12, hd=9, hplow=21, hphigh=64, ac=0, ev=0, attacks={ {dam=40, type="plain"} }, flags={ "demonic" }, resists={ magic=102, holy=-2, rot=1, neg=3, torment=1 }, xp=519},
: [354]={name="tentacled monstrosity", speed=9, hd=25, hplow=111, hphigh=163, ac=5, ev=5, attacks={ {dam=22, type="plain"}, {dam=17, type="plain"}, {dam=13, type="plain"} }, flags={ "demonic", "amphibious", "see invisible" }, resists={ magic=166, fire=1, cold=1, elec=1, poison=1, holy=-2, drown=1, rot=1, neg=3, torment=1 }, xp=2126},
: [142]={name="Orb Guardian", speed=14, hd=15, hplow=61, hphigh=103, ac=13, ev=13, attacks={ {dam=45, type="plain"} }, flags={ "see invisible" }, resists={ magic=120, drown=1 }, xp=3884},
: [37]={name="sheep", speed=10, hd=3, hplow=9, hphigh=24, ac=2, ev=7, attacks={ {dam=13, type="plain"} }, flags={  }, resists={ magic=12 }, xp=28},
: [38]={name="yak", speed=10, hd=7, hplow=24, hphigh=52, ac=4, ev=7, attacks={ {dam=18, type="plain"} }, flags={  }, resists={ magic=28 }, xp=204},
: [39]={name="death yak", speed=10, hd=14, hplow=55, hphigh=100, ac=9, ev=5, attacks={ {dam=30, type="plain"} }, flags={  }, resists={ magic=93 }, corpse="poison+contam", xp=1057},
: [40]={name="elephant", speed=10, hd=9, hplow=51, hphigh=82, ac=8, ev=2, attacks={ {dam=20, type="plain"}, {dam=5, type="plain"} }, flags={  }, resists={ magic=60, drown=1 }, xp=430},
: [41]={name="dire elephant", speed=10, hd=15, hplow=91, hphigh=133, ac=13, ev=2, attacks={ {dam=40, type="plain"}, {dam=15, type="plain"} }, flags={  }, resists={ magic=100, drown=1 }, xp=1613},
: [42]={name="hellephant", speed=10, hd=20, hplow=138, hphigh=203, ac=13, ev=10, attacks={ {dam=45, type="plain"}, {dam=20, type="plain"}, {dam=15, type="plain"} }, flags={ "demonic", "!sil" }, resists={ magic=133, holy=-2, drown=1, rot=1, neg=3, torment=1 }, xp=4411, spells={ {"fire breath", "blink"} }},
: [405]={name="apis", speed=10, hd=16, hplow=98, hphigh=143, ac=9, ev=5, attacks={ {dam=40, type=""} }, flags={ "holy", "lev" }, resists={ magic=106, holy=1, rot=1, neg=3 }, xp=1763},
: [391]={name="two-headed ogre zombie", speed=4, speedmax=23, hd=6, hplow=25, hphigh=126, ac=1, ev=3, attacks={ {dam=14, type="plain"}, {dam=11, type="plain"} }, flags={ "undead", "evil" }, resists={ magic=8, cold=2, poison=1, holy=-2, asphyx=1, drown=1, rot=1, neg=3, torment=1 }, xp=237},
: [389]={name="giant frog skeleton", speed=5, speedmax=23, hd=4, hplow=21, hphigh=104, ac=0, ev=1, attacks={ {dam=7, type="plain"} }, flags={ "undead", "evil" }, resists={ magic=0, cold=2, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=193},
: [394]={name="two-headed ogre simulacrum", speed=4, speedmax=23, hd=6, hplow=5, hphigh=51, ac=1, ev=3, attacks={ {dam=14, type="cold 6-17"}, {dam=11, type="cold 6-17"} }, flags={ "undead", "evil" }, resists={ magic=6, fire=-1, cold=3, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=118},
: [288]={name="big fish", speed=10, hd=4, hplow=12, hphigh=31, ac=1, ev=12, attacks={ {dam=8, type="plain"} }, flags={ "cold-blooded" }, resists={ magic=16, drown=1 }, xp=41},
: [289]={name="giant goldfish", speed=10, hd=7, hplow=26, hphigh=54, ac=5, ev=7, attacks={ {dam=15, type="plain"} }, flags={ "cold-blooded" }, resists={ magic=28, drown=1 }, xp=124},
: [290]={name="electric eel", speed=10, hd=3, hplow=9, hphigh=24, ac=1, ev=15, attacks={  }, flags={ "cold-blooded", "!sil" }, resists={ magic=12, elec=2, drown=1 }, xp=54, spells={ {"b.electricity"} }},
: [291]={name="jellyfish", speed=10, hd=4, hplow=12, hphigh=31, ac=0, ev=5, attacks={ {dam=1, type="poison, drain strength"}, {dam=1, type="plain"} }, flags={  }, resists={ magic=16, poison=1, drown=1 }, corpse="poisonous", xp=60},
: [294]={name="shark", speed=10, hd=7, hplow=26, hphigh=54, ac=9, ev=5, attacks={ {dam=18, type="plain"}, {dam=9, type="plain"} }, flags={ "cold-blooded" }, resists={ magic=28, drown=1 }, corpse="contaminated", xp=204},
: [295]={name="kraken", speed=14, hd=16, hplow=183, hphigh=233, ac=20, ev=0, attacks={ {dam=50, type="plain"} }, flags={ "cold-blooded", "!sil" }, resists={ magic=64, drown=1 }, corpse="poison+contam", xp=3218, spells={ {"spawn tentacles", "ink cloud"} }},
: [296]={name="tentacle", speed=17, hd=12, hplow=39, hphigh=58, ac=5, ev=7, attacks={ {dam=29, type="plain"} }, flags={ "amphibious", "cold-blooded", "lev" }, resists={ magic=5000, drown=1 }, xp=0},
: [297]={name="tentacle segment", speed=18, hd=12, hplow=39, hphigh=58, ac=5, ev=7, attacks={  }, flags={ "amphibious", "cold-blooded", "lev" }, resists={ magic=5000, drown=1 }, xp=0},
: [284]={name="lava worm", speed=10, hd=6, hplow=21, hphigh=47, ac=1, ev=10, attacks={ {dam=15, type="fire 6-11"} }, flags={  }, resists={ magic=24, fire=3, cold=-1, steam=1 }, xp=103},
: [285]={name="lava fish", speed=10, hd=4, hplow=12, hphigh=31, ac=4, ev=15, attacks={ {dam=10, type="fire 4-7"} }, flags={  }, resists={ magic=16, fire=3, cold=-1, steam=1 }, xp=60},
: [286]={name="lava snake", speed=10, hd=3, hplow=9, hphigh=24, ac=2, ev=17, attacks={ {dam=7, type="fire 3-5"} }, flags={ "!sil" }, resists={ magic=12, fire=3, cold=-1, steam=1 }, xp=48, spells={ {"lava glob"} }},
: [287]={name="salamander", speed=10, hd=14, hplow=57, hphigh=101, ac=5, ev=5, attacks={ {dam=23, type="fire 14-27"} }, flags={  }, resists={ magic=56, fire=3, cold=-1, steam=1 }, xp=1399},
: [56]={name="rock worm", speed=12, hd=5, hplow=26, hphigh=49, ac=3, ev=12, attacks={ {dam=22, type="plain"} }, flags={  }, resists={ magic=20, fire=1, cold=1, elec=1, poison=1 }, corpse="contaminated", xp=168},
: [258]={name="human", speed=10, hd=7, hplow=3, hphigh=67, ac=2, ev=12, attacks={ {dam=10, type="plain"} }, flags={  }, resists={ magic=20 }, corpse="contaminated", xp=246},
: [259]={name="slave", speed=10, hd=5, hplow=16, hphigh=38, ac=2, ev=12, attacks={ {dam=10, type="plain"} }, flags={  }, resists={ magic=20 }, corpse="contaminated", xp=130},
: [260]={name="hell knight", speed=10, hd=10, hplow=46, hphigh=83, ac=0, ev=10, attacks={ {dam=26, type="plain"} }, flags={ "evil", "spellcaster" }, resists={ magic=40, hellfire=1, holy=-1, steam=1 }, corpse="contaminated", xp=815, spells={ {"pain", "b.fire", "blink"}, {"pain", "throw flame", "haste"} }},
: [261]={name="necromancer", speed=10, hd=10, hplow=26, hphigh=53, ac=0, ev=13, attacks={ {dam=6, type="plain"} }, flags={ "evil", "spellcaster" }, resists={ magic=53, holy=-1 }, corpse="contaminated", xp=611, spells={ {"b.cold", "b.draining", "animate dead", "teleport self"}, {"b.fire", "pain", "invisibility", "animate dead", "blink"} }},
: [262]={name="wizard", speed=10, hd=10, hplow=26, hphigh=55, ac=0, ev=13, attacks={ {dam=6, type="plain"} }, flags={ "spellcaster" }, resists={ magic=53 }, corpse="contaminated", xp=688, spells={ {"b.venom", "mystic blast", "invisibility", "confuse", "slow", "teleport self"}, {"magic dart", "paralyse", "haste", "b.lightning", "confuse", "teleport self"}, {"paralyse", "throw flame", "invisibility", "teleport other", "fireball"}, {"petrify", "crystal spear", "blink", "b.fire", "b.cold", "minor healing"}, {"stone arrow", "sting", "blink", "b.lightning", "banishment", "minor healing"} }},
: [263]={name="vault guard", speed=10, hd=13, hplow=54, hphigh=94, ac=1, ev=13, attacks={ {dam=20, type="plain"} }, flags={ "sense invisible" }, resists={ magic=52 }, corpse="contaminated", xp=1375},
: [205]={name="shapeshifter", speed=5, speedmax=30, hd=8, hplow=8, hphigh=110, ac=0, ev=10, attacks={ {dam=10, type="plain"} }, flags={ "!sil" }, resists={ magic=56 }, corpse="mutagenic", xp=366, spells={ "random" }},
: [111]={name="glowing shapeshifter", speed=3, speedmax=18, hd=9, hplow=24, hphigh=101, ac=0, ev=10, attacks={ {dam=45, type="plain"} }, flags={ "!sil" }, resists={ magic=80 }, corpse="mutagenic", xp=484, spells={ "random" }},
: [264]={name="Killer Klown", speed=13, hd=20, hplow=129, hphigh=171, ac=10, ev=15, attacks={ {dam=30, type="klown"} }, flags={ "evil", "see invisible", "regen", "!sil" }, resists={ magic=160, holy=-1 }, xp=6835, spells={ {"blink"} }},
: [404]={name="paladin", speed=10, hd=10, hplow=47, hphigh=81, ac=0, ev=10, attacks={ {dam=26, type="plain"} }, flags={ "holy", "spellcaster" }, resists={ magic=40, holy=1, rot=1, neg=3 }, xp=811},
: [133]={name="demonspawn", speed=10, hd=5, hplow=16, hphigh=39, ac=2, ev=12, attacks={ {dam=10, type="plain"} }, flags={ "demonic" }, resists={ magic=20, holy=-2, rot=1, neg=3, torment=1 }, corpse="contaminated", xp=130},
: [132]={name="demigod", speed=10, hd=5, hplow=26, hphigh=49, ac=2, ev=12, attacks={ {dam=10, type="plain"} }, flags={  }, resists={ magic=26 }, corpse="contaminated", xp=154},
: [129]={name="halfling", speed=10, hd=3, hplow=6, hphigh=15, ac=2, ev=12, attacks={ {dam=6, type="plain"} }, flags={  }, resists={ magic=8 }, corpse="contaminated", xp=30},
: [160]={name="pile of gold coins", speed=10, hd=8, hplow=30, hphigh=58, ac=5, ev=1, attacks={ {dam=12, type="poison"}, {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "non-living" }, resists={ magic=32, fire=1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=464},
: [161]={name="weapon mimic", speed=10, hd=8, hplow=27, hphigh=57, ac=5, ev=1, attacks={ {dam=17, type="poison"}, {dam=17, type="plain"}, {dam=17, type="plain"} }, flags={ "non-living" }, resists={ magic=32, fire=1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=491},
: [162]={name="armour mimic", speed=10, hd=8, hplow=30, hphigh=59, ac=15, ev=1, attacks={ {dam=12, type="poison"}, {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "non-living" }, resists={ magic=32, fire=1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=465},
: [163]={name="scroll mimic", speed=10, hd=8, hplow=30, hphigh=58, ac=5, ev=1, attacks={ {dam=12, type="poison"}, {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "non-living" }, resists={ magic=32, fire=1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=464},
: [164]={name="potion mimic", speed=10, hd=8, hplow=28, hphigh=57, ac=5, ev=1, attacks={ {dam=12, type="poison"}, {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "non-living" }, resists={ magic=32, fire=1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=464},
: [165]={name="door mimic", speed=10, hd=8, hplow=29, hphigh=58, ac=5, ev=1, attacks={ {dam=12, type="poison"}, {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "non-living" }, resists={ magic=32, fire=1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=466},
: [166]={name="portal mimic", speed=10, hd=8, hplow=28, hphigh=59, ac=5, ev=1, attacks={ {dam=12, type="poison"}, {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "non-living" }, resists={ magic=32, fire=1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=466},
: [168]={name="stair mimic", speed=10, hd=8, hplow=28, hphigh=58, ac=5, ev=1, attacks={ {dam=12, type="poison"}, {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "non-living" }, resists={ magic=32, fire=1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=467},
: [169]={name="shop mimic", speed=10, hd=8, hplow=28, hphigh=58, ac=5, ev=1, attacks={ {dam=12, type="poison"}, {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "non-living" }, resists={ magic=32, fire=1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=465},
: [170]={name="fountain mimic", speed=10, hd=8, hplow=28, hphigh=58, ac=5, ev=1, attacks={ {dam=12, type="poison"}, {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "non-living" }, resists={ magic=32, fire=1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=467},
: [90]={name="dancing weapon", speed=12, speedmax=19, hd=15, hplow=16, hphigh=54, ac=12, ev=17, attacks={ {dam=20, type="plain"} }, flags={ "non-living", "lev" }, resists={ magic=5000, fire=2, cold=2, elec=3, poison=1, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=1133},
: [352]={name="eldritch tentacle", speed=12, hd=16, hplow=97, hphigh=145, ac=13, ev=0, attacks={ {dam=30, type="chaoselec 16-23"}, {dam=40, type="chaoselec 16-23"} }, flags={ "non-living", "amphibious", "see invisible", "lev" }, resists={ magic=5000, hellfire=1, cold=3, elec=3, poison=3, acid=3, steam=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=3170},
: [353]={name="eldritch tentacle segment", speed=12, hd=16, hplow=97, hphigh=145, ac=13, ev=0, attacks={  }, flags={ "non-living", "amphibious", "see invisible", "lev" }, resists={ magic=5000, hellfire=1, cold=3, elec=3, poison=3, acid=3, steam=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=0},
: [303]={name="imp", speed=10, hd=3, hplow=9, hphigh=18, ac=3, ev=14, attacks={ {dam=4, type="plain"} }, flags={ "demonic", "fly", "regen", "!sil" }, resists={ magic=36, hellfire=1, cold=-1, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=48, spells={ {"blink"} }},
: [304]={name="quasit", speed=13, hd=3, hplow=6, hphigh=24, ac=5, ev=17, attacks={ {dam=3, type="drain dexterity"}, {dam=2, type="drain dexterity"}, {dam=2, type="drain dexterity"} }, flags={ "demonic" }, resists={ magic=5, fire=1, cold=1, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=45},
: [305]={name="white imp", speed=10, hd=2, hplow=6, hphigh=16, ac=4, ev=10, attacks={ {dam=4, type="cold 2-5"} }, flags={ "demonic", "fly", "!sil" }, resists={ magic=8, fire=-1, cold=2, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=10, spells={ {"throw frost"} }},
: [306]={name="lemure", speed=12, hd=2, hplow=6, hphigh=16, ac=1, ev=12, attacks={ {dam=5, type="plain"}, {dam=3, type="plain"}, {dam=3, type="plain"} }, flags={ "demonic", "regen" }, resists={ magic=8, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=13},
: [307]={name="ufetubus", speed=15, hd=1, hplow=4, hphigh=10, ac=2, ev=15, attacks={ {dam=5, type="plain"}, {dam=5, type="plain"} }, flags={ "demonic" }, resists={ magic=4, fire=-1, cold=1, holy=-2, rot=1, neg=3, torment=1 }, xp=8},
: [308]={name="iron imp", speed=8, hd=3, hplow=9, hphigh=24, ac=6, ev=8, attacks={ {dam=12, type="plain"} }, flags={ "demonic" }, resists={ magic=12, hellfire=1, cold=1, elec=2, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=40},
: [309]={name="midge", speed=10, hd=2, hplow=6, hphigh=16, ac=4, ev=10, attacks={ {dam=8, type="blink"} }, flags={ "demonic", "fly" }, resists={ magic=8, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=13},
: [310]={name="shadow imp", speed=10, hd=2, hplow=6, hphigh=16, ac=3, ev=11, attacks={ {dam=6, type="plain"} }, flags={ "demonic", "evil", "see invisible", "!sil" }, resists={ magic=8, cold=2, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=11, spells={ {"pain", "animate dead"} }},
: [311]={name="red devil", speed=10, hd=5, hplow=17, hphigh=38, ac=10, ev=10, attacks={ {dam=18, type="plain"} }, flags={ "demonic", "fly" }, resists={ magic=46, hellfire=1, cold=-1, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=130},
: [312]={name="rotting devil", speed=10, hd=5, hplow=16, hphigh=39, ac=2, ev=10, attacks={ {dam=8, type="rot"} }, flags={ "demonic" }, resists={ magic=46, cold=1, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=105},
: [325]={name="hairy devil", speed=10, hd=7, hplow=24, hphigh=52, ac=7, ev=10, attacks={ {dam=12, type="plain"}, {dam=12, type="plain"} }, flags={ "demonic" }, resists={ magic=37, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=224},
: [314]={name="sixfirhy", speed=40, speedextra={move=60}, hd=7, hplow=24, hphigh=52, ac=2, ev=20, attacks={ {dam=15, type="elec 7-9"} }, flags={ "demonic" }, resists={ magic=56, holy=-2, rot=1, neg=3, torment=1 }, xp=504},
: [313]={name="hellwing", speed=10, hd=7, hplow=31, hphigh=59, ac=8, ev=10, attacks={ {dam=17, type="plain"}, {dam=10, type="plain"} }, flags={ "demonic", "evil", "fly", "regen", "!sil" }, resists={ magic=56, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=390, spells={ {"teleport other", "animate dead", "teleport self"} }},
: [317]={name="smoke demon", speed=9, hd=7, hplow=24, hphigh=52, ac=5, ev=9, attacks={ {dam=8, type="plain"}, {dam=5, type="plain"}, {dam=5, type="plain"} }, flags={ "demonic", "lev", "!sil" }, resists={ magic=56, fire=2, poison=1, holy=-2, steam=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=315, spells={ {"sticky flame range", "steam ball", "smiting"} }},
: [322]={name="tormentor", speed=13, hd=7, hplow=24, hphigh=52, ac=12, ev=12, attacks={ {dam=8, type=""}, {dam=8, type=""} }, flags={ "demonic", "evil", "fly", "!sil" }, resists={ magic=56, fire=1, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=414, spells={ {"pain", "torment symbol"} }},
: [327]={name="blue devil", speed=10, hd=7, hplow=24, hphigh=52, ac=14, ev=10, attacks={ {dam=21, type="plain"} }, flags={ "demonic", "fly" }, resists={ magic=46, fire=-1, cold=3, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=224},
: [329]={name="iron devil", speed=8, hd=8, hplow=29, hphigh=58, ac=16, ev=8, attacks={ {dam=14, type="plain"}, {dam=14, type="plain"} }, flags={ "demonic" }, resists={ magic=64, hellfire=1, cold=1, elec=2, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=324},
: [315]={name="neqoxec", speed=10, hd=6, hplow=20, hphigh=46, ac=4, ev=12, attacks={ {dam=15, type="plain"} }, flags={ "demonic", "evil", "lev", "!sil" }, resists={ magic=48, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=183, spells={ {"polymorph other", "brain feed", "call imp"} }},
: [316]={name="orange demon", speed=10, hd=8, hplow=37, hphigh=66, ac=3, ev=7, attacks={ {dam=8, type="plain"}, {dam=10, type=""} }, flags={ "demonic" }, resists={ magic=64, holy=-2, rot=1, neg=3, torment=1 }, xp=416},
: [318]={name="ynoxinul", speed=10, hd=6, hplow=20, hphigh=46, ac=3, ev=10, attacks={ {dam=12, type="plain"} }, flags={ "demonic", "sense invisible", "fly", "!sil" }, resists={ magic=48, cold=1, elec=2, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=198, spells={ {"iron shot", "ufetubus"} }},
: [336]={name="shadow demon", speed=11, hd=6, hplow=20, hphigh=46, ac=7, ev=12, attacks={ {dam=21, type="plain"} }, flags={ "demonic", "see invisible" }, resists={ magic=56, cold=2, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=198},
: [319]={name="chaos spawn", speed=11, hd=6, hplow=20, hphigh=46, ac=7, ev=12, attacks={ {dam=21, type="chaoselec 6-8"} }, flags={ "demonic", "see invisible" }, resists={ magic=56, holy=-2, rot=1, neg=3, torment=1 }, xp=198},
: [328]={name="beast", speed=10, speedmax=17, hd=7, hplow=39, hphigh=98, ac=4, ev=9, attacks={ {dam=28, type="plain"}, {dam=20, type="plain"} }, flags={ "demonic" }, resists={ magic=28, holy=-2, rot=1, neg=3, torment=1 }, xp=287},
: [320]={name="hellion", speed=12, hd=7, hplow=24, hphigh=52, ac=5, ev=10, attacks={ {dam=10, type="plain"} }, flags={ "demonic", "!sil" }, resists={ magic=65, hellfire=1, cold=-1, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=600, spells={ {"hellfire burst"} }},
: [335]={name="sun demon", speed=12, hd=10, hplow=37, hphigh=73, ac=10, ev=12, attacks={ {dam=30, type="fire 10-19"} }, flags={ "demonic", "sense invisible", "lev" }, resists={ magic=80, hellfire=1, cold=-1, elec=1, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=918},
: [323]={name="reaper", speed=10, hd=8, hplow=28, hphigh=58, ac=15, ev=10, attacks={ {dam=32, type="plain"} }, flags={ "demonic", "see invisible" }, resists={ magic=5000, cold=1, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=442},
: [324]={name="soul eater", speed=10, hd=11, hplow=43, hphigh=78, ac=18, ev=10, attacks={ {dam=25, type="drain"} }, flags={ "demonic", "evil", "see invisible", "lev" }, resists={ magic=146, cold=1, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=858},
: [326]={name="ice devil", speed=10, hd=11, hplow=43, hphigh=78, ac=12, ev=10, attacks={ {dam=16, type="cold 11-32"} }, flags={ "demonic" }, resists={ magic=88, fire=-1, cold=3, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=788},
: [321]={name="Lorocyproca", speed=9, hd=12, hplow=46, hphigh=86, ac=10, ev=12, attacks={ {dam=25, type="plain"}, {dam=25, type="plain"} }, flags={ "demonic", "sense invisible" }, resists={ magic=112, fire=1, cold=1, elec=1, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=501},
: [338]={name="Fiend", speed=10, hd=18, hplow=77, hphigh=121, ac=15, ev=6, attacks={ {dam=25, type="plain"}, {dam=15, type="plain"}, {dam=15, type="plain"} }, flags={ "demonic", "evil", "see invisible", "fly", "!sil" }, resists={ magic=288, hellfire=1, cold=-1, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=4695, spells={ {"hellfire", "torment symbol", "melee"} }},
: [339]={name="Ice Fiend", speed=10, hd=18, hplow=77, hphigh=121, ac=15, ev=6, attacks={ {dam=25, type="cold 18-53"}, {dam=25, type="cold 18-53"} }, flags={ "demonic", "evil", "see invisible", "fly", "!sil" }, resists={ magic=288, fire=-1, cold=3, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=3022, spells={ {"b.cold", "torment symbol", "demon"} }},
: [340]={name="Shadow Fiend", speed=10, hd=18, hplow=77, hphigh=121, ac=15, ev=6, attacks={ {dam=25, type=""}, {dam=15, type="drain"}, {dam=15, type="drain"} }, flags={ "demonic", "evil", "see invisible", "lev", "!sil" }, resists={ magic=312, cold=2, elec=1, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=2771, spells={ {"b.cold", "b.draining", "torment symbol", "dispel undead", "demon"} }},
: [337]={name="Pit Fiend", speed=8, hd=19, hplow=99, hphigh=148, ac=17, ev=5, attacks={ {dam=28, type="plain"}, {dam=21, type="plain"}, {dam=21, type="plain"} }, flags={ "demonic", "evil", "see invisible", "fly", "!sil" }, resists={ magic=304, hellfire=1, cold=1, elec=2, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=4470, spells={ {"hellfire", "melee", "torment symbol"} }},
: [330]={name="Executioner", speed=20, hd=12, hplow=46, hphigh=86, ac=10, ev=15, attacks={ {dam=30, type="plain"}, {dam=10, type="plain"}, {dam=10, type="plain"} }, flags={ "demonic", "evil", "see invisible", "!sil" }, resists={ magic=144, fire=1, cold=1, elec=1, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=2373, spells={ {"pain", "haste"} }},
: [331]={name="Green Death", speed=11, hd=13, hplow=54, hphigh=93, ac=5, ev=7, attacks={ {dam=32, type="plain"} }, flags={ "demonic", "see invisible", "!sil" }, resists={ magic=156, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=1637, spells={ {"poison arrow", "poisonous cloud", "b.venom", "blink"} }},
: [332]={name="Blue Death", speed=11, hd=12, hplow=46, hphigh=86, ac=10, ev=10, attacks={ {dam=20, type="plain"}, {dam=20, type="plain"} }, flags={ "demonic", "see invisible", "fly", "!sil" }, resists={ magic=144, fire=-1, cold=2, elec=2, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=1525, spells={ {"b.lightning", "b.cold", "shadow creatures", "teleport other"} }},
: [333]={name="Balrug", speed=11, hd=14, hplow=56, hphigh=97, ac=5, ev=12, attacks={ {dam=25, type="fire 14-27"} }, flags={ "demonic", "see invisible", "fly", "!sil" }, resists={ magic=168, hellfire=1, cold=-1, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=2482, spells={ {"b.fire", "fireball", "sticky flame range", "smiting", "teleport self"} }},
: [334]={name="Cacodemon", speed=10, hd=13, hplow=80, hphigh=119, ac=11, ev=10, attacks={ {dam=22, type="plain"}, {dam=22, type="plain"} }, flags={ "demonic", "see invisible", "lev", "regen", "!sil" }, resists={ magic=156, elec=3, poison=3, holy=-2, rot=1, neg=3, torment=1 }, xp=1891, spells={ {"b.energy", "slow", "polymorph other", "confuse", "demon"} }},
: [143]={name="clay golem", speed=8, hd=8, hplow=58, hphigh=77, ac=7, ev=5, attacks={ {dam=11, type="plain"}, {dam=11, type="plain"} }, flags={ "non-living", "see invisible" }, resists={ magic=5000, fire=3, cold=3, elec=3, poison=3, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=185},
: [144]={name="wood golem", speed=10, hd=6, hplow=36, hphigh=53, ac=5, ev=6, attacks={ {dam=10, type="plain"} }, flags={ "non-living" }, resists={ magic=5000, fire=-1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=189},
: [145]={name="stone golem", speed=7, hd=12, hplow=92, hphigh=124, ac=12, ev=4, attacks={ {dam=28, type="plain"} }, flags={ "non-living" }, resists={ magic=5000, fire=3, cold=3, elec=3, poison=3, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=493},
: [146]={name="iron golem", speed=7, hd=15, hplow=118, hphigh=151, ac=15, ev=3, attacks={ {dam=35, type="plain"} }, flags={ "non-living" }, resists={ magic=5000, fire=3, cold=3, elec=3, poison=3, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=915},
: [147]={name="crystal golem", speed=7, hd=13, hplow=101, hphigh=134, ac=22, ev=3, attacks={ {dam=40, type="plain"} }, flags={ "non-living", "see invisible" }, resists={ magic=5000, fire=3, cold=3, elec=3, poison=3, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=614},
: [148]={name="toenail golem", speed=8, hd=9, hplow=47, hphigh=68, ac=8, ev=5, attacks={ {dam=13, type="plain"} }, flags={ "non-living" }, resists={ magic=5000, fire=1, cold=1, elec=1, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=205},
: [149]={name="electric golem", speed=16, hd=15, hplow=118, hphigh=151, ac=5, ev=20, attacks={ {dam=15, type="elec 15-21"}, {dam=15, type="elec 15-21"}, {dam=15, type="plain"}, {dam=15, type="plain"} }, flags={ "non-living", "see invisible", "!sil" }, resists={ magic=160, fire=1, cold=1, elec=3, poison=3, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=5402, spells={ {"b.lightning", "blink"} }},
: [300]={name="ice statue", speed=16, hd=8, hplow=70, hphigh=70, ac=12, ev=1, attacks={  }, flags={ "non-living", "!sil" }, resists={ magic=5000, fire=-1, cold=3, elec=2, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=685, spells={ {"b.cold", "throw icicle", "freezing cloud", "ice beast"} }},
: [299]={name="silver statue", speed=10, hd=6, hplow=150, hphigh=150, ac=15, ev=1, attacks={  }, flags={ "non-living" }, resists={ magic=5000, fire=2, cold=2, elec=2, poison=2, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=90},
: [298]={name="orange crystal statue", speed=6, hd=10, hplow=160, hphigh=160, ac=20, ev=1, attacks={  }, flags={ "non-living" }, resists={ magic=5000, fire=2, cold=2, elec=2, poison=2, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=150},
: [301]={name="statue", speed=10, hd=8, hplow=70, hphigh=70, ac=12, ev=1, attacks={ {dam=20, type="plain"} }, flags={ "non-living" }, resists={ magic=5000, fire=2, cold=2, elec=2, poison=2, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=561},
: [302]={name="training dummy", speed=10, hd=1, hplow=6, hphigh=6, ac=0, ev=0, attacks={ {dam=1, type="plain"} }, flags={ "non-living" }, resists={ magic=5000, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=2},
: [494]={name="pillar of salt shaped pillar of salt", speed=10, hd=1, hplow=1, hphigh=1, ac=1, ev=0, attacks={  }, flags={ "non-living" }, resists={ magic=5000, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=0},
: [134]={name="gargoyle", speed=10, hd=4, hplow=12, hphigh=32, ac=18, ev=6, attacks={ {dam=10, type="plain"}, {dam=6, type="plain"}, {dam=6, type="plain"} }, flags={ "non-living", "fly" }, resists={ magic=32, elec=2, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=142},
: [135]={name="metal gargoyle", speed=7, hd=8, hplow=29, hphigh=58, ac=20, ev=4, attacks={ {dam=19, type="plain"}, {dam=10, type="plain"}, {dam=10, type="plain"} }, flags={ "non-living", "fly" }, resists={ magic=64, elec=2, poison=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=205},
: [136]={name="molten gargoyle", speed=10, hd=5, hplow=16, hphigh=39, ac=14, ev=7, attacks={ {dam=12, type="fire 5-9"}, {dam=8, type="plain"}, {dam=8, type="plain"} }, flags={ "non-living", "fly" }, resists={ magic=40, fire=3, elec=1, poison=1, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=171},
: [341]={name="pandemonium lord", speed=9, speedmax=17, hd=16, hplow=111, hphigh=245, ac=14, ev=14, attacks={ {dam=38, type="plain"} }, flags={ "demonic", "!sil" }, resists={ magic=126, fire=2, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=5999, spells={ "random" }},
: [485]={name="hell lord", speed=10, hd=19, hplow=142, hphigh=213, ac=1, ev=2, attacks={ {dam=5, type="plain"} }, flags={ "demonic" }, resists={ magic=126, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=4143},
: [483]={name="ball lightning", speed=20, hd=12, hplow=1, hphigh=1, ac=0, ev=10, attacks={ {dam=5, type="plain"} }, flags={ "non-living", "lev", "!sil" }, resists={ magic=5000, fire=3, cold=3, elec=3, poison=3, steam=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, wind=1, petrify=1 }, xp=1024, spells={ {"b.lightning"} }},
: [179]={name="giant spore", speed=15, hd=1, hplow=1, hphigh=1, ac=0, ev=10, attacks={ {dam=1, type="plain"} }, flags={ "plant", "lev" }, resists={ magic=4, poison=1, asphyx=1, drown=1, neg=3 }, xp=1},
: [150]={name="orb of fire", speed=15, hd=30, hplow=150, hphigh=150, ac=20, ev=20, attacks={  }, flags={ "non-living", "see invisible", "lev", "!sil" }, resists={ magic=5000, hellfire=1, cold=1, elec=3, poison=3, steam=1, sticky_flame=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=11437, spells={ {"b.fire", "polymorph other", "fireball"} }},
: [484]={name="orb of destruction", speed=30, hd=5, hplow=1000, hphigh=1000, ac=0, ev=10, attacks={  }, flags={ "non-living", "lev" }, resists={ magic=5000, hellfire=1, cold=3, elec=3, poison=3, acid=3, steam=1, sticky_flame=2, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=0},
: [400]={name="blessed toe", speed=10, speedextra={move=200}, hd=14, hplow=77, hphigh=77, ac=50, ev=1, attacks={  }, flags={ "holy", "see invisible", "lev", "!sil" }, resists={ magic=5000, cold=1, elec=2, poison=1, holy=1, rot=1, neg=3 }, xp=4953, spells={ {"holies", "heal other", "holy word"} }},
: [399]={name="silver star", speed=15, hd=30, hplow=150, hphigh=150, ac=20, ev=20, attacks={  }, flags={ "holy", "see invisible", "lev" }, resists={ magic=5000, hellfire=1, cold=1, elec=3, poison=3, holy=1, steam=1, sticky_flame=1, rot=3, neg=3, petrify=1 }, xp=11437},
: [385]={name="death cob", speed=25, hd=10, hplow=47, hphigh=83, ac=10, ev=15, attacks={ {dam=20, type="plain"} }, flags={ "undead", "evil" }, resists={ magic=40, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=1272},
: [472]={name="Mennas", speed=15, hd=19, hplow=150, hphigh=150, ac=15, ev=28, attacks={ {dam=30, type="plain"}, {dam=20, type="plain"} }, flags={ "holy", "spellcaster", "see invisible", "fly" }, resists={ magic=202, elec=2, poison=1, holy=1, rot=1, neg=3 }, xp=6578, spells={ {"confuse", "silence", "minor healing"} }},
: [456]={name="Nessos", speed=15, hd=9, hplow=72, hphigh=72, ac=4, ev=8, attacks={ {dam=16, type="plain"} }, flags={ "evil", "spellcaster" }, resists={ magic=36, holy=-1 }, xp=1136, spells={ {"blink range", "haste", "animate dead"} }},
: [477]={name="Chuck", speed=10, hd=18, hplow=120, hphigh=120, ac=14, ev=2, attacks={ {dam=45, type="plain"} }, flags={  }, resists={ magic=96, drown=1 }, corpse="contaminated", xp=3023},
: [478]={name="the iron giant", speed=10, hd=22, hplow=220, hphigh=220, ac=18, ev=2, attacks={ {dam=60, type="plain"} }, flags={ "!sil" }, resists={ magic=117, fire=1, cold=1, poison=1, drown=1 }, corpse="contaminated", xp=7793, spells={ {"iron shot", "iron elementals"} }},
: [445]={name="Polyphemus", speed=8, hd=12, hplow=105, hphigh=105, ac=7, ev=3, attacks={ {dam=35, type="plain"}, {dam=30, type="plain"} }, flags={  }, resists={ magic=48, drown=1 }, xp=1191},
: [409]={name="Antaeus", speed=10, hd=22, hplow=700, hphigh=700, ac=28, ev=4, attacks={ {dam=75, type="cold 22-65"}, {dam=30, type="cold 22-65"} }, flags={ "demonic", "amphibious", "!sil" }, resists={ magic=264, fire=-1, cold=2, elec=2, holy=-2, drown=1, rot=1, neg=3, torment=1 }, xp=15000, spells={ {"b.cold", "b.lightning"} }},
: [447]={name="Tiamat", speed=10, hd=22, hplow=380, hphigh=380, ac=25, ev=10, attacks={ {dam=60, type="plain"}, {dam=45, type="plain"} }, flags={ "cold-blooded", "see invisible", "fly", "!sil" }, resists={ magic=146, cold=1, poison=1 }, xp=13593, spells={ {"b.lightning"}, {"b.quicksilver"}, {"cold breath"}, {"fire breath"}, {"poisonous cloud"} }},
: [440]={name="Xtahua", speed=10, hd=19, hplow=133, hphigh=133, ac=15, ev=7, attacks={ {dam=35, type="plain"}, {dam=17, type="plain"}, {dam=20, type="plain"} }, flags={ "see invisible", "fly", "!sil" }, resists={ magic=177, fire=2, cold=-1, poison=1, steam=1, drown=1 }, corpse="contaminated", xp=5449, spells={ {"flame blast"} }},
: [457]={name="the Lernaean hydra", speed=10, speedextra={swim=60}, hd=30, hplow=150, hphigh=150, ac=0, ev=5, attacks={ {dam=18, type="plain per head"} }, flags={ "amphibious", "cold-blooded", "regen" }, resists={ magic=120, poison=1, drown=1 }, corpse="poison+contam", xp=7599},
: [417]={name="Serpent of Hell", speed=14, hd=20, hplow=101, hphigh=140, ac=12, ev=9, attacks={ {dam=35, type="plain"}, {dam=15, type="plain"}, {dam=15, type="plain"} }, flags={ "demonic", "sense invisible", "fly", "!sil" }, resists={ magic=346, hellfire=1, fire=3, poison=1, holy=-2, steam=1, drown=1, rot=1, neg=3, torment=1 }, xp=10779, spells={ {"hellfire", "fire breath"} }},
: [463]={name="Duvessa", speed=10, hd=4, hplow=35, hphigh=35, ac=2, ev=9, attacks={ {dam=10, type="plain"} }, flags={  }, resists={ magic=32 }, corpse="contaminated", xp=103},
: [464]={name="Dowan", speed=10, hd=3, hplow=25, hphigh=25, ac=0, ev=13, attacks={ {dam=5, type="plain"} }, flags={ "spellcaster" }, resists={ magic=24 }, corpse="contaminated", xp=46, spells={ {"throw frost", "corona", "blink", "throw flame", "haste other", "minor healing"} }},
: [453]={name="Prince Ribbit", speed=14, speedextra={swim=60}, hd=6, hplow=40, hphigh=40, ac=0, ev=16, attacks={ {dam=20, type="plain"} }, flags={ "amphibious", "spellcaster", "cold-blooded" }, resists={ magic=40, drown=1 }, corpse="contaminated", xp=302, spells={ {"blink", "teleport self"} }},
: [418]={name="Ijyb", speed=10, hd=3, hplow=28, hphigh=28, ac=2, ev=12, attacks={ {dam=4, type="plain"} }, flags={  }, resists={ magic=12 }, corpse="contaminated", xp=25},
: [460]={name="Grum", speed=10, hd=4, hplow=40, hphigh=40, ac=2, ev=9, attacks={ {dam=20, type="plain"} }, flags={  }, resists={ magic=16 }, corpse="contaminated", xp=188},
: [471]={name="Crazy Yiuf", speed=10, hd=3, hplow=20, hphigh=20, ac=2, ev=9, attacks={ {dam=9, type="plain"} }, flags={  }, resists={ magic=12 }, corpse="contaminated", xp=41},
: [434]={name="Agnes", speed=18, hd=11, hplow=100, hphigh=100, ac=0, ev=20, attacks={ {dam=30, type="plain"} }, flags={ "see invisible" }, resists={ magic=102 }, corpse="contaminated", xp=2973},
: [411]={name="royal jelly", speed=14, hd=21, hplow=230, hphigh=230, ac=8, ev=4, attacks={ {dam=50, type="acid 7d3"}, {dam=30, type="acid 7d3"} }, flags={ "sense invisible" }, resists={ magic=196, poison=1, acid=3, asphyx=1, asphyx=1 }, xp=15000},
: [458]={name="Dissolution", speed=8, hd=12, hplow=180, hphigh=180, ac=10, ev=1, attacks={ {dam=50, type="acid 7d3"}, {dam=30, type="acid 7d3"} }, flags={ "sense invisible", "regen" }, resists={ magic=112, poison=1, acid=3, asphyx=1, asphyx=1 }, xp=1583, spells={ {"eyeballs"} }},
: [465]={name="Gastronok", speed=5, hd=20, hplow=150, hphigh=150, ac=2, ev=1, attacks={ {dam=40, type="plain"} }, flags={ "amphibious", "spellcaster", "see invisible" }, resists={ magic=80, drown=1 }, corpse="poisonous", xp=2131, spells={ {"airstrike", "slow", "swiftness", "small mammals", "cantrip"} }},
: [449]={name="Sonja", speed=14, hd=6, hplow=30, hphigh=30, ac=2, ev=24, attacks={ {dam=9, type="plain"}, {dam=5, type="plain"}, {dam=5, type="plain"} }, flags={ "spellcaster" }, resists={ magic=8 }, corpse="poisonous", xp=315, spells={ {"blink", "teleport self"} }},
: [470]={name="Pikel", speed=10, hd=6, hplow=40, hphigh=40, ac=4, ev=12, attacks={ {dam=9, type="plain"} }, flags={  }, resists={ magic=24 }, corpse="poisonous", xp=651},
: [444]={name="Boris", speed=10, hd=22, hplow=154, hphigh=154, ac=12, ev=10, attacks={ {dam=25, type="plain"}, {dam=15, type="drain"} }, flags={ "undead", "evil", "spellcaster", "see invisible" }, resists={ magic=322, cold=1, elec=2, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=7917, spells={ {"iron shot", "b.cold", "invisibility", "animate dead", "destruction orb"} }},
: [462]={name="Menkaure", speed=8, hd=3, hplow=24, hphigh=24, ac=3, ev=6, attacks={ {dam=25, type="plain"} }, flags={ "undead", "evil", "spellcaster", "see invisible" }, resists={ magic=20, fire=-1, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=154, spells={ {"pain", "haste", "torment symbol"} }},
: [467]={name="Khufu", speed=10, hd=18, hplow=240, hphigh=240, ac=10, ev=6, attacks={ {dam=35, type="plain"} }, flags={ "undead", "evil", "spellcaster", "see invisible" }, resists={ magic=5000, cold=1, elec=2, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=12953, spells={ {"demon", "smiting", "torment symbol", "summon undead", "doroklohe tomb"} }},
: [452]={name="Ilsuiw", speed=10, speedextra={swim=60}, hd=16, hplow=150, hphigh=150, ac=5, ev=18, attacks={ {dam=10, type="plain"} }, flags={ "amphibious", "spellcaster" }, resists={ magic=149, drown=1 }, corpse="contaminated", xp=2583, spells={ {"throw icicle", "call tide", "invisibility", "blink", "water elementals"} }},
: [425]={name="Erolcha", speed=10, hd=6, hplow=54, hphigh=54, ac=3, ev=7, attacks={ {dam=20, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=56 }, corpse="contaminated", xp=799, spells={ {"b.venom", "mystic blast", "invisibility", "confuse", "slow", "teleport self"}, {"magic dart", "paralyse", "haste", "b.lightning", "confuse", "teleport self"}, {"paralyse", "throw flame", "invisibility", "teleport other", "fireball"}, {"petrify", "crystal spear", "blink", "b.fire", "b.cold", "minor healing"}, {"stone arrow", "sting", "blink", "b.lightning", "banishment", "minor healing"} }},
: [422]={name="Blork the orc", speed=10, hd=3, hplow=32, hphigh=32, ac=0, ev=9, attacks={ {dam=7, type="plain"} }, flags={ "spellcaster" }, resists={ magic=16 }, corpse="contaminated", xp=82, spells={ {"throw frost", "cantrip", "haste", "throw flame", "magic dart", "invisibility"} }},
: [427]={name="Urug", speed=10, hd=6, hplow=66, hphigh=66, ac=0, ev=11, attacks={ {dam=12, type="plain"} }, flags={  }, resists={ magic=40 }, corpse="contaminated", xp=599},
: [454]={name="Nergalle", speed=10, hd=10, hplow=60, hphigh=60, ac=9, ev=11, attacks={ {dam=6, type="plain"} }, flags={ "evil", "spellcaster", "see invisible" }, resists={ magic=66, holy=-1 }, corpse="contaminated", xp=1025, spells={ {"b.draining", "spectral orcs", "dispel undead", "haste other", "teleport self"} }},
: [455]={name="Saint Roka", speed=10, hd=18, hplow=200, hphigh=200, ac=3, ev=10, attacks={ {dam=35, type="plain"} }, flags={ "evil" }, resists={ magic=72, holy=-1 }, corpse="contaminated", xp=8385, spells={ {"smiting"} }},
: [495]={name="Terpsichore", speed=10, hd=18, hplow=140, hphigh=140, ac=7, ev=25, attacks={ {dam=30, type="plain"} }, flags={ "undead", "evil", "spellcaster", "see invisible" }, resists={ magic=144, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=2407, spells={ {"ball", "swiftness", "corona", "blink", "cantrip"} }},
: [439]={name="Wiglaf", speed=10, hd=17, hplow=140, hphigh=140, ac=1, ev=10, attacks={ {dam=30, type="plain"} }, flags={  }, resists={ magic=113 }, corpse="contaminated", xp=2270, spells={ {"might", "haste"} }},
: [451]={name="Azrael", speed=10, hd=11, hplow=88, hphigh=88, ac=10, ev=5, attacks={ {dam=12, type="plain"} }, flags={ "demonic", "lev", "!sil" }, resists={ magic=44, fire=3, cold=-1, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=1588, spells={ {"b.fire", "sticky flame range", "fireball", "hellfire", "hellfire burst"} }},
: [473]={name="Mara", speed=10, hd=18, hplow=140, hphigh=140, ac=10, ev=14, attacks={ {dam=30, type="plain"} }, flags={ "demonic", "evil", "see invisible", "!sil" }, resists={ magic=144, fire=2, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=7145, spells={ {"blink", "mislead", "b.fire", "mara summon", "illusion", "pain", "teleport self"} }},
: [473]={name="Mara", speed=10, hd=18, hplow=140, hphigh=140, ac=10, ev=14, attacks={ {dam=30, type="plain"} }, flags={ "demonic", "evil", "see invisible", "!sil" }, resists={ magic=144, fire=2, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=7145, spells={ {"blink", "mislead", "b.fire", "mara summon", "illusion", "pain", "teleport self"} }},
: [469]={name="Aizul", speed=15, hd=14, hplow=142, hphigh=142, ac=8, ev=18, attacks={ {dam=25, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=112, poison=1 }, corpse="mutagenic", xp=2602, spells={ {"b.venom", "sleep", "poison arrow", "blink other"} }},
: [429]={name="Snorg", speed=10, hd=8, hplow=96, hphigh=96, ac=0, ev=10, attacks={ {dam=20, type="plain"}, {dam=15, type="plain"}, {dam=15, type="plain"} }, flags={ "regen" }, resists={ magic=64 }, corpse="contaminated", xp=1451},
: [461]={name="Purgy", speed=10, hd=5, hplow=35, hphigh=35, ac=1, ev=12, attacks={ {dam=9, type="plain"}, {dam=4, type="plain"}, {dam=4, type="plain"} }, flags={ "regen" }, resists={ magic=13 }, corpse="contaminated", xp=134},
: [476]={name="Jory", speed=10, hd=18, hplow=110, hphigh=110, ac=10, ev=15, attacks={ {dam=40, type="plain"}, {dam=15, type="vampiric"} }, flags={ "undead", "evil", "spellcaster", "see invisible" }, resists={ magic=168, cold=1, poison=1, holy=-2, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=3835, spells={ {"crystal spear", "mesmerise", "blink", "brain feed", "pain", "vampiric draining"} }},
: [479]={name="Nellie", speed=10, hd=20, hplow=240, hphigh=240, ac=13, ev=10, attacks={ {dam=45, type="plain"}, {dam=20, type="plain"}, {dam=15, type="plain"} }, flags={ "demonic", "!sil" }, resists={ magic=133, holy=-2, drown=1, rot=1, neg=3, torment=1 }, xp=4813, spells={ {"fire breath", "blink"} }},
: [446]={name="Murray", speed=10, hd=14, hplow=180, hphigh=180, ac=30, ev=10, attacks={ {dam=20, type="plain"}, {dam=20, type="plain"} }, flags={ "undead", "evil", "see invisible", "!sil" }, resists={ magic=5000, hellfire=1, cold=2, elec=2, poison=1, holy=-2, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1 }, xp=2600, spells={ {"summon undead", "torment symbol"} }},
: [499]={name="Ignacio", speed=20, hd=18, hplow=250, hphigh=250, ac=10, ev=15, attacks={ {dam=30, type="plain"}, {dam=15, type="plain"}, {dam=15, type="plain"} }, flags={ "demonic", "evil", "see invisible", "!sil" }, resists={ magic=216, fire=1, cold=1, elec=1, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=15000, spells={ {"agony", "pain", "haste", "torment symbol"} }},
: [475]={name="Grinder", speed=10, hd=6, hplow=40, hphigh=40, ac=3, ev=11, attacks={ {dam=11, type=""} }, flags={ "demonic", "evil", "see invisible", "!sil" }, resists={ magic=24, cold=2, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=322, spells={ {"pain", "paralyse", "blink"} }},
: [448]={name="Roxanne", speed=10, hd=14, hplow=180, hphigh=180, ac=20, ev=0, attacks={  }, flags={ "non-living", "spellcaster" }, resists={ magic=5000, fire=2, cold=2, elec=2, poison=2, steam=1, asphyx=1, drown=1, rot=3, neg=3, torment=1, petrify=1 }, xp=2672, spells={ {"crystal spear", "iron shot", "blink other close", "b.magma", "mystic blast", "stone arrow"} }},
: [421]={name="Terence", speed=10, hd=2, hplow=20, hphigh=20, ac=0, ev=10, attacks={ {dam=5, type="plain"} }, flags={  }, resists={ magic=8 }, corpse="contaminated", xp=18},
: [419]={name="Jessica", speed=10, hd=1, hplow=10, hphigh=10, ac=0, ev=10, attacks={ {dam=5, type="plain"} }, flags={ "evil", "spellcaster" }, resists={ magic=4, holy=-1 }, corpse="contaminated", xp=25, spells={ {"pain", "slow", "haste", "blink"} }},
: [420]={name="Sigmund", speed=10, hd=3, hplow=30, hphigh=30, ac=0, ev=11, attacks={ {dam=5, type="plain"} }, flags={ "spellcaster" }, resists={ magic=12 }, corpse="contaminated", xp=104, spells={ {"throw flame", "confuse", "invisibility", "magic dart"} }},
: [423]={name="Edmund", speed=10, hd=4, hplow=44, hphigh=44, ac=0, ev=10, attacks={ {dam=6, type="plain"} }, flags={  }, resists={ magic=21 }, corpse="contaminated", xp=164},
: [424]={name="Psyche", speed=13, hd=5, hplow=39, hphigh=39, ac=0, ev=12, attacks={ {dam=7, type="plain"} }, flags={ "spellcaster" }, resists={ magic=26 }, corpse="contaminated", xp=371, spells={ {"throw frost", "cantrip", "haste", "throw flame", "magic dart", "invisibility"} }},
: [426]={name="Donald", speed=10, hd=14, hplow=84, hphigh=84, ac=3, ev=10, attacks={ {dam=26, type="plain"} }, flags={ "amphibious" }, resists={ magic=93, drown=1 }, corpse="contaminated", xp=2423},
: [428]={name="Joseph", speed=10, hd=7, hplow=66, hphigh=66, ac=0, ev=10, attacks={ {dam=9, type="plain"} }, flags={  }, resists={ magic=46 }, corpse="contaminated", xp=610},
: [430]={name="Erica", speed=10, hd=9, hplow=64, hphigh=64, ac=0, ev=11, attacks={ {dam=10, type="plain"} }, flags={ "spellcaster" }, resists={ magic=60 }, corpse="contaminated", xp=1241, spells={ {"b.venom", "mystic blast", "invisibility", "confuse", "slow", "teleport self"} }},
: [431]={name="Josephine", speed=10, hd=9, hplow=69, hphigh=69, ac=0, ev=10, attacks={ {dam=11, type="plain"} }, flags={ "evil", "spellcaster" }, resists={ magic=60, holy=-1 }, corpse="contaminated", xp=1286, spells={ {"b.cold", "b.draining", "animate dead", "teleport self"} }},
: [432]={name="Harold", speed=10, hd=9, hplow=76, hphigh=76, ac=0, ev=8, attacks={ {dam=12, type="plain"} }, flags={ "spellcaster" }, resists={ magic=60 }, corpse="contaminated", xp=1238, spells={ {"b.fire", "blink"} }},
: [433]={name="Jozef", speed=10, hd=11, hplow=90, hphigh=90, ac=0, ev=9, attacks={ {dam=18, type="plain"} }, flags={ "spellcaster" }, resists={ magic=73 }, corpse="contaminated", xp=1666, spells={ {"teleport other", "minor healing", "b.venom", "slow"} }},
: [435]={name="Maud", speed=10, hd=13, hplow=118, hphigh=118, ac=0, ev=10, attacks={ {dam=24, type="plain"} }, flags={  }, resists={ magic=86 }, corpse="contaminated", xp=2167},
: [436]={name="Louise", speed=10, hd=13, hplow=106, hphigh=106, ac=0, ev=10, attacks={ {dam=17, type="plain"} }, flags={ "spellcaster" }, resists={ magic=86 }, corpse="contaminated", xp=2251, spells={ {"stone arrow", "sting", "blink", "b.lightning", "banishment", "minor healing"} }},
: [437]={name="Frances", speed=10, hd=14, hplow=121, hphigh=121, ac=0, ev=10, attacks={ {dam=29, type="plain"} }, flags={ "evil", "spellcaster", "see invisible" }, resists={ magic=93, holy=-1 }, corpse="contaminated", xp=2852, spells={ {"pain", "demon", "smiting", "animate dead", "minor healing"} }},
: [438]={name="Rupert", speed=10, hd=16, hplow=123, hphigh=123, ac=0, ev=10, attacks={ {dam=21, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=106 }, corpse="contaminated", xp=2993, spells={ {"paralyse", "confuse", "berserker rage"} }},
: [459]={name="Kirke", speed=10, hd=16, hplow=110, hphigh=110, ac=0, ev=10, attacks={ {dam=18, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=106 }, corpse="contaminated", xp=3233, spells={ {"porkalator", "slow", "ugly thing", "corona", "invisibility"} }},
: [441]={name="Norris", speed=10, hd=20, hplow=214, hphigh=214, ac=1, ev=9, attacks={ {dam=36, type="plain"} }, flags={ "evil", "spellcaster", "see invisible" }, resists={ magic=133, holy=-1 }, corpse="contaminated", xp=7343, spells={ {"brain feed", "smiting", "invisibility", "confuse", "paralyse", "minor healing"} }},
: [442]={name="Frederick", speed=10, hd=21, hplow=159, hphigh=159, ac=0, ev=10, attacks={ {dam=27, type="plain"} }, flags={ "evil", "spellcaster", "see invisible" }, resists={ magic=140, holy=-1 }, corpse="contaminated", xp=5373, spells={ {"mystic blast", "b.cold", "invisibility", "animate dead", "iron shot"} }},
: [443]={name="Margery", speed=10, hd=22, hplow=164, hphigh=164, ac=0, ev=10, attacks={ {dam=30, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=146 }, corpse="contaminated", xp=6882, spells={ {"b.fire", "fireball"} }},
: [450]={name="Eustachio", speed=10, hd=4, hplow=40, hphigh=40, ac=0, ev=13, attacks={ {dam=6, type="plain"} }, flags={ "spellcaster" }, resists={ magic=26 }, corpse="contaminated", xp=197, spells={ {"small mammals", "call imp", "blink"} }},
: [466]={name="Maurice", speed=10, hd=5, hplow=60, hphigh=60, ac=1, ev=13, attacks={ {dam=9, type=""} }, flags={ "spellcaster" }, resists={ magic=26 }, corpse="contaminated", xp=503, spells={ {"invisibility", "swiftness", "blink", "teleport self"} }},
: [468]={name="Nikola", speed=10, hd=18, hplow=190, hphigh=190, ac=1, ev=9, attacks={ {dam=20, type="plain"} }, flags={ "spellcaster", "see invisible" }, resists={ magic=120 }, corpse="contaminated", xp=4016, spells={ {"shock", "chain lightning", "blink", "b.lightning"} }},
: [413]={name="Mnoleg", speed=13, hd=17, hplow=350, hphigh=350, ac=10, ev=25, attacks={ {dam=35, type="mutation"}, {dam=23, type="blink"} }, flags={ "demonic", "see invisible", "!sil" }, resists={ magic=5000, fire=1, elec=2, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=15000, spells={ {"eyeballs", "smiting", "horrible things", "teleport self"} }},
: [414]={name="Lom Lobon", speed=10, hd=19, hplow=360, hphigh=360, ac=10, ev=20, attacks={ {dam=40, type=""} }, flags={ "demonic", "see invisible", "lev", "!sil" }, resists={ magic=5000, fire=1, cold=3, elec=3, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=11582, spells={ {"ice storm", "conjure ball lightning", "major healing", "blink range", "blink away"} }},
: [415]={name="Cerebov", speed=10, hd=21, hplow=650, hphigh=650, ac=30, ev=8, attacks={ {dam=60, type="plain"} }, flags={ "demonic", "see invisible", "!sil" }, resists={ magic=168, hellfire=1, poison=1, holy=-2, steam=1, drown=1, rot=1, neg=3, torment=1 }, xp=15000, spells={ {"fire storm", "iron shot", "haste", "greater demon"} }},
: [416]={name="Gloorx Vloq", speed=20, hd=16, hplow=350, hphigh=350, ac=10, ev=10, attacks={ {dam=45, type="plain"} }, flags={ "demonic", "evil", "see invisible", "lev", "!sil" }, resists={ magic=298, cold=1, elec=2, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=15000, spells={ {"poison arrow", "miasma", "torment symbol", "b.draining", "dispel undead", "invisibility"} }},
: [406]={name="Geryon", speed=10, hd=15, hplow=300, hphigh=300, ac=15, ev=6, attacks={ {dam=35, type="reach"} }, flags={ "demonic", "see invisible", "fly" }, resists={ magic=120, holy=-2, drown=1, rot=1, neg=3, torment=1 }, xp=6391, spells={ {"beast"} }},
: [407]={name="Dispater", speed=10, hd=16, hplow=450, hphigh=450, ac=40, ev=3, attacks={ {dam=50, type="plain"} }, flags={ "demonic", "see invisible", "!sil" }, resists={ magic=213, hellfire=1, cold=1, elec=3, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=13932, spells={ {"greater demon", "crystal spear", "iron shot", "hellfire"} }},
: [408]={name="Asmodeus", speed=10, hd=17, hplow=450, hphigh=450, ac=30, ev=7, attacks={ {dam=50, type="plain"} }, flags={ "demonic", "see invisible", "fly", "!sil" }, resists={ magic=272, hellfire=1, elec=1, poison=1, holy=-2, steam=1, rot=1, neg=3, torment=1 }, xp=15000, spells={ {"b.fire", "hellfire", "fire summon", "teleport self"} }},
: [410]={name="Ereshkigal", speed=14, hd=18, hplow=250, hphigh=250, ac=10, ev=30, attacks={ {dam=40, type="plain"} }, flags={ "demonic", "evil", "see invisible", "!sil" }, resists={ magic=240, cold=1, elec=2, poison=1, holy=-2, rot=1, neg=3, torment=1 }, xp=14085, spells={ {"b.draining", "b.cold", "greater demon", "torment symbol", "paralyse", "minor healing"} }},
: [503]={name="basilisk", speed=10, hd=5, hplow=21, hphigh=39, ac=3, ev=12, attacks={ {dam=20, type="plain"} }, flags={ "cold-blooded", "!sil" }, resists={ magic=20 }, corpse="poison+contam", xp=153, spells={ {"petrify"} }},
: }
:  --}}}
# -- code

: -- some tables:

: p = {}
: p.priority_monsters = {"ice beast","orc warrior","'s ghost",
: "Sigmund","Menkaure","hill giant","Pikel","war dog","orc priest",
: "orc wizard","Prince Ribbit","blink frog","Edmund","Nessos","Maud",
: "Grinder","Erolcha","Rupert","electric eel","Yiuf","ogre","troll",
: "Dowan","Duvessa","Nessos","giant eyeball","fire drake","dragon",
: "Sonja","berserk","spiny frog","Erica","Jozef","Harold","jelly","wasp"}
: p.scary_monsters = {"hydra","statue","Nessos","Nikola","Sonja"}
: p.hard_monsters = {"ice beast","orc warrior","'s ghost","Sigmund",
: "Menkaure","hill giant","Pikel","war dog","orc priest","Edmund",
: "Nessos","Maud","Erolcha","Rupert","goliath","electric eel","Yiuf",
: "ogre","troll","Duvessa","fire drake","dragon","berserk",
: "spiny frog","dire elephant","Erica","Jozef","Harold","jelly","red wasp"}
: p.hand_monsters = {"Grinder","Erolcha","Rupert"}
: p.no_flee_monsters = {"orc priest","Sigmund","electric eel",
: "Dowan","berserk","giant eyeball","centaur","Nessos","fire drake",
: "yaktaur","dragon","Blork","killer bee","Joseph","Erica","orc wizard"}
: p.easy_monsters = {"green rat","porcupine","quokka","megabat","fleeing"}
: p.resistance_monsters = {"fire drake","Nikola"}

: -- some variables:

: p.hold = false
: p.move = "none"
: p.travel_goal = "corpses"
:
: if you.race() ~= "Demigod" and you.god() == "No God" then
:   p.branch_goal = "Temple"
:   p.branch_command = "GT\r"
: else
:   p.branch_goal = "Lair"
:   p.branch_command = "GL\r"
: end
: crawl.mpr("branch goal: " .. p.branch_goal)
: if you.branch() == p.branch_goal then
:   p.branch_command = ""
: end

: p.potion_choice = {none}
: p.tries = 0
: p.last_turn = -1
: p.last_hand_turn = -100

: p.last_hp, p.last_mhp = you.hp()
: p.prev_hp = p.last_hp

: p.last_mp, p.last_mmp = you.mp()
: p.prev_mp = p.last_mp

: p.last_xl = 1
: p.failed_rest = false

: p.forbidden_stairs = "none"
: p.random_down = false
: p.last_where = you.where()
: p.last_absdepth = you.absdepth()

: p.stepped_on_lair = false

: p.is_berserk = you.berserk()

: p.dump_count = math.floor(you.turns() / 1000)
: p.death_count = 0

: p.max_hunger = "not hungry"

: p.bestidx = nil
: p.best2idx = nil -- clear LOF to this one
: p.currentmonsters = {}
: p.currentthreat = 0

: function goals()
:   crawl.mpr("p.move: "..p.move.." p.travel_goal: ".. p.travel_goal..
:   " branch_goal: "..p.branch_goal.." branch_command: "..p.branch_command)
: end

: function vegan()
:   return you.race() == "Spriggan"
: end

: function carnivore()
:   return you.race() == "Kobold" or you.race() == "Troll"
:         or you.race() == "Felid"
: end

: if carnivore() then
:   p.max_hunger = "completely stuffed"
: end

: function can_eat_chunks()
:   local hunger = you.hunger()
:   if not you.can_consume_corpses() then
:     return false
:   end
:   if you.race() == "Ghoul" then
:     return true
:   end
:   if carnivore() or wearing_gourmand() then
:     return not (hunger == "completely stuffed")
:   end
:   return not (hunger == "full" or hunger == "not hungry"
:       or hunger == "very full" or hunger == "completely stuffed")
: end

: -- ###############################################
: -- # checks for changes

: function update_stuff()
:   if you.turns() >= 1000*p.dump_count then
:     p.dump_count = p.dump_count+1
:     crawl.mpr("dumping in update stuff: " .. p.dump_count)
:     magic('#')
:   end
:
:   update_branch_goal()
:
:   local new_hp, new_mhp = you.hp()
:   local new_mp, new_mmp = you.mp()
:   if p.death_count < you.deaths() then
:     p.death_count = you.deaths()
:     p.is_berserk = false
:     say("Death " .. p.death_count .. " :/")
:   end
:   if p.is_berserk and not you.berserk() then
:     say("Berserk ended")
:     p.is_berserk = false
:   elseif (not p.is_berserk) and you.berserk() then
:     p.is_berserk = true
:   end
:
:   if not (p.last_where == you.where()) then
:     if p.random_down then
:       p.random_down = false
:       p.forbidden_stairs = "none"
:     elseif p.move == "autotravel" and p.travel_goal == "prev level"
:          and you.absdepth() == p.last_absdepth-1 then
:       p.random_down = true
:       p.forbidden_stairs = view.feature_at(0,0)
:     end
:   end
:   p.last_where = you.where()
:   p.last_absdepth = you.absdepth()
:
:   p.failed_rest = false
:
:   if p.last_turn == you.turns() then
:     if p.move == "rest" then
:       p.failed_rest = true
:     end
:     p.tries = p.tries + 1
:   else
:     p.tries = 0
:     if can_eat_chunks() then
:       p.travel_goal = "corpses"
:     else
:       p.travel_goal = "autoexplore"
:     end
:     p.last_turn = you.turns()
:     p.prev_hp = last_hp
:     p.prev_mp = last_mp
:   end
:   last_hp = new_hp
:   last_mhp = new_mhp
:   last_mp = new_mp
:   last_mmp = new_mmp
:   p.last_xl = you.xl()
:
:   update_monsters()
: end

: -- ##############################################
: -- # the main decision-making function and four subfunctions
: -- # tactical means at least one non-is_safe monster is in sight

: function choose_move()
:   if c_monsters(8) > 0 then
:     if p.is_berserk then
:       choose_berserk_tactical()
:     else
:       choose_calm_tactical()
:     end
:   else
:     if p.is_berserk then
:       choose_berserk_not_tactical()
:     else
:       choose_calm_not_tactical()
:     end
:   end
: end

: -- # this one is simple :)
: function choose_berserk_not_tactical()
:   crawl.mpr("berserk not tactical")
:   p.move = "wait"
: end

: function summoner()
:   return you.skill("Summonings") > 0
: end

: function caster()
:   return you.god() ~= "Trog" and # you.spells() > 0
: end

: function readytocast()
:   local minmp
:   local danger = assess_danger()
:   if danger > 2 then
:       minmp = 1.2
:   elseif danger > 1 then
:       minmp = 1
:   else
:       minmp = 0.7
:   end
:   if last_mp > 40 then
:       -- absolute minimum would be 12 mp when faced with tiny threats
:       minmp = minmp - 0.4
:   elseif last_mp > 30 then
:       minmp = minmp - 0.2
:   else
:       minmp = minmp + 0.1
:   end
:   minmp = math.min(minmp, 1)
:   crawl.mpr("ready to cast: " .. minmp .. " " .. last_mmp * minmp)
:   return last_mp >= last_mmp * minmp
: end

: function choose_berserk_tactical()
:   crawl.mpr("berserk tactical")
:   if c_bia(2) > 0 and p.last_hp*4 < p.last_mhp and is_good_retreat() then
:     crawl.mpr("berserk tact is good retreat fleeing")
:     p.move = "flee"
:   elseif is_reasonable_attack() then
:     p.move = "attack"
:   else
:     crawl.mpr("berserk tact not reasonable attack fleeing")
:     p.move = "flee"
:   end
: end

: -- should add in item use here, and also figure out about glass walls...
: -- assess_danger() is an important auxiliary function here
: function choose_calm_tactical()
:   crawl.mpr("calm tactical")
:   if (you.confused() or you.rotting()) and have_potion("healing") then
:     p.move = "drink potion"
:     p.potion_choice = "healing"
:     return
:   end
:   local danger = assess_danger()
:   local dist = monster_distance()
:   local x,y,m = get_target()
:   local spell = pick_spell(x,y,m)
:   if caster() and not spell and not readytocast() then
:     crawl.mpr("not readytocast fleeing")
:     p.move = "flee"
:   elseif danger >= 2 then
:     if c_bia(4) > 0 then
:       if can_berserk() then
:         p.move = "berserk"
:       else
:         crawl.mpr("danger 2, can't zerk -> fleeing")
:         p.move = "flee"
:       end
:     else
:       if can_bia() then
:         p.move = "bia"
:       elseif is_good_retreat() then
:         crawl.mpr("danger 2, is_good_retreat -> fleeing")
:         p.move = "flee"
:       elseif can_berserk() then
:         p.move = "berserk"
:       else
:         p.move = "attack"
:       end
:     end
:   elseif danger >= 1 then
:     if c_bia(4) > 0 then
:       if can_berserk() then
:         p.move = "berserk"
:       else
:         crawl.mpr("danger 1, can't zerk -> fleeing")
:         p.move = "flee"
:       end
:     elseif can_hand(true) and c_spec_monsters(8,p.hand_monsters) > 0 then
:       p.move = "hand"
:     elseif can_berserk() then
:       p.move = "berserk"
:     elseif can_bia() then
:       p.move = "bia"
:     elseif is_good_retreat() then
:       crawl.mpr("danger 1, is_good_retreat -> fleeing")
:       p.move = "flee"
:     else
:       p.move = "attack"
:     end
:   else
:     if can_hand(true) and c_spec_monsters(8,p.hand_monsters) > 0 then
:       p.move = "hand"
:     elseif you.exhausted() and (dist>1)
:         and is_good_retreat() then
:       p.move = "flee"
:     else
:       p.move = "attack"
:     end
:   end
:   if p.move == "flee" and c_monsters(1)==0
:       and p.last_hp*5<p.last_mhp and can_hand(false) and not you.sick() then
:     p.move = "hand"
:   end
: end

: -- should add in better travel here
: function choose_calm_not_tactical()
:   crawl.mpr("calm not tactical")
:   crawl.mpr("p.move: " .. p.move)
:   if you.poisoned() and can_cure_poison() then
:     p.move = "cure poison"
:   elseif you.rotting() and have_potion("healing") then
:     p.move = "drink potion"
:     p.potion_choice = "healing"
:   elseif you.poisoned() and last_hp<5 then
:     if have_potion("healing") then
:       p.move = "drink potion"
:       p.potion_choice = "healing"
:     elseif can_hand(false) and not you.sick() then
:       p.move = "hand"
:     elseif have_potion("heal wounds") then
:       p.move = "drink potion"
:       p.potion_choice = "heal wounds"
:     elseif have_unknown_potion() then
:       p.move = "try potion"
:     else
:       p.move = "rest"
:     end
:   elseif (p.last_hp < 3 or p.last_hp*10 < p.last_mhp) and can_hand(false)
:         and not you.sick() then
:     p.move = "hand"
:   elseif should_restore() then
:     p.move = "drink potion"
:     p.potion_choice = "restore abilities"
:   elseif have_potion("gain") then
:     p.move = "drink potion"
:     p.potion_choice = "gain"
:   elseif have_potion("experience") then
:     p.move = "drink potion"
:     p.potion_choice = "experience"
:   --elseif have_potion("of mutation") then
:   --  p.move = "drink potion"
:   --  p.potion_choice = "of mutation"
:   elseif (have_chunks(false) or on_chunks()) and can_eat_chunks() then
:     p.move = "eat chunks"
:   elseif on_corpses() and (you.god_likes_fresh_corpses() or can_eat_chunks()
:     or util.contains(you.spells(),"Sublimation of Blood")) then
:     if (not can_eat_chunks()
:         or on_dangerous_corpse() or you.levitating())
:         and not string.find(view.feature_at(0,0),"altar")
:         and you.god_likes_fresh_corpses() then
:       p.move = "pray"
:     elseif can_eat_chunks() or util.contains(you.spells(),"Sublimation of Blood") then
:       p.move = "chop"
:     else
:       crawl.mpr("stuck on a corpse?")
:     end
:   elseif you.hunger() == "hungry" and you.race() == "Spriggan" then
:     p.move = "eat permafood"
:   elseif (you.hunger() == "very hungry" or you.hunger() == "near starving"
:       or you.hunger() == "starving") and have_permafood()
:       and not on_corpses() then
:     p.move = "eat permafood"
:   elseif p.last_hp < p.last_mhp or you.confused() then
:     p.move = "rest"
:   elseif last_mp < last_mmp then
:     if can_sublimate() and last_mp < last_mmp - 2 then
:       p.move = "sublimate"
:     else
:       p.move = "rest"
:     end
:   elseif is_reasonable_ballisto_attack() then
:     p.move = "ballisto attack"
:   elseif you.exhausted() then
:     p.move = "rest"
:   elseif p.branch_goal == "Lair:1" and can_see_lair() then
:     p.move = "step towards Lair"
:   else
:     if p.tries >= 1 then
:       crawl.mpr("p.tries: " .. p.tries)
:       if p.travel_goal == "corpses" then
:         p.travel_goal = "autoexplore"
:       elseif p.travel_goal == "autoexplore" then
:         p.travel_goal = "branch"
:         if p.branch_command == "none" then
:           p.travel_goal = "next level"
:         end
:       elseif p.travel_goal == "branch" then
:         p.travel_goal = "next level"
:       elseif p.travel_goal == "next level" then
:         p.travel_goal = "prev level"
:       elseif p.travel_goal == "prev level" then
:         p.travel_goal = "stuck"
:       end
:        p.tries = 0
:     end
:     p.move = "autotravel"
:     if p.travel_goal == "next level" then
:       if have_useless() > 0 then
:         p.move = "drop useless"
:       elseif have_amulet() then
:         p.move = "wear amulet"
:       elseif have_ring() then
:         p.move = "wear ring"
:       end
:     end
:   end
: end

: -- #######################################
: -- # measures the danger of the monsters around, in a very crude way

: function assess_danger()
:   local approxstr = stepdown_value(you.xl(), 1, 2, 27, 6) * 100
:   return math.floor(p.currentthreat / approxstr)
: end

: function assess_danger_old()
:   if (c_ignore_spec_monsters(8,p.easy_monsters) > 6 and c_monsters(4) > 0)
:      or c_spec_monsters(4, p.scary_monsters) > 0 then
:     return 2
:   elseif (c_monsters(2) > 0 and c_monsters(8) > 3)
: or (c_ignore_spec_monsters(4,p.easy_monsters) > 0 and p.last_hp*2 < p.last_mhp)
: or c_spec_monsters(2, p.hard_monsters) > 0 then
:     return 1
:   else
:  return 0
:   end
: end

: -- #######################################
: -- # function that actually executes the move

: function make_move()
:   if p.move == "rest" then
:     if p.failed_rest then
:       magic('s')
:     else
:       magic('5')
:     end
:   elseif p.move == "flee" then
:     flee()
:   elseif p.move == "attack" then
:     local melee = melee_ok()
:     if caster() and p.currentthreat > 3 * you.xl() and melee then
:       ranged(melee)
:     else
:       local x,y,m = get_target()
:       if string.find(m:desc(), "fleeing") then
:         -- use ranged attack anyway vs running shit
:         ranged(melee)
:       else
:         if m then
:           crawl.mpr("melee instead! "..m:desc().." "..x.." "..y)
:         else
:           crawl.mpr("melee instead! no target! "..x.." "..y)
:         end
:         make_attack(x,y)
:       end
:     end
:   elseif p.move == "berserk" then
:     say("Berserk")
:     if wearing_rage() then
:       magic('af')
:     else
:       magic('aa')
:     end
:   elseif p.move == "bia" then
:     say("Attempting Brothers in Arms")
:     magic('ac')
:   elseif p.move == "hand" then
:     p.last_hand_turn = you.turns()
:     say("Trog's Hand")
:     magic('ab')
:   elseif p.move == "sublimate" then
:     sublimate()
:   elseif p.move == "eat chunks" then
:     magic('ee')
:   elseif p.move == "eat permafood" then
:     say("Eating permafood")
:     eat_permafood()
:   elseif p.move == "ballisto attack" then
:     make_attack(get_ballisto_target())
:   elseif p.move == "pray" then
:     magic('p')
:   elseif p.move == "chop" then
:     chopandeat()
:     -- magic('ccq')
:   elseif p.move == "wait" then
:     magic('s')
:   elseif p.move == "step towards Lair" then
:     step_towards_lair()
:   elseif p.move == "autotravel" then
:     autotravel()
:   elseif p.move == "drop useless" then
:     drop_useless()
:   elseif p.move == "try potion" then
:     try_potion()
:   elseif p.move == "wear amulet" then
:     wear_amulet()
:   elseif p.move == "wear ring" then
:     wear_ring()
:   elseif p.move == "drink potion" then
:     drink_potion(p.potion_choice)
:   elseif p.move == "cure poison" then
:     cure_poison()
:   else
:     say("bad move")
:   end
: end

: -- #######################################
: -- # travel is tricky

: -- generated strings for items are like:
: -- {Lair:4} {Short Blades} a dagger
: function findcorpses()
:   --magic('+corpse&&!!rot&&!!skelet\ra\r')
:   magic('+\\{'.. you.where() ..'\\}.*corpse&&!!rot&&!!skelet\ra\r')
: end

: function autotravel()
:   if p.travel_goal == "corpses" then
:       findcorpses()
:   elseif p.travel_goal == "autoexplore" then
:     magic('o')
:   elseif p.travel_goal == "branch" and not (p.branch_command == "none") then
:     magic(p.branch_command)
:   elseif p.travel_goal == "next level" then
:     if p.random_down then
:       head_to_random_down()
:     else
:       magic('G>')
:     end
:   elseif p.travel_goal == "prev level" then
:     magic('G<')
:   elseif p.travel_goal == "stuck" then
:     make_random_move()
:   else
:     say("bad p.travel_goal")
:   end
: end

: function head_to_random_down()
:   local i,j
:   local c = "X"
:   local feat = view.feature_at(0,0)
:   if string.find(feat,"stone_stairs_down") then
:     if feat == p.forbidden_stairs then
:       magic("X>\r")
:     else
:       magic('>')
:     end
:   else
:     j = crawl.roll_dice(1,12)
:     for i = 1,j do
:       c = (c .. ">")
:     end
:     magic(c .. "\r")
:   end
: end

: function next_branch_goal()
:   -- unfortunately, unexplored levels always return 1
:   --if travel.find_deepest_explored("Temple") == 1 then
:
:   if you.god() ~= "No God" then
:     p.branch_goal = "Lair:1"
:   end
:   if travel.find_deepest_explored("Lair") == 7 then
:     p.branch_goal = "Orc:1"
:   end
:   if travel.find_deepest_explored("Orc") == 3 then
:     p.branch_goal = "Vaults:1"
:   end
:   if travel.find_deepest_explored("Vault") == 7 then
:     p.branch_goal = "D:27"
:   end
:
:   if p.branch_goal == "Temple" then
:     p.branch_goal = "back to D for Lair"
:     p.branch_command = "none"
:   elseif p.branch_goal == "Lair:1" then
:     p.branch_goal = "Lair:7"
:     p.branch_command = "none"
:   elseif p.branch_goal == "Lair:7" then
:     p.branch_goal = "back to D for Orc"
:     p.branch_command = "GD\r"
:   elseif p.branch_goal == "back to D for Orc" then
:     p.branch_goal = "Orc:1"
:     p.branch_command = "GO\r"
:   elseif p.branch_goal == "Orc:1" then
:     p.branch_goal = "Orc:3"
:     p.branch_command = "none"
:   elseif p.branch_goal == "Orc:3" then
:     p.branch_goal = "back to D for Vaults"
:     p.branch_command = "GD\r"
:   elseif p.branch_goal == "back to D for Vaults" then
:     p.branch_goal = "Vault:1"
:     p.branch_command = "GV\r"
:   elseif p.branch_goal == "Vault:1" then
:     p.branch_goal = "Vault:2"
:     p.branch_command = "none"
:   elseif p.branch_goal == "Vault:2" then
:     p.branch_goal = "Snake:1"
:     p.branch_command = "GP\r"
:   elseif p.branch_goal == "Snake:1" then
:     p.branch_goal = "Snake:5"
:     p.branch_command = "none"
:   elseif p.branch_goal == "Snake:5" then
:     p.branch_goal = "back to D for D:27"
:     p.branch_command = "GD\r"
:   elseif p.branch_goal == "back to D for D:27" then
:     p.branch_goal = "???"
:     p.branch_command = "none"
:   else
:     p.branch_goal = "error"
:     p.branch_command = "none"
:   end
: end

: function update_branch_goal()
:   local old_branch_goal = p.branch_goal
: --  if you.branch() == "Lair" and p.branch_goal == "Temple" then
: -- branch_goal
:   if you.where() == p.branch_goal then
:     next_branch_goal()
:   elseif you.branch() == "D"
:    and string.find(p.branch_goal, "back to D for") then
:     next_branch_goal()
:   elseif p.branch_goal == "Lair:1" and you.branch() == "D"
:    and you.absdepth() > 13 then
:     p.branch_goal = "Orc:1"
:     p.branch_command = "GO\r"
:     say("Couldn't find Lair!")
:   elseif p.branch_goal == "Orc:1" and you.branch() == "D"
:    and you.absdepth() > 14 then
:     p.branch_goal = "Vault:1"
:     p.branch_command = "GV\r"
:     say("Couldn't find Orc!")
:   elseif p.branch_goal == "Vault:1" and you.branch() == "D"
:    and you.absdepth() > 19 then
:     p.branch_goal = "???"
:     p.branch_command = "none"
:     say("Couldn't find Vault!")
:   end
:   if not (p.branch_goal == old_branch_goal) then
:     p.branch_goal_found = false
:     say("Next: " .. p.branch_goal)
:   end
:   crawl.mpr("Branch Goal: " .. p.branch_goal)
: end

: -- ########################################
: -- # now we are on to miscellaneous functions,
: -- # only a few of which are complicated

: function move_towards(dx, dy)
:   local move = nil
:   if not (dx and dy) or dx == 0 and dy == 0 then
:     return nil
:   end
:   if adjacent(dx, dy) then
:     move = delta_to_vi(dx, dy)
:   else
:     move = try_move(sign(dx), sign(dy))
:     if abs(dx) > abs(dy) then
:       if move == nil then move = try_move(sign(dx),0) end
:       if move == nil then move = try_move(0,sign(dy)) end
:     else
:       if move == nil then move = try_move(0,sign(dy)) end
:       if move == nil then move = try_move(sign(dx),0) end
:     end
:   end
:   return move
: end

: function make_attack(x, y)
:   local move = move_towards(x, y)
:   if move == nil then
:     make_random_move()
:   else
:     magic(move)
:   end
: end

: p.lof_ok = {"lava", "deep_water", "shallow_water", "floor", "open_door", "trap",
: "enter", "exit", "altar", "stairs", "return", "fountain", "shop"}

: function feature_lof(f)
:   return contains_string_in(f, p.lof_ok)
: end

: function feature_lof_loc(x,y)
:   return feature_lof(view.feature_at(x,y))
: end

: -- only 2 viable points
: -- @
: -- ** <- either of these works
: --  *
: -- 4 options, x+1, x-1, y+1, y-1
: -- -1,-1,  0,-1,  1,-1
: -- -1, 0,  0, 0,  1, 0
: -- -1, 1,  0, 1,  1, 1
: -- this is kinda hideous, I'm sure there's a cleaner/more efficient way
: function find_path(x,y)
:   local line = drawline(0,0,x,y)
:   --dumpline(line)
:   --crawl.mpr(# line)
:   if # line >= 3 and not feature_lof_loc(line[2][1],line[2][2]) then
:     local points = {{-1,-1}, { 0,-1}, { 1,-1},
:                     {-1, 0}, { 0, 0}, { 1, 0},
:                     {-1, 1}, { 0, 1}, { 1, 1}}
:     local best = 999
:     local x2, y2 = 0,0
:     for k,v in pairs(points) do
:         local dist = distance(v[1],v[2],x,y)
:         if dist < best and not (v[1] == line[2][1] and v[2] == line[2][2]) then
:             best = dist
:             x2, y2 = v[1], v[2]
:         end
:     end
:     --crawl.mpr("alt point: "..x2..","..y2)
:     line[2][1], line[2][2] = x2,y2
:     local newline = drawline(x2,y2,x,y)
:     for k,v in pairs(newline) do
:       line[k+1] = v
:     end
:     --dumpline(line)
:   end
:   local mons = mons_on_path(line)
:   local feat = feat_on_path(line)
:   crawl.mpr("mons to target: " .. # mons)
:   crawl.mpr("feat to target: " .. # feat)
:   if # feat > 0 then
:       crawl.mpr("obstructed line: ")
:       for k,v in pairs(feat) do
:           crawl.mpr(v[1] .. "," .. v[2] .. " " .. v[3])
:       end
:   end
:   return line, # mons
: end

: function update_monsters()
:   p.currentmonsters = l_monsters(8)
:   p.currentthreat = 0
:   p.bestidx = nil
:   p.best2idx = nil
:   local best = 0
:   local best2 = 0
:   crawl.mpr("monsters: ")
:   for k,v in pairs(p.currentmonsters) do
:       local m = v[1]
:       local x = v[2]
:       local y = v[3]
:       local mi = monster_info[m:type()]
:       local threat = getthreat(mi, m, x, y)
:       table.insert(v, threat)
:       p.currentthreat = p.currentthreat + threat
:       crawl.mpr("k: "..k.." mon: "..m:desc().." x: "..x.." y: "..y..
:                 " threat: "..threat)
:       local dist = travel_distance(x,y)
:
:       if (not m:is_safe() or m:is(p.MB.confused))
:           and you.see_cell_no_trans(x,y) then
:           local line, nmons = find_path(x,y)
:           if line and nmons == 1 and threat > best2 then
:               table.insert(v, line)
:               best2 = threat
:               p.best2idx = k
:           end
:           if threat > best then
:               best = threat
:               p.bestidx = k
:           end
:       end
:   end
:   crawl.mpr("current threat: " .. p.currentthreat)
:   if p.bestidx then
:      crawl.mpr("best target: " .. p.currentmonsters[p.bestidx][1]:desc())
:   end
:   if p.best2idx then
:      crawl.mpr("best target (clear LOF): " .. p.currentmonsters[p.best2idx][1]:desc())
:   end
: end

: function get_target(clearlof)
:   if you.turns() ~= p.last_turn then
:       update_monsters()
:   end
:   local m,x,y
:   if clearlof then
:       if p.best2idx then
:           local v = p.currentmonsters[p.best2idx]
:           m,x,y = v[1],v[2],v[3]
:       elseif p.bestidx then
:           crawl.mpr("returning p.bestidx monster instead")
:           local v = p.currentmonsters[p.bestidx]
:           m,x,y = nil,v[2],v[3]
:       end
:   else
:       if p.bestidx then
:           local v = p.currentmonsters[p.bestidx]
:           m,x,y = v[1],v[2],v[3]
:       end
:   end
:   return x,y,m
: end

: function get_target_old()
:   local r = monster_distance()
:   if r == 10 then
:     return 0, 0
:   end
:   local x, y
:     for x = -r,r do
:       for y = -r,r do
:         m = monster.get_monster_at(x, y)
:         if m and contains_string_in(m:desc(),p.priority_monsters)
:           and (not m:is_safe() or m:is(p.MB.confused)) and you.see_cell_no_trans(x,y) then
:           return x, y, m
:         end
:       end
:     end
:     for x = -r,r do
:       for y = -r,r do
:         m = monster.get_monster_at(x, y)
:         if m and (not m:is_safe() or m:is(p.MB.confused)) and you.see_cell_no_trans(x,y) then
:           return x, y, m
:         end
:       end
:     end
:   return 0, 0
: end

: function get_ballisto_target()
:   local r, x, y
:   for r = 1,8 do
:     for x = -r,r do
:       for y = -r,r do
:         m = monster.get_monster_at(x, y)
:         if m then
:           if string.find(m:desc(), "ballisto")
:             or string.find(m:desc(), "snail")
:             or string.find(m:desc(), "snapping") then
:             if you.see_cell_no_trans(x,y) then
:               return x,y
:             end
:           end
:         end
:       end
:     end
:   end
:   return 0,0
: end

: function wearing_ctele()
:   for i = 0,9 do
:     if items.equipped_at(i) and
:       (string.find(items.equipped_at(i).name(),"cTele")
:       or string.find(items.equipped_at(i).name(),"ring of teleport control"))
:     then
:       return true
:     end
:   end
:   return false
: end

: function use_escape()
:   local telewand = {}
:   local telescroll = -1
:   local blinkscroll = -1
:   for i =0,51 do
:     local it = items.inslot(i)
:     if it then
:       local name = it.name()
:       if string.find(name, "wand of teleportation")
:           and not string.find(name, "empty") then
:         table.insert(telewand, i)
:       end
:       if string.find(name, "scrolls? of teleportation") then
:         telescroll = i
:       end
:       if string.find(name, "scrolls? of blink") then
:         blinkscroll = i
:       end
:     end
:   end
:   if blinkscroll >= 0 then
:     read_blink(blinkscroll)
:   elseif telescroll >= 0 then
:     read_teleport(telescroll)
:   elseif # telewand > 0 then
:     zap_teleport(telewand)
:   else
:     normal_flee()
:   end
: end

: function read_teleport(i)
:   local l = items.index_to_letter(i)
:   if wearing_ctele() then
:     magic('r' .. l .. 'sssss' .. string.char(32) .. 'N<' .. string.char(13))
:   else
:     magic('r' .. l)
:   end
: end

: function zap_teleport(wands)
: -- should use the one with the fewest charges
: -- currently just using the first wand in inv
:   local i = wands[1]
:   local l = items.index_to_letter(i)
:   if wearing_ctele() then
:     magic('V' .. l .. string.char(13) .. 'ssss'.. 'N<' .. string.char(13))
:   else
:     magic('V' .. l .. string.char(13))
:   end
: end

: function read_blink(i)
:   local l = items.index_to_letter(i)
:   if you.turns() ~= p.last_turn then
:     update_monsters()
:   end
:   local x,y = blink_target()
:   if not (x == 0 and y == 0) then
:     local line = drawline(0,0,x,y)
:     local linestr = walkline(line)
:     magic('r' .. l .. linestr .. string.char(13))
:   end
: end

: function flee()
:   if you.teleporting() == false then
:     use_escape()
:   else
:     normal_flee()
:   end
: end

: function normal_flee()
:   local x,y
:   local i,j
:   local best_move = nil
:   local best_score = -1
:   local best_adjacent = 1000
:   local score
:   local num_adjacent
:   local m
:   for i = -1,1 do
:     for j = -1,1 do
:       if can_move(i, j) and
:         not monster.get_monster_at(i,j) then
:         score = 0
:         num_adjacent = 0
:         for x = -8,8 do
:           for y = -8,8 do
:             m = monster.get_monster_at(x, y)
:               if m and not m:is_safe() then
:                 score = score + abs(x-i) + abs(y-j)
:                 if adjacent(x-i,y-j) then
:                   num_adjacent = num_adjacent+1
:                 end
:               end
:           end
:         end
:         if num_adjacent < best_adjacent
:           or (num_adjacent == best_adjacent and score > best_score) then
:            best_score = score
:            best_adjacent = num_adjacent
:            best_move = delta_to_vi(i, j)
:         end
:       end
:     end
:   end
:   if best_move == 's' then
:     if monster_distance() == 1 then
:       ranged(true)
:       -- make_attack(get_target())
:     else
:       make_random_move()
:     end
:   else
:     say("FLEEEEING")
:     magic(best_move)
:   end
: end

: -- # these functions need to be written
: function is_reasonable_attack()
:   return true
: end

: function is_reasonable_ballisto_attack()
:   x,y = get_ballisto_target()
:   return not (x == 0 and y == 0)
: end

: function is_good_retreat()
:   return (c_spec_monsters(5, p.no_flee_monsters) == 0)
: end

: -- ########################################
: -- # simple functions

: function distance(x1,y1,x2,y2)
:   return math.max(math.abs(x1 - x2), math.abs(y1 - y2))
: end

: function travel_distance(x,y)
:   return math.max(math.abs(x), math.abs(y))
: end

: function monster_distance()
:  local r, x, y
:   for r = 1,8 do
:     for x = -r,r do
:       for y = -r,r do
:         m = monster.get_monster_at(x, y)
:         if m and (not m:is_safe() or m:is(p.MB.confused)) then
:           return r
:           -- return distance(x,y)
:         end
:       end
:     end
:   end
:   return 10
: end

: function radius_iter(r, f)
:   local a
:   local x, y
:   for x = -r,r do
:     for y = -r,r do
:       a = f(x, y, r, a)
:     end
:   end
:   return a
: end

: -- r is unused
: function c_mons(x,y,r,a,pred)
:   a = a or 0
:   local m = monster.get_monster_at(x,y)
:   if m and pred(m) then
:       a = a + 1
:   end
:   return a
: end

: function l_mons(x,y,r,a,pred)
:   a = a or {}
:   local m = monster.get_monster_at(x,y)
:   if m and pred(m) then
:       table.insert(a,{m,x,y})
:   end
:   return a
: end

: function c_uniques(r)
:   local function count(x,y,r,a)
:     return c_mons(x,y,r,a, function(m) return not m:is_safe()
:       and string.find(m:desc(),"%u") ~= nil end)
:   end
:   return radius_iter(r, count)
: end

: function c_monsters(r)
:   local function count(x,y,r,a)
:     return c_mons(x,y,r,a, function(m) return not m:is_safe() end)
:   end
:   return radius_iter(r, count)
: end

: function xor(a,b) return (not (a and b)) and (a or b) end

: function c_spec_monsters(r, t, ignore)
:   local function count(x,y,r,a)
:       return c_mons(x,y,r,a,
:           function(m) return (not m:is_safe() or m:is(p.MB.confused))
:               and xor(contains_string_in(m:desc(), t), ignore) end)
:   end
:   return radius_iter(r, count)
: end

: function c_ignore_spec_monsters(r, t)
:   return c_spec_monsters(r, t, true)
: end

: function c_bia(r)
:   local t = {"ogre","giant","bear","troll"}
:   local function count(x,y,r,a)
:       return c_mons(x,y,r,a,
:           function(m)
:               return m:is(p.MB.summoned) and m:is_safe() and m:is(p.MB.berserk)
:                   and contains_string_in(m:desc(), t) end)
:   end
:   return radius_iter(r, count)
: end

: function c_summons(r)
:   local function count(x,y,r,a)
:       return c_mons(x,y,r,a,
:           function(m)
:               return m:is(p.MB.summoned) and m:is_safe() end)
:   end
:   return radius_iter(r, count)
: end

: function l_summons(r)
:   local function count(x,y,r,a)
:       return l_mons(x,y,r,a,
:           function(m)
:               return m:is(p.MB.summoned) and m:is_safe() end)
:   end
:   return radius_iter(r, count)
: end

: function l_monsters(r)
:   local function count(x,y,r,a)
:       return l_mons(x,y,r,a,
:           function(m) return (not m:is_safe()) end)
:   end
:   return radius_iter(r, count)
: end

: function can_move(x,y)
:   return travel.feature_traversable(view.feature_at(x, y))
: end

: function blink_target()
:   local function blink_ok(x,y,r,a)
:       a = a or {["best"] = 0, ["loc"] = {0,0}}
:       if can_move(x,y) and you.see_cell_no_trans(x,y) then
:           local sum = 0
:           for k,v in pairs(p.currentmonsters) do
:               sum = sum + distance(x, y, v[2], v[3])
:           end
:           if sum > a.best then
:               a.best = sum
:               a.loc = {x,y}
:           end
:       end
:       return a
:   end
:   local res = radius_iter(8, blink_ok)
:   return res.loc[1], res.loc[2]
: end

: function blink_away()
:   if you.turns() ~= p.last_turn then
:       update_monsters()
:   end
:   local x,y = blink_target()
:   if not (x == 0 and y == 0) then
:       local line = drawline(0,0,x,y)
:       local linestr = walkline(line)
:       -- for wizmode testing
:       magic("&b" .. linestr .. ".")
:   end
: end

: function try_move(dx, dy)
:   if can_move(dx,dy) then
:     return delta_to_vi(dx, dy)
:   else
:     return nil
:   end
: end

: function make_random_move()
:   local x = crawl.random2(3)-1
:   local y = crawl.random2(3)-1
:   if can_move(x,y) then
:     magic(delta_to_vi(x, y))
:   elseif x == 0 and y == 0 then
:     magic('s')
:   else
:     make_random_move()
:   end
: end

: function chopandeat()
:   if (have_chunks(false) or on_chunks()) and can_eat_chunks() then
:     magic('ee')
:   else -- get some chunks
:     if on_corpses() then
:       magic('cy')
:     else
:       findcorpses()
:     end
:   end
: end

: function ok_food(i, bigok)
:   local meat = {"sausage","beef jerky"}
:   local veg = {"choko","lemon","snozzcumber","orange","banana","pear","apple","apricot","grape","sultana"}
:   local either = {"honey","pizza","cheese","ambrosia"}
:   local allfood = {}
:   if bigok then
:     table.insert(meat, "meat ration")
:     table.insert(veg, "bread ration")
:     table.insert(either, "royal jelly")
:   end
:   for k,v in pairs(either) do
:     table.insert(meat, v)
:     table.insert(veg, v)
:   end
:   for k,v in pairs(meat) do
:     table.insert(allfood, v)
:   end
:   for k,v in pairs(veg) do
:     table.insert(allfood, v)
:   end
:   local it = items.inslot(i)
:   if it then
:     local name = it.name()
:     if string.find(it.name(),"potion") then
:         -- pass
:     elseif carnivore()
:         and contains_string_in(name, meat) then
:         return items.index_to_letter(i)
:     elseif vegan()
:         and contains_string_in(name, veg) then
:         return items.index_to_letter(i)
:     elseif contains_string_in(name, allfood) then
:         return items.index_to_letter(i)
:     end
:   end
:   return -1
: end

: function eat_permafood()
:   local i
:   local l
:   for i = 0,51 do
:     l = ok_food(i, false)
:     if l ~= -1 then
:       crawl.mpr("eat: " .. l)
:       magic("e" .. l)
:       return
:     end
:   end
:   for i = 0,51 do
:     l = ok_food(i, true)
:     if l ~= -1 then
:       crawl.mpr("eat: " .. l)
:       magic("e" .. l)
:       return
:     end
:   end
: end

: function on_chunks()
:   local fl = you.floor_items()
:   for it in iter.invent_iterator:new(fl) do
:     if string.find(it.name(),"chunk")
:         and (not food.dangerous(it))
:         and not string.find(it.name(),"rotting") then
:       return true
:     end
:   end
:   return false
: end

: function on_corpses()
:   local fl = you.floor_items()
:   for it in iter.invent_iterator:new(fl) do
:     if string.find(it.name(),"corpse")
:         and not string.find(it.name(),"rotting") then
:       return true
:     end
:   end
:   return false
: end

: function on_dangerous_corpse()
:   local fl = you.floor_items()
:   for it in iter.invent_iterator:new(fl) do
:     if string.find(it.name(),"corpse") then
:       return food.dangerous(it)
:     end
:   end
:   return false
: end

: function have_chunks(anyok)
:   local i
:   local it
:   if anyok then
:     for i = 0,51 do
:       it = items.inslot(i)
:       if it and string.find(it.name(),"chunk")
:         and (food.dangerous(it)
:           or food.rotting(it)) then
:         return items.index_to_letter(i)
:       end
:     end
:   end
:   for i = 0,51 do
:     it = items.inslot(i)
:     if it and string.find(it.name(),"chunk")
:       and (not food.dangerous(it)
:            and not food.rotting(it)) then
:       return items.index_to_letter(i)
:     end
:   end
:   return nil
: end

: function have_permafood()
:   local i
:   local it
:   for i = 0,51 do
:     it = items.inslot(i)
:     if it and contains_string_in(it.name(),{"ration","honey","jelly"}) then
:       return true
:     end
:   end
:   return false
: end

: function spellslot(name)
:   for i,n in pairs(you.spells()) do
:     if n == name then
:       return string.char(96 + i)
:     end
:   end
:   return nil
: end

: function melee_ok()
:   local weapon = items.equipped_at(0)
:   return ((not weapon) or weapon
:       and not items.inslot(weapon.slot).cursed
:       and not string.find(items.inslot(weapon.slot).name(), "!a"))
: end

: function can_sublimate()
:   local weapon = items.equipped_at(0)
:   return you.god() ~= "Trog"
:      and util.contains(you.spells(),"Sublimation of Blood")
:      and p.last_mp >= 2
:      and have_chunks(true)
:      and (not (you.hunger() == "starving"))
:      and ((not weapon) or weapon and not items.inslot(weapon.slot).cursed)
:      and not you.confused()
: end

: function cure_poison()
:   local spell = spellslot("Cure Poison")
:   if spell then
:     magic("z" .. spell)
:   end
: end

: function can_cure_poison()
:   return you.god() ~= "Trog"
:      and util.contains(you.spells(),"Cure Poison")
:      and p.last_mp > 2
:      and (not (you.hunger() == "starving"))
:      and not you.confused()
: end

: function sublimatem()
:   if can_sublimate() then
:     sublimate()
:   else
:     crawl.mpr("can't sublimate now")
:   end
: end

: function sublimate()
:   local weapon = items.equipped_at(0)
:   local chunk = have_chunks(true)
:   local spell = spellslot("Sublimation of Blood")
:   if chunk and spell then
:     magic("w" .. chunk)
:     magic("z" .. spell)
:   end
:   if weapon then
:     magic("w" .. items.index_to_letter(weapon.slot))
:   end
: end

: function can_sublimate()
:   local weapon = items.equipped_at(0)
:   return you.god() ~= "Trog"
:      and util.contains(you.spells(),"Sublimation of Blood")
:      and you.mp() >= 2
:      and have_chunks(true)
:      and (not (you.hunger() == "starving"))
:      and ((not weapon) or weapon and not items.inslot(weapon.slot).cursed)
:      and not you.confused()
: end

: -- mr param for MR or for healing
: function can_hand(mr)
:   return (not mr
:      and you.god() ~= "Trog"
:      and util.contains(you.spells(),"Regeneration")
:      and p.last_mp > 3)
:     or
:   (util.contains(you.abilities(),"Trog's Hand")
:      and p.last_hand_turn + 10 < you.turns()
:      and (not (you.hunger() == "starving")))
:      and not you.confused()
: end

: function can_bia()
:   return (util.contains(you.abilities(),"Brothers in Arms")
:      and (not (you.hunger() == "starving")) and not you.confused())
: end

: function have_amulet()
:   if items.equipped_at(9) then
:     return false
:   end
:   local i
:   for i = 0,51 do
:     if items.inslot(i) and string.find(items.inslot(i).name(),"amulet") then
:       return true
:     end
:   end
:   return false
: end

: function wear_amulet()
:   local i
:   local l
:   for i = 0,51 do
:     if items.inslot(i) and string.find(items.inslot(i).name(),"amulet") then
:       l = items.index_to_letter(i)
:       say("WEARING AMULET")
:       magic('P' .. l)
:       return
:     end
:   end
: end

: -- # we assume that if just one ring is on, it is the left one
: function have_ring()
:   local one_ring
:   if items.equipped_at("Left Ring") then
:     if items.equipped_at("Right Ring") then
:       return false
:     else
:       one_ring = true
:     end
:   else
:     one_ring = false
:   end
:   local i
:   for i = 0,51 do
:     if items.inslot(i) and string.find(items.inslot(i).name(),"ring")
:         and not (one_ring and items.inslot(i).name() ==
:         items.equipped_at("Left Ring").name()) then
:       return true
:     end
:   end
:   return false
: end

: function wear_ring()
:   local i
:   local l
:   for i = 0,51 do
:     if items.inslot(i) and string.find(items.inslot(i).name(),"ring") 
:         and not string.find(items.inslot(i).name(),"mail")
:         and not (items.equipped_at("Left Ring")
:         and items.inslot(i).name() ==
:         items.equipped_at("Left Ring").name()) then
:       l = items.index_to_letter(i)
:       say("WEARING RING: " .. l)
:       magic('P' .. l)
:       return
:     end
:   end
: end

: function try_potion()
:   return
: end

: function try_potion2()
:   local i
:   local l
:   for i = 0,51 do
:     if items.inslot(i) and string.find(items.inslot(i).name(),"potion")
:         and not (string.find(items.inslot(i).name(), "potion of")
:         or string.find(items.inslot(i).name(), "potions of")) then
:       l = items.index_to_letter(i)
:       magic('q' .. l)
:       return
:     end
:   end
: end

: function have_unknown_potion()
:   local i
:   for i = 0,51 do
:     if items.inslot(i) and string.find(items.inslot(i).name(),"potion")
:         and not (string.find(items.inslot(i).name(), "potion of")
:         or string.find(items.inslot(i).name(), "potions of")) then
:       return true
:     end
:   end
:   return false
: end

: function have_potion(name)
:   local i
:   for i = 0,51 do
:     if items.inslot(i) and string.find(items.inslot(i).name(), name) then
:      return true
:     end
:   end
:   return false
: end

: function drink_potion(name)
:   local i
:   local l
:   for i = 0,51 do
:     if items.inslot(i) and string.find(items.inslot(i).name(), name) then
:       l = items.index_to_letter(i)
:       say("Drinking " .. items.inslot(i).name())
:       magic('q' .. l)
:       return
:     end
:   end
: end

: p.useless = {"amulet of inaccuracy","amulet of faith","ring of hunger"}
: if you.race() == "Spriggan" then
:   table.insert(p.useless, "ring of sustenance")
: end
: if you.race() == "Spriggan" or you.race() == "Naga"
:   or you.race() == "Felid" then
:   table.insert(p.useless, "ring of see invisible")
: end
: if you.race() == "Naga" or you.race() == "Ghoul"
:   or you.race() == "Mummy" or you.race() == "Vampire" then
:   table.insert(p.useless, "ring of poison resistance")
: end
: if you.race() == "Kenku" then
:   table.insert(p.useless, "ring of levitation")
:   table.insert(p.useless, "amulet of controlled flight")
: end
: if you.god() == "Ashenzari" and you.piety_rank() > 2 then
:   table.insert(p.useless, "ring of see invisible")
:   table.insert(p.useless, "amulet of clarity")
: end
: if you.god() == "Trog" then
:   table.insert(p.useless, "amulet of stasis")
:   table.insert(p.useless, "amulet of rage")
: end
: if # you.spells() > 0 then
:   table.insert(p.useless, "amulet of guardian spirit")
: end
: if you.race() == "Kobold" or you.race() == "Spriggan"
:   or you.race() == "Mummy" or you.race() == "Vampire"
:   or you.race() == "Felid" then
:   table.insert(p.useless, "amulet of the gourmand")
: end

: function drop_useless()
:   local i = have_useless()
:   if i > 0 then
:     say("DROPPING USELESS ITEM")
:     local l = items.index_to_letter(i)
:     magic('d' .. l)
:   end
: end

: function have_useless()
:   local i
:   for i=1,51 do
:     if items.inslot(i) and
:      contains_string_in(items.inslot(i).name(), p.useless)
:      and not items.inslot(i).cursed then
:       return i
:     end
:   end
:   return 0
: end

: function should_restore()
:   if not have_potion("restore abilities") then
:     return false
:   end
:   local str, mstr = you.strength()
:   local int, mint = you.intelligence()
:   local dex, mdex = you.dexterity()
:   return (str+1 < mstr or int+4 < mint or int*2 <= mint or dex+1 < mdex)
: end

: function need_restore()
:   if not have_potion("restore abilities") then
:     return false
:   end
:   local str, mstr = you.strength()
:   local int, mint = you.intelligence()
:   local dex, mdex = you.dexterity()
:   return (str <= 0 or int <= 0 or dex <= 0)
: end

: p.berserk_ok = not caster()

: function toggle_berserk()
:   p.berserk_ok = not p.berserk_ok
:   local s = "not "
:   if p.berserk_ok then
:     s = ""
:   end
:   crawl.mpr("berserking is " .. s .. "ok")
: end

: function can_berserk()
:   if p.berserk_ok and (wearing_rage() or (you.god() == "Trog" and you.piety_rank() > 0)) then
:     return can_berserk2()
:   else
:     return false
:   end
: end

: function can_berserk2()
:   if you.exhausted() or you.hunger() == "very hungry"
:        or you.hunger() == "near starving" or you.hunger() == "starving"
:        or you.mesmerised() or you.confused() or wearing_stasis() then
:     return false
:   else
:     return true
:   end
: end

: function wearing_gourmand()
:   return (items.equipped_at(9) and
:      string.find(items.equipped_at(9).name(),"gourmand"))
: end

: -- 0 weapon
: -- 1 cloak
: -- 2 helmet
: -- 3 gloves
: -- 4 boots
: -- 5 shield
: -- 6 body armour
: -- 7 ring
: -- 8 ring
: -- 9 amulet

: function wearing_rage()
:   local have_rage = false
:   for i = 0,9 do
:     have_rage = have_rage or (items.equipped_at(i) and
:      (string.find(items.equipped_at(i).name(),"+Rage")
:       or string.find(items.equipped_at(i).name(),"amulet of rage")))
:   end
:   return have_rage
: end

: function wearing_stasis()
:   return (items.equipped_at(9) and
:      string.find(items.equipped_at(9).name(),"stasis"))
: end

: function can_see_lair()
:   local x, y
:   if p.stepped_on_lair then
:     return false
:   end
:   for x = -8,8 do
:     for y = -8,8 do
:       if view.feature_at(x,y) == "enter_lair"
:           and you.see_cell_no_trans(x,y) then
:         if x == 0 and y == 0 then
:           p.stepped_on_lair = true
:           return false
:         else
:           return true
:         end
:       end
:     end
:   end
:   return false
: end

: function step_towards_lair()
:   local x, y
:   for x = -8,8 do
:     for y = -8,8 do
:       if view.feature_at(x,y) == "enter_lair" then
:         make_attack(x,y)
:         return
:       end
:     end
:   end
: end

: function print_monsters(r)
:   local x, y
:     for x = -r,r do
:       for y = -r,r do
:         m = monster.get_monster_at(x, y)
:         if m then
:           say(m:desc())
:           if m:is_safe() then
:             say("=IS_SAFE ")
:           end
:           if not you.see_cell_no_trans(x,y) then
:             say("=BEHIND_GLASS")
:           end
:         end
:       end
:     end
: end

: function print_behind_glass(r)
:  local x, y
:     for x = -r,r do
:       for y = -r,r do
:         if you.see_cell(x,y) and not you.see_cell_no_trans(x,y) then
:           say(x .. "," .. y)
:         end
:       end
:     end
: end

: -- ########################################
: function iterline(line, f)
:   local a
:   for k,v in pairs(line) do
:       local x, y = v[1], v[2]
:       if not (x == 0 and y == 0) then
:         a = f(x,y,a)
:       end
:   end
:   return a
: end

: function feat_on_path(line)
:   local function check_loc(x,y,a)
:       a = a or {}
:       local f = view.feature_at(x, y)
:       if not feature_lof(f) then
:          table.insert(a, {x,y,f})
:       end
:       return a
:   end
:   return iterline(line, check_loc)
: end

: function mons_on_path(line)
:   local function check_loc(x,y,a)
:       a = a or {}
:       local m = monster.get_monster_at(x, y)
:       table.insert(a, m)
:       return a
:   end
:   return iterline(line, check_loc)
: end

: function walkline(line)
:   --crawl.mpr("walkline: ")
:   local vi = ""
:   local px, py = line[1][1], line[1][2]
:   for k,v in pairs(line) do
:       local x, y = v[1], v[2]
:   --crawl.mpr("walkline: "..k.." "..x..","..y)
:       if x and y and (not (x == 0 and y == 0)) then
:         local vidir = delta_to_vi(x - px, y - py)
:         if not vidir then
:            dumpline(line)
:         end
:         vi = vi .. delta_to_vi(x - px, y - py)
:         px, py = x, y
:       end
:   end
:   --crawl.mpr("walkline done")
:   return vi
: end

: function dumpline(line)
:   crawl.mpr("line:")
:   for k,v in pairs(line) do
:       local x,y = v[1], v[2]
:       crawl.mpr("(" .. x .. "," .. y..") ")
:   end
: end

: function drawline(x0, y0, x1, y1)
:   local line = {}
:   local dx = abs(x1-x0)
:   local dy = abs(y1-y0)
:   local sx, sy
:
:   if x0 < x1 then sx = 1 else sx = -1 end
:   if y0 < y1 then sy = 1 else sy = -1 end
:
:   local err = dx-dy
:
:   while true do
:       table.insert(line, {x0, y0})
:       if x0 == x1 and y0 == y1 then break end
:       local e2 = 2*err
:       if e2 > -dy then
:           err = err - dy
:           x0 = x0 + sx
:       end
:       if e2 < dx then
:           err = err + dx
:           y0 = y0 + sy
:       end
:   end
:   return line
: end

: -- ########################################
: -- # abstract functions

: function magic(command)
: p.hold = true
: crawl.delay(50)
: crawl.flush_input()
: crawl.sendkeys(command .. string.char(27) .. string.char(27)
:     .. string.char(27))
: -- why are we doing this?
: --coroutine.yield(true)
: p.hold = false
: crawl.flush_input()
: collectgarbage()
: end

: function say(x)
:   crawl.mpr(you.turns() .. " ||| " .. x)
:   crawl.take_note(x)
: end

: function note(x)
:   crawl.take_note(x)
: end

: function contains_string_in(name,t)
: for _, value in pairs(t) do
: if string.find(name, value) then
: return true
: end
: end
: return false
: end

: function delta_to_vi(dx, dy)
:   local d2v = {
:     [-1] = { [-1] = 'y', [0] = 'h', [1] = 'b'},
:     [0]  = { [-1] = 'k', [0] = 's', [1] = 'j'},
:     [1]  = { [-1] = 'u', [0] = 'l', [1] = 'n'},
:   }
:   return d2v[dx][dy]
: end
:
: function sign(a)
:   return a > 0 and 1 or a < 0 and -1 or 0
: end
:
: function abs(a)
:   return a * sign(a)
: end
:
: function adjacent(dx, dy)
:   return math.abs(dx) <= 1 and math.abs(dy) <= 1
: end

: -- ##############################################
: -- # macro the key d to ===s to use the script

: function s()
:   crawl.mpr("gcinfo: "..gcinfo())
:   update_stuff()
:   choose_move()
:   crawl.mpr("would: " .. p.move)
:   --make_move()
: end

: function s_interrupt_macro(interrupt_name)
:  return false
: end
:
: chk_interrupt_macro.s = s_interrupt_macro

: -- spl-data.h
: -- min range, max range, spell level, power cap, schools, don't cast, lof needed
: p.spell_info = {
: -- {{{1
:    ["Magic Dart"] = {8,8,1,25, {"Conjurations"}, false, true},
:    ["Iskenderun's Mystic Blast"] = {5,5,4,100, {"Conjurations"}, false, true},
:    ["Flame Tongue"] = {1,4,1,40, {"Fire Magic", "Conjurations"}, false, true},
:    ["Throw Flame"] = {7,7,2,50, {"Fire Magic", "Conjurations"}, false, true},
:    ["Sticky Flame"] = {1,1,4,100, {"Fire Magic", "Conjurations"}, true, true},
:    ["Bolt of Fire"] = {6,6,6,200, {"Fire Magic", "Conjurations"}, false, true},
:    ["Fireball"] = {6,6,6,200, {"Fire Magic", "Conjurations"}, true, true},
:    ["Bolt of Magma"] = {5,5,5,200, {"Fire Magic", "Earth Magic", "Conjurations"}, false, true},
:    ["Stone Arrow"] = {5,5,3,50, {"Earth Magic", "Conjurations"}, false, true},
:    ["Sandblast"] = {2,2,1,50, {"Earth Magic"}, false, true},
:    ["Iron Shot"] = {5,5,6,200, {"Earth Magic", "Conjurations"}, false, true},
:    ["Lehudib's Crystal Spear"] = {4,4,8,200, {"Earth Magic", "Conjurations"}, false, true},
:    ["Throw Frost"] = {8,8,2,50, {"Ice Magic", "Conjurations"}, false, true},
:    ["Throw Icicle"] = {6,6,4,100, {"Ice Magic", "Conjurations"}, false, true},
:    ["Bolt of Cold"] = {7,7,6,200, {"Ice Magic", "Conjurations"}, false, true},
:    ["Mephitic Cloud"] = {5,5,3,200, {"Air Magic", "Poison Magic", "Conjurations"}, true, true},
:    ["Venom Bolt"] = {6,6,5,200, {"Poison Magic", "Conjurations"}, false, true},
:    ["Sting"] = {7,7,1,25, {"Poison Magic", "Conjurations"}, false, true},
:    ["Poison Arrow"] = {7,7,6,200, {"Poison Magic", "Conjurations"}, false, true},
:    ["Shock"] = {8,8,1,25, {"Air Magic", "Conjurations"}, false, true},
:    ["Lightning Bolt"] = {5,8,5,200, {"Air Magic", "Conjurations"}, false, true},
:    ["Airstrike"] = {8,8,4,200, {"Air Magic"}, false, false},
:    ["Pain"] = {6,6,1,25, {"Necromancy"}, false, true},
:    ["Haunt"] = {8,8,7,200, {"Necromancy", "Summoning"}, false, false},
:    ["Agony"] = {8,8,5,200, {"Necromancy"}, true, true},
:    ["Dispel Undead"] = {5,5,4,100, {"Necromancy"}, true, true},
:    ["Bolt of Draining"] = {6,6,6,200, {"Necromancy", "Conjurations"}, false, true},
:    ["Call Imp"] = {-1,-1,2,200, {"Summoning"}, false, false},
:    ["Vampiric Draining"] = {1,1,3,200, {"Necromancy"}, true, true},
:    ["Teleport Self"] = {-1,-1,5,0, {"Translocations"}, true, false},
:    ["Apporation"] = {8,8,1,1000, {"Translocations"}, true, true},
:    ["Conjure Flame"] = {4,4,3,100, {"Conjurations", "Fire Magic"}, true, false},
:    ["Dig"] = {8,8,4,200, {"Transmutation", "Earth"}, true, true},
:    ["Cause Fear"] = {8,8,5,200, {"Hexes"}, true, false},
:    ["Slow"] = {8,8,2,200, {"Hexes"}, true, true},
:    ["Haste"] = {8,8,6,200, {"Charms"}, true, true},
:    ["Petrify"] = {8,8,4,200, {"Transmutation", "Earth Magic"}, true, true},
:    ["Confuse"] = {8,8,3,200, {"Hexes"}, true, true},
:    ["Controlled Blink"] = {-1,-1,7,0, {"Translocations"}, true, true},
:    ["Ring of Flames"] = {-1,-1,7,200, {"Charms", "Fire Magic"}, false, false},
:    ["Olgreb's Toxic Radiance"] = {-1,-1,4,200, {"Poison"}, false, false},
:    ["Freezing Cloud"] = {6,6,6,200, {"Conjurations", "Ice Magic", "Air Magic"}, true, false},
:    ["Teleport Other"] = {8,8,3,200, {"Translocations"}, true, true},
:    ["Death's Door"] = {-1,-1,8,200, {"Charms", "Necromancy"}, true, false},
:    ["Mass Confusion"] = {-1,-1,6,200, {"Hexes"}, true, false},
:    ["Summon Small Mammals"] = {-1,-1,1,25, {"Summoning"}, true, false},
:    ["Abjuration"] = {8,8,6,200, {"Charms"}, true, true},
:    ["Summon Scorpions"] = {-1,-1,4,200, {"Summoning", "Poison Magic"}, false, false},
:    ["Levitation"] = {-1,-1,2,150, {"Charms", "Air Magic"}, true, true},
:    ["Bolt of Inaccuracy"] = {7,7,3,1000, {"Conjurations"}, true, true}, -- not castable?
:    ["Tornado"] = {-1,-1,9,200, {"Air Magic"}, false, false},
:    ["Poisonous Cloud"] = {6,6,5,200, {"Conjurations", "Poison Magic", "Air Magic"}, true, false},
:    ["Fire Storm"] = {6,6,9,200, {"Conjurations", "Fire Magic"}, true, false},
:    ["Blink"] = {-1,-1,2,0, {"Translocations"}, true, false},
:    ["Summon Swarm"] = {-1,-1,5,200, {"Summoning"}, false, false},
:    ["Summon Horrible Things"] = {-1,-1,8,200, {"Summoning"}, false, false},
:    ["Malign Gateway"] = {-1,-1,7,200, {"Summoning", "Translocations"}, true, false},
:    ["Enslavement"] = {8,8,4,200, {"Hexes"}, true, true},
:    ["Animate Dead"] = {-1,-1,4,0, {"Necromancy"}, true, false},
:    ["Control Undead"] = {-1,-1,5,200, {"Hexes", "Necromancy"}, true, true},
:    ["Animate Skeleton"] = {-1,-1,1,0, {"Necromancy"}, true, false},
:    ["Borgnjor's Revivification"] = {-1,-1,7,200, {"Necromancy"}, true, false},
:    ["Summon Elemental"] = {-1,-1,4,200, {"Summoning"}, true, true},
:    ["Ozocubu's Refrigeration"] = {-1,-1,5,200, {"Ice Magic"}, true, false},
:    ["Summon Ice Beast"] = {-1,-1,5,200, {"Ice Magic", "Summoning"}, false, false},
:    ["Repel Missiles"] = {-1,-1,2,200, {"Air Magic", "Charms"}, true, false},
:    ["Berserker Rage"] = {-1,-1,3,0, {"Charms"}, true, false},
:    ["Fulsome Distillation"] = {-1,-1,1,0, {"Transmutation", "Necromancy"}, true, false},
:    ["Twisted Resurrection"] = {-1,-1,5,200, {"Necromancy"}, true, false},
:    ["Regeneration"] = {-1,-1,3,200, {"Charms", "Necromancy"}, true, false},
:    ["Cigotuvi's Degeneration"] = {8,8,5,200, {"Transmutation", "Necromancy"}, true, true},
:    ["Tukima's Dance"] = {-1,-1,3,150, {"Hexes"}, true, false},
:    ["Tukima's Ball"] = {-1,-1,9,200, {"Hexes"}, true, false}, -- not castable?
:    ["Summon Demon"] = {-1,-1,5,200, {"Summoning"}, false, false},
:    ["Summon Greater Demon"] = {-1,-1,7,200, {"Summoning"}, true, false},
:    ["Corpse Rot"] = {-1,-1,2,0, {"Necromancy"}, true, false},
:    ["Fire Brand"] = {-1,-1,2,0, {"Fire Magic", "Charms"}, true, false},
:    ["Freezing Brand"] = {-1,-1,2,0, {"Ice Magic", "Charms"}, true, false},
:    ["Lethal Infusion"] = {-1,-1,2,0, {"Necromancy", "Charms"}, true, false},
:    ["Swiftness"] = {-1,-1,2,200, {"Air Magic", "Charms"}, true, false},
:    ["Flight"] = {-1,-1,4,200, {"Air Magic", "Charms"}, true, false},
:    ["Insulation"] = {-1,-1,4,200, {"Air Magic", "Charms"}, true, false},
:    ["Control Teleport"] = {-1,-1,4,200, {"Translocations", "Charms"}, true, false},
:    ["Poison Weapon"] = {-1,-1,3,0, {"Poison Magic", "Charms"}, true, false},
:    ["Cure Poison"] = {-1,-1,2,200, {"Poison Magic"}, true, false},
:    ["Resist Poison"] = {-1,-1,4,200, {"Poison Magic", "Charms"}, true, false},
:    ["Recall"] = {-1,-1,3,0, {"Summoning", "Translocations"}, true, false},
:    ["Spider Form"] = {-1,-1,3,200, {"Transmutation", "Poison Magic"}, true, false},
:    ["Blade Hands"] = {-1,-1,5,200, {"Transmutation"}, true, false},
:    ["Statue Form"] = {-1,-1,6,200, {"Transmutation", "Earth Magic"}, true, false},
:    ["Ice Form"] = {-1,-1,4,200, {"Ice Magic", "Transmutation"}, true, false},
:    ["Dragon Form"] = {-1,-1,8,200, {"Fire Magic", "Transmutation"}, true, false},
:    ["Necromutation"] = {-1,-1,8,200, {"Necromancy", "Transmutation"}, true, false},
:    ["Death Channel"] = {-1,-1,7,200, {"Necromancy"}, true, true},
:    ["Deflect Missiles"] = {-1,-1,6,200, {"Air Magic", "Charms"}, true, false},
:    ["Shadow Creatures"] = {-1,-1,5,0, {"Summoning"}, false, false},
:    ["Confusing Touch"] = {-1,-1,1,200, {"Hexes"}, true, false},
:    ["Sure Blade"] = {-1,-1,2,200, {"Hexes", "Charms"}, true, false},
:    ["Passwall"] = {1,1,3,200, {"Transmutation", "Earth Magic"}, true, false},
:    ["Ignite Poison"] = {-1,-1,5,200, {"Fire Magic", "Transmutation"}, true, false},
:    ["Sticks to Snakes"] = {-1,-1,2,200, {"Transmutation"}, true, false},
:    ["Call Canine Familiar"] = {-1,-1,3,200, {"Summoning"}, false, false},
:    ["Summon Dragon"] = {-1,-1,9,200, {"Summoning"}, false, false},
:    ["Enscrolled Hibernation"] = {8,8,2,56, {"Ice Magic", "Hexes"}, true, true},
:    ["Metabolic Englaciation"] = {-1,-1,7,200, {"Ice Magic", "Hexes"}, true, false},
:    ["See Invisibile"] = {-1,-1,4,200, {"Charms"}, true, false},
:    ["Phase Shift"] = {-1,-1,5,200, {"Translocations"}, true, false},
:    ["Summon Butterflies"] = {-1,-1,1,100, {"Summoning"}, true, false},
:    ["Warp Weapon"] = {-1,-1,5,0, {"Charms", "Translocations"}, true, false},
:    ["Silence"] = {-1,-1,5,200, {"Air Magic", "Charms"}, true, false},
:    ["Shatter"] = {-1,-1,9,200, {"Earth Magic"}, false, false},
:    ["Dispersal"] = {-1,-1,6,200, {"Air Magic"}, true, false},
:    ["Static Discharge"] = {-1,-1,4,200, {"Air Magic", "Conjurations"}, false, false},
:    ["Corona"] = {8,8,1,200, {"Hexes"}, true, false},
:    ["Alistair's Intoxication"] = {-1,-1,4,0, {"Poison Magic", "Transmutation"}, true, false},
:    ["Evaporate"] = {6,6,2,200, {"Fire Magic", "Transmutation"}, true, true},
:    ["Lee's Rapid Deconstruction"] = {8,8,5,200, {"Earth Magic"}, true, true},
:    ["Maxwell's Silver Hammer"] = {-1,-1,2,200, {"Earth Magic", "Charms"}, true, false},
:    ["Condensation Shield"] = {-1,-1,4,200, {"Ice Magic", "Transmutation"}, true, false},
:    ["Stoneskin"] = {-1,-1,2,200, {"Earth Magic", "Transmutation"}, true, false},
:    ["Simulacrum"] = {-1,-1,6,200, {"Ice Magic", "Necromancy"}, true, false},
:    ["Conjure Ball Lightning"] = {-1,-1,7,200, {"Air Magic", "Conjurations"}, true, false},
:    ["Chain Lightning"] = {-1,-1,7,200, {"Air Magic", "Conjurations"}, true, false},
:    ["Excrutiating Wounds"] = {-1,-1,5,200, {"Charms", "Necormancy"}, true, false},
:    ["Portal Projectile"] = {8,8,2,50, {"Translocations"}, true, false},
:    ["Summon Ugly Thing"] = {-1,-1,6,200, {"Summoning"}, false, false},
:    ["Passage of Golubria"] = {8,8,4,0, {"Translocations"}, true, false},
:  }
: -- }}}

: function stepdown_value(base, stepping, firststep, laststep, ceiling)
:   if base <= firststep then
:       return base
:   end
:   for i = firststep,laststep,stepping do
:       if base > i then
:           base = ((base - i) / 2) + i
:       end
:   end
:   if ceiling ~= -1 and base > ceiling then
:       return ceiling
:   else
:       return base
:   end
: end

: function spell_range(spell, pow)
:   if not p.spell_info[spell] then
:     return 0
:   end
:   local minrange = p.spell_info[spell][1]
:   local maxrange = p.spell_info[spell][2]
:   local cap = p.spell_info[spell][4]
:   if spell == "Sandblast" and items.equipped_at(0) and
:      string.find(items.equipped_at(0).name(),"stone") then
:     minrange = minrange + 1
:     maxrange = maxrange + 1
:   end
:   -- this should check that the spell is either conjuration or summoning
:   -- or that it's shatter, LRD, sandblast, airstrike, tornado, freeze
:   -- ignite poison, ozo's refrig
:   -- see godabil.cc 1455
:   -- but it's close enough anyway
:   local vehsupports = { "Shatter","Lee's Rapid Deconstruction", "Sandblast",
:           "Airstrike", "Tornado", "Freeze", "Ignite Poison",
:           "Ozocubu's Refrigeration" }
:   local spellschools = p.spell_info[spell][5]
:   if you.god() == "Vehumet"
:       and (util.contains(spellschools, "Conjuration")
:        or util.contains(spellschools, "Summoning"))
:       and util.contains(vehsupports, spell)
:       and maxrange > 0 and maxrange < 8
:       and minrange > 0 and minrange < 8
:       and spell ~= "Sticky Flame" and spell ~= "Freeze" then
:     minrange = minrange + 1
:     maxrange = maxrange + 1
:   end
:   return math.min(8,
:       math.floor((pow * (maxrange - minrange) + cap / 2) / cap + minrange))
: end

: p.school_to_staff = {
:   ["Necromancy"]="staff of death",
:   ["Ice Magic"]="staff of cold",
:   ["Fire Magic"]="staff of fire",
:   ["Air Magic"]="staff of air",
:   ["Poison Magic"]="staff of poison",
:   ["Earth Magic"]="staff of earth",
:   ["Conjurations"]="staff of conjuration",
:   ["Summoning"]="staff of summoning",
:   ["Charms"]="staff of enchantment",
:   ["Hexes"]="staff of enchantment",
:  }

: p.school_to_ring = {
:   ["Ice Magic"]="ring of ice",
:   ["Fire Magic"]="ring of fire",
:  }

: function weilding_staff(school)
:   local stafftype = p.school_to_staff[school]
:   if (stafftype and items.equipped_at(0) and
:      string.find(items.equipped_at(0).name(), stafftype)) then
:      return 1
:   end
:   return 0
: end

: function wearing_ring(school)
:   local ringtype = p.school_to_ring[school]
:   local count = 0
:   if (ringtype and items.equipped_at(7) and
:      string.find(items.equipped_at(7).name(), ringtype)) then
:      count = count + 1
:   end
:   if (ringtype and items.equipped_at(8) and
:      string.find(items.equipped_at(8).name(), ringtype)) then
:      count = count + 1
:   end
:   return count
: end

: function wearing_archmagi()
:   if (items.equipped_at(6) and
:      string.find(items.equipped_at(6).name(),"Archmagi")) then
:       return 1
:   end
:   return 0
: end

: -- spl-cast.cc 435
: -- this doesn't take negative enhancers into account
: function spell_power(spell)
:   if not p.spell_info[spell] then
:     return 0
:   end
:   local enhancers = wearing_archmagi()
:   local spellschools = p.spell_info[spell][5]
:   local schools = {}
:   for i,school in pairs(spellschools) do
:       table.insert(schools, you.skill(school))
:       enhancers = enhancers + wearing_ring(school)
:       enhancers = enhancers + weilding_staff(school)
:   end
:   local pow = spell_power2(you.skill("Spellcasting"), schools,
:       you.intelligence(), enhancers, p.spell_info[spell][4])
:   schools = nil
:   return pow
: end

: function spell_power2(spellcasting, schools, int, enhancerct, cap)
:   local power = math.floor(spellcasting / 2)
:   local ct = # schools
:   for k,v in pairs(schools) do
:     power = power + math.floor(((v * 2) / ct))
:   end
:   power = math.floor((power * int) / 10)
:   if enhancerct > 0 then
:       for i=0,enhancerct do
:           power = power * 15
:           power = power / 10
:       end
:   elseif enhancerct < 0 then
:       for i=0,enhancerct do
:           power = power / 2
:       end
:   end
:   power = stepdown_value(power, 50, 50, 150,  200)
:   if cap > 0 then
:       power = math.min(power, cap)
:   end
:   return power
: end

: p.school_to_resist = {
:   ["Necromancy"]="neg",
:   ["Ice Magic"]="cold",
:   ["Fire Magic"]="fire",
:   ["Air Magic"]="elec",
:   ["Poison Magic"]="poison",
:   ["Hexes"]="magic",
: }

: function mon_byname(name)
:   for k,v in pairs(monster_info) do
:       if name == v.name then
:           return v
:       end
:   end
: end

: function mon_has_spell(mi, spell)
:   for k,spellset in pairs(mi.spells) do
:       for k,s in pairs(spellset) do
:           if spell == s then
:               return true
:           end
:       end
:   end
:   return false
: end

: p.hydra_heads = { ["one"] = 1, ["two"] = 2, ["three"] = 3, ["four"] = 4,
: ["five"] = 5, ["six"] = 6, ["seven"] = 7, ["eight"] = 8, ["nine"] = 9,
: ["ten"] = 10,
: }

: -- seven-headed
: -- 27-headed
: function heads(m)
:   local s,e = m:desc():find("-headed")
:   if s then
:      local n = m:desc():sub(1,s-1)
:       if p.hydra_heads[n] then
:           return p.hydra_heads[n]
:       else
:           return n + 0
:       end
:   end
:   return 8
: end

: function getthreat(mi, m, x, y)
:   if not mi then
:     return 100
:   end
:   local dist = travel_distance(x,y)
:
:   local threat = stepdown_value(mi.xp, 50, 200, 20000, 10000)
:   crawl.mpr("threat from xp("..mi.xp.."): " .. threat)
:   threat = threat + (mi.hplow + mi.hphigh) / 2
:
:   if m then
:     crawl.mpr(m:desc() .. " damage: " .. m:damage_level())
:     threat = threat - (3 * m:damage_level())
:   end
:
:   if mi.attacks and # mi.attacks > 0 then
:     local s = 0
:     for k,v in pairs(mi.attacks) do
:         if v.type == "plain per head" and m then
:             local headct = heads(m)
:             crawl.mpr("hydra heads: " .. headct)
:             s = s + (v.dam * heads(m))
:         else
:             local mult = 1
:             if v.type ~= "plain" then
:                 mult = 3
:             end
:             s = s + v.dam
:         end
:     end
:     crawl.mpr("threat from monster base damage: " .. (s*(1/dist)*2))
:     threat = threat + (s * (1 / dist) * 2)
:   end
:   if mi.spells and # mi.spells > 0 then
:     if mon_has_spell(mi, "smiting") then
:         local smitethreat = 3000 / last_hp
:         if smitethreat < 10 then
:             smitethreat = math.max(10, smitethreat)
:         end
:         if smitethreat > 100 then
:             smitethreat = math.min(100, smitethreat)
:         end
:         threat = threat + smitethreat
:     end
:     if mon_has_spell(mi, "random")
:         or mon_has_spell(mi, "fire storm")
:         or mon_has_spell(mi, "ice storm")
:         then
:         threat = threat + 200
:     end
:     if mon_has_spell(mi, "paralysis") then
:         threat = threat + 130
:     end
:     if mon_has_spell(mi, "hellfire burst")
:         or mon_has_spell(mi, "hellfire")
:         or mon_has_spell(mi, "torment symbol") then
:         threat = threat + 150
:     end
:     if mon_has_spell(mi, "polymorph other") and you.res_mutation() == 0 then
:         threat = threat + 150
:     end
:     if mon_has_spell(mi, "throw flame")
:         or mon_has_spell(mi, "sticky flame range")
:         then
:         threat = threat + 20 * (3.5 - you.res_fire())
:     end
:     if mon_has_spell(mi, "b.fire")
:         or mon_has_spell(mi, "fireball")
:         then
:         threat = threat + 50 * (3.5 - you.res_fire())
:     end
:     if mon_has_spell(mi, "throw frost") then
:         threat = threat + 20 * (3.5 - you.res_cold())
:     end
:     if mon_has_spell(mi, "b.cold") then
:         threat = threat + 50 * (3.5 - you.res_cold())
:     end
:     if mon_has_spell(mi, "b.lightning") then
:         threat = threat + 50 * (3.5 - you.res_shock())
:     end
:     if mon_has_spell(mi, "b.draining") then
:         threat = threat + 50 * (3 - you.res_draining())
:     end
:     if mon_has_spell(mi, "b.venom") then
:         threat = threat + 50 * (1.1 - you.res_poison())
:     end
:     if mon_has_spell(mi, "poison arrow") then
:         threat = threat + 50 * (1.1 - you.res_poison())
:     end
:     if mon_has_spell(mi, "stone arrow") then
:         threat = threat + 20
:     end
:     if mon_has_spell(mi, "iron shot")
:         or mon_has_spell(mi, "destruction orb") then
:         threat = threat + 50
:     end
:     if mon_has_spell(mi, "crystal spear") then
:         threat = threat + 60 * (1 / (dist/2))
:     end
:     if mon_has_spell(mi, "destruction orb") then
:         threat = threat + 50
:     end
:     if mon_has_spell(mi, "banishment") then
:         threat = threat + 40
:     end
:     if mon_has_spell(mi, "summon undead")
:         or mon_has_spell(mi, "greater demon")
:         or mon_has_spell(mi, "demon")
:         or mon_has_spell(mi, "shadow creatures")
:         or mon_has_spell(mi, "horrible things")
:         then
:         threat = threat + 50
:     end
:     -- should be specific (rmut for shining eyes, clarity for golden, etc)
:     if string.find(mi.name,"eye") then
:         threat = threat + 40
:     end
:   end
:   if m and (m:is(p.MB.sleeping)
:      or m:is(p.MB.confused)
:      or m:is(p.MB.dormant)
:      or m:is(p.MB.unaware)
:      or m:is(p.MB.wandering)) then
:     threat = threat * 0.8
:   end
:   --crawl.mpr("threat: " .. threat)
:   return math.max(threat, 1)
: end

: function getresist(mi, school)
:   if not mi then
:     return 0
:   end
:   local res = p.school_to_resist[school]
:   local ret = 0
:   if mi.resists[res] then
:     ret = mi.resists[res]
:     --crawl.mpr(res .. " " .. ret)
:   end
:   if school == "Fire Magic" and mi.resists["hellfire"] and mi.resists["hellfire"] > 0 then
:     ret = 3
:     --crawl.mpr(res .. " " .. ret)
:   end
:   return ret
: end

: function checkflags(mi, value)
:   for k,v in pairs(mi.flags) do
:      if v == value then
:         return true
:      end
:   end
:   return false
: end

: function overallthreat(monsters)
:   local sumthreat = 0
:   for k,v in pairs(monsters) do
:       local smi = monster_info[v[1]:type()]
:       sumthreat = sumthreat + getthreat(smi, v[1], v[2], v[3])
:   end
:   return sumthreat
: end

: function prefer_spell(mi, m, x, y, threat)
:   if checkflags(mi, "undead")
:      and util.contains(you.spells(),"Dispel Undead") then
:      return "Dispel Undead"
:   end
:
:   if (not checkflags(mi, "undead"))
:      and (not checkflags(mi, "demonic"))
:      and (not checkflags(mi, "non-living"))
:      and last_hp < last_mhp * 0.8
:      and util.contains(you.spells(),"Vampiric Draining") then
:      return "Vampiric Draining"
:   end
:
:   if threat < 50 then
:       return nil
:   end
:
:   if threat > 200
:      and (not checkflags(mi, "undead"))
:      and (not checkflags(mi, "demonic"))
:      and (not checkflags(mi, "non-living"))
:      and util.contains(you.spells(),"Agony")
:      and m:damage_level() < 3
:       then
:      return "Agony"
:   end
:
:   if getresist(mi, "Fire Magic") < 3 and adjacent(x,y)
:      and not m:is(p.MB.burning)
:      and util.contains(you.spells(),"Sticky Flame") then
:      return "Sticky Flame"
:   end
:
:   if getresist(mi, "Poison Magic") < 1 and not adjacent(x,y)
:       and threat > 60
:       and not m:is(p.MB.confused)
:       and util.contains(you.spells(),"Mephitic Cloud") then
:      return "Mephitic Cloud"
:   end
:
:   local count = 0
:   for k,v in pairs(p.currentmonsters) do
:       local dist = distance(v[2],v[3],x,y)
:       if dist == 1 then
:          count = count + 1
:       end
:   end
:   crawl.mpr("count: " .. count)
:   -- p.currentmonsters
:   if getresist(mi, "Fire Magic") < 1 and not adjacent(x,y)
:       and ((p.currentthreat > 500) or spell_hunger("Fireball") <= 0)
:       and count > 1
:       and util.contains(you.spells(),"Fireball") then
:      return "Fireball"
:   end
:
:   -- not sure how to avoid getting poisoned other than actually figuring
:   -- out how many squares it will fill, trying distance for now
:   -- targeting for this won't be optimal either
:   if getresist(mi, "Poison Magic") < 1 and travel_distance(x,y) > 4
:       and count >= 1
:       and util.contains(you.spells(),"Poisonous Cloud") then
:      return "Poisonous Cloud"
:   end
:
:   if summoner() then
:     local summons = l_summons(8)
:     local sumpower = overallthreat(summons)
:     crawl.mpr("Summons threat: " .. sumpower)
:     if sumpower < p.currentthreat then
:         for i,n in pairs(you.spells()) do
:             local info = p.spell_info[n]
:             local spellschools = info[5]
:             if util.contains(spellschools, "Summoning") then
:                 crawl.mpr("prefer summon: " .. n)
:                 return n
:             end
:         end
:     end
:   end
:
:   return nil
: end

: function spell_hunger(spell)
:   local hunger = {50, 95, 160, 250, 350, 550, 700, 860, 1000}
:   if p.spell_info[spell] then
:      return math.max(0, hunger[p.spell_info[spell][3]]
:           - you.intelligence() * you.skill("Spellcasting"))
:   else
:       return -1
:   end
: end

: function have_smite()
:   for i,n in pairs(you.spells()) do
:     local info = p.spell_info[n]
:     if info and (not info[6]) and (not info[7]) then
:       crawl.mpr("smite spell:" .. n)
:       return true
:     end
:   end
:   return false
: end

: -- nolof true -> we don't have clear LOF to target,
: -- only cast smite targetable or summons
: function pick_spell(x,y,m,nolof)
:   if not m then
:     return nil, -1
:   end
:   local mi = monster_info[m:type()]
:   local pref
:   local threat = 0
:   if mi then
:     crawl.mpr("mons:" .. m:type() .. " " .. mi.name)
: --    crawl.mpr(table_to_string(mi.resists))
:     threat = getthreat(mi, m, x, y)
:     crawl.mpr("threat: " .. threat)
:     pref = prefer_spell(mi, m, x, y, threat)
:   else
:     crawl.mpr("mons:" .. m:type() .. " has no monster info!")
:   end
:   -- crawl.mpr("prefer: " .. tostring(pref))
:   local options = {} -- index, power, target resists, spell level
:   local dist = spl_dist(x,y)
:   for i,n in pairs(you.spells()) do
: --    crawl.mpr("consider spell: " .. i .. " ".. n)
:     if not p.spell_info[n] then
:       crawl.mpr("unknown spell (not in p.spell_info), aborting: " .. n)
:       return nil, -1
:     end
:     local info = p.spell_info[n]
: -- check don't cast flag or allow prefer_spell to override
: -- check that we have clear lof or we're casting a smite targetable
: -- or non-targeted spell
:     if (not info[6] or pref == n)
:        and ((nolof and not info[7]) or (not nolof))
:       then
:       local spellschools = info[5]
:       local pow = spell_power(n)
:       local range = spell_range(n, pow)
:       local wtf = range * range + 1
:       -- crawl.mpr("wtf: " .. wtf)
:       if you.mp() >= info[3] and (info[1] == -1 or wtf >= dist)
:           and (threat > 50 or info[3] <= 4) -- no big spells for weak crap
:           then
:         -- got enough mp and it's in range
:         -- crawl.mpr("castable: " .. n)
:         options[n] = { i, pow, 0, info[3], spell_hunger(i) }
:         for k,v in pairs(spellschools) do
:           if p.school_to_resist[v] then
: --            crawl.mpr("res: " .. p.school_to_resist[v])
:             options[n] = { i, pow, getresist(mi, v), info[3], spell_hunger(i) }
:           end
:         end
:         if pref == n then -- ignore resists and hunger
:            crawl.mpr("prefer: " .. n)
:            options[n] = { i, pow + 40, 0, info[3], 0 }
:         end
:       end
:     end
:   end
:   crawl.mpr("options:")
:   local best = 0
:   local bestk = nil
:   for k,v in pairs(options) do
:     local x = v[2] - 20 * v[3] + (30 * v[4] - v[5])
:     crawl.mpr(k .. ": " .. x)
:     if x > best then
:       best = x
:       bestk = k
:     end
:   end
:   --crawl.mpr( "best: " .. bestk .. ": " .. best )
:   local spellidx = -1
:   if bestk and options[bestk] then
:      spellidx = options[bestk][1]
:   end
:   options = nil
:   return bestk, spellidx
: end

: function round(x)
:   return math.floor(x+0.5)
: end

: function spl_dist(x,y)
:   -- return math.floor(math.sqrt(x * x + y * y))
:   return x * x + y * y
: end

: p.dry = false

: function cast_spell(x,y,m,nolof)
:   if not (x == 0 and y == 0) then
:     local pick, idx = pick_spell(x,y,m,nolof)
:     if pick then
:       crawl.mpr("target at x: " .. x .. " y: " .. y .. " spell: " .. pick)
:       local spc = "*unknown*"
:       if p.spell_info[pick][1] == -1 then
:         spc = "z" .. string.char(96 + idx)
:       else
:         local line = find_path(x,y)
:         local linestr = walkline(line)
:         spc = "z" .. string.char(96 + idx) .. linestr .. "."
:       end
:       crawl.mpr("casting via: " .. spc)
:       if not p.dry then
:         magic(spc)
:       end
:       return true,x,y
:     end
:   end
:   return false,x,y
: end

: p.MB = {}
: -- {{{1
: for i,v in ipairs({ "stabbable", "distracted", "berserk",
:   "dormant", "sleeping", "unaware", "wandering", "hasted",
:   "strong", "slowed", "fleeing", "confused", "invisible",
:   "poisoned", "rotting", "summoned", "haloed", "glowing",
:   "charmed", "burning", "paralysed", "sick", "caught",
:   "frenzied", "petrifying", "petrified", "vuln_magic",
:   "possessable", "enslaved", "swift", "insane", "silencing",
:   "mesmerizing", "evil_attack", "shapeshifter", "chaotic",
:   "submerged", "bleeding", "deflect_msl", "prep_resurrect",
:   "regeneration", "raised_mr", "mirror_damage",
:   "safe", "unsafe", "name_suffix", "name_adjective",
:   "name_replace", "name_unqualified", "name_the",
:   "fading_away", "mostly_faded", "fear_inspiring",
:   "withdrawn", "attached", "helpless", "dazed", "mute", "blind",
:   "dumb", "mad", "clinging", "name_zombie", "perm_summon"}) do
:  p.MB[v] = i - 1
: end --}}}

: function mon_info()
:   local x,y = get_target()
:   local dist = spl_dist(x,y)
:   local m = monster.get_monster_at(x, y)
:   crawl.mpr("target at x: " .. x .. " y: " .. y .. " dist: " .. dist)
:   if m then
:     crawl.mpr("m: " .. m:desc()
:       .. " " .. m:type()
:       .. " " .. m:base_type()
:       .. " " .. m:damage_level())
:     for k,v in pairs(p.MB) do
:       crawl.mpr(k .. ": " .. tostring(m:is(p.MB[k])))
:     end
:   end
: end

: function safe_approach(x,y)
:   local m = monster.get_monster_at(x, y)
: --  local safe = {"sleeping","confused","wandering"}
: --  return m and contains_string_in(m:desc(),safe)
:   return m and (m:is(p.MB.sleeping)
:              or m:is(p.MB.confused)
:              or m:is(p.MB.dormant)
:              or m:is(p.MB.unaware)
:              or m:is(p.MB.wandering))
: end

: function rangedm()
:   ranged(false)
: end

: -- fallback to melee if moveok is true or we're berserk or not a spellcaster
: function ranged(moveok)
:   local x,y,m = get_target(true)
:   if p.is_berserk or not caster() then
:     make_attack(x,y)
:   elseif m then
:     local dist = spl_dist(x,y)
:     local didcast = cast_spell(x,y,m)
:     if didcast then
:       return
:     else
:       crawl.mpr("couldn't cast, out of range?")
:     end
:     if not moveok then
:        return
:     end
:     --crawl.mpr("ranged 4")
:     -- didn't cast, see if we should get closer
:     crawl.mpr("check move target at x: " .. x .. " y: " .. y)
:     if (dist > 3 or safe_approach(x,y)) then
:       crawl.mpr("moving closer: (" .. x .. "," .. y .. "), " .. dist)
:       make_attack(x,y)
:     end
:   else
:     local x,y,m = get_target()
:     if m and (summoner() or have_smite()) then
:       local didcast = cast_spell(x,y,m,true)
:     else
:       crawl.mpr("no target?")
:     end
:   end
: end

: function hit()
:   make_attack(get_target())
:   p.hold = false
: end

: function eval(str)
:   return assert(loadstring(str))()
: end

: function interact()
:   crawl.formatted_mpr('> ')
:   x = crawl.c_input_line()
:   if not x then
:     return
:   end
:   if string.byte(x, 1) == 61 then
:      x = "return " .. string.sub(x, 2, -1)
:   end
:   res = eval(x)
:   if type(res) == "nil" then
:     res = "nil"
:   end
:   crawl.mpr(x .. " -> " ..  tostring(res))
:   collectgarbage()
: end

: -- ##############################################
: update_stuff()

: crawl.mpr("post load gcinfo: " .. gcinfo())
